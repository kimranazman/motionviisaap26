# Milestone v1.5.1: Site Audit Fixes & Detail View Preferences

**Status:** SHIPPED 2026-01-27
**Phases:** 43-45
**Total Plans:** 5

## Overview

Fix critical bugs (Price Comparison crash, Timeline rendering), reduce UX friction (clickable rows, currency formatting, title wrapping), and add a user-configurable detail view system where users choose between drawer and dialog modes. Three phases: stabilize broken pages, polish interaction patterns, then build the detail view preference system.

## Phases

### Phase 43: Bug Fixes

**Goal**: All existing pages render correctly without crashes or missing content
**Depends on**: Nothing (first phase of milestone)
**Plans**: 1 plan

Plans:
- [x] 43-01: Fix Radix Select crashes, Gantt bar rendering, and empty state message

**Details:**
- Fixed `<SelectItem value="">` crash in supplier-items-table (BUG-01) and 2 latent bugs in task-form and task-detail-sheet
- Used sentinel values (`"all"` for filters, `"__unassigned__"` for assignee) matching existing codebase patterns
- Fixed Gantt bar container height (`min-h-[2.5rem]`) for absolutely-positioned bars to render
- Updated empty state message to "No initiatives scheduled" with filter context hint

### Phase 44: UX Polish

**Goal**: Users can click into detail views from any list and see properly formatted data
**Depends on**: Nothing (independent of Phase 43)
**Plans**: 2 plans

Plans:
- [x] 44-01: Clickable initiative rows and title wrapping
- [x] 44-02: Currency input formatting for deal and potential project values

**Details:**
- Initiative list rows clickable, opening InitiativeDetailSheet (matching company-list pattern)
- stopPropagation on dropdown menu to prevent row click interference
- Initiative titles wrap to multiple lines (removed truncate/max-w-md classes)
- CurrencyInput component with RM prefix and Intl.NumberFormat('en-MY') thousand separators
- Format-on-blur pattern (raw number while editing, formatted display on blur)
- Replaced value inputs in 4 form files (deal-form, deal-detail, potential-form, potential-detail)

### Phase 45: Detail View System

**Goal**: Users control how detail views appear -- choosing between centered dialog and slide-over drawer -- with settings that persist across sessions
**Depends on**: Phase 44 (clickable rows create more detail view usage, making preference meaningful)
**Plans**: 2 plans

Plans:
- [x] 45-01: DetailView component, context provider, schema/API update, provider wiring
- [x] 45-02: Refactor 7 detail views, settings page, user menu toggle

**Details:**
- DetailView wrapper component conditionally renders Dialog or Sheet based on user preference context
- DetailViewProvider with mode/toggle/setMode, fire-and-forget PATCH persistence
- UserPreferences.detailViewMode column (String, default "dialog")
- Responsive drawer: right on desktop, bottom on mobile via matchMedia listener
- ExpandButton with navigation to full detail page
- All 7 detail views migrated (Initiative, Company, Deal, Potential, Project, Task, Supplier)
- Footer content extracted to DetailView footer prop for pinned action buttons
- Settings page (/settings) with visual radio card selector
- Header quick-toggle button (desktop only) with tooltip
- Settings link in sidebar and mobile sidebar navigation

---

## Milestone Summary

**Key Decisions:**
- Sentinel values for Select components (`"all"`, `"__unassigned__"`) to avoid Radix empty string crash
- Format-on-blur for CurrencyInput to avoid cursor jumping
- Intl.NumberFormat('en-MY') for Malaysian locale formatting
- DetailViewMode stored as String column with fire-and-forget PATCH persistence
- Responsive drawer uses matchMedia for side switching (right desktop, bottom mobile)
- Footer content extracted to DetailView footer prop for all 7 detail views
- Settings page uses visual radio card selector for dialog/drawer mode
- Header quick-toggle visible on desktop only (mobile always uses bottom sheet)

**Issues Resolved:**
- Price Comparison page crash (Radix Select empty value)
- Timeline Gantt chart bars not rendering (container height too small)
- Timeline empty state showing wrong message
- Task form/detail sheet latent Select crash (same empty value issue)
- Pre-existing lint error in initiatives-list.tsx (unused param)

**Issues Deferred:**
- Route guard security audit (separate security-focused milestone)
- Dashboard chart width(-1) console warning (cosmetic, no user impact)

**Technical Debt Incurred:**
- Initiative detail sheet uses inline save button instead of footer prop (cosmetic inconsistency with other 6 detail views in drawer mode)

---

_For current project status, see .planning/ROADMAP.md_
