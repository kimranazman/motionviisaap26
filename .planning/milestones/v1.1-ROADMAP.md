# Milestone v1.1: Authentication

**Status:** ✅ SHIPPED 2026-01-22
**Phases:** 4-8
**Total Plans:** 11

## Overview

Restrict access to authorized @talenta.com.my users with role-based permissions. Implemented Google OAuth login, domain restriction, three-tier RBAC (Admin/Editor/Viewer), admin user management, and role-based UI controls.

## Phases

### Phase 4: Auth Foundation

**Goal**: Users can sign in with Google and only @talenta.com.my emails are allowed
**Depends on**: Phase 3 (v1.0 complete)
**Requirements**: AUTH-01, AUTH-02, AUTH-03, AUTH-04, AUTH-05
**Plans**: 4 plans

Plans:
- [x] 04-01-PLAN.md — Dependencies and database schema (next-auth, prisma models)
- [x] 04-02-PLAN.md — Auth configuration and route handler
- [x] 04-03-PLAN.md — Login page and access denied page
- [x] 04-04-PLAN.md — Environment setup and end-to-end verification

### Phase 5: Role Infrastructure

**Goal**: Users are assigned roles and admin is seeded
**Depends on**: Phase 4
**Requirements**: ROLE-01, ROLE-02, ROLE-03
**Plans**: 1 plan

Plans:
- [x] 05-01-PLAN.md — Profile callback and admin seed script

### Phase 6: Route Protection

**Goal**: Unauthenticated and unauthorized users cannot access protected resources
**Depends on**: Phase 5
**Requirements**: PROT-01, PROT-02, PROT-03, PROT-04
**Plans**: 2 plans

Plans:
- [x] 06-01-PLAN.md — Auth utilities and forbidden page
- [x] 06-02-PLAN.md — API route protection

### Phase 7: Admin User Management

**Goal**: Admin can manage user access and roles
**Depends on**: Phase 6
**Requirements**: ROLE-04, ROLE-05, ROLE-06
**Plans**: 2 plans

Plans:
- [x] 07-01-PLAN.md — Server Actions and AlertDialog setup
- [x] 07-02-PLAN.md — Admin users page and sidebar navigation

### Phase 8: Role-Based UI

**Goal**: UI adapts based on user role
**Depends on**: Phase 7
**Requirements**: UI-01, UI-02, UI-03, UI-04, UI-05
**Plans**: 2 plans

Plans:
- [x] 08-01-PLAN.md — Permission utilities and Kanban role-based controls
- [x] 08-02-PLAN.md — Initiative detail role-based controls and permission dialog

---

## Milestone Summary

**Key Decisions:**
- Use NextAuth.js v5 with Prisma adapter for auth
- JWT session strategy for Edge middleware compatibility
- Server-side domain validation (not just hd parameter)
- Three-tier RBAC: Admin > Editor > Viewer
- Viewers can comment but not edit
- khairul@talenta.com.my as primary admin

**Issues Resolved:**
- Edge runtime doesn't support Prisma — fetch role only on sign-in
- Middleware using separate auth config — use full auth export
- OAuthAccountNotLinked — don't pre-seed users, let OAuth create them
- AUTH_SECRET missing in production — document in DEPLOYMENT.md

**Technical Debt:**
- isAdmin() utility exported but unused (sidebar uses inline check)

---

*Archived: 2026-01-22 as part of v1.1 milestone completion*
