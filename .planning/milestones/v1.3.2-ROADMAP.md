# Milestone v1.3.2: Conversion Visibility & Archive

**Status:** SHIPPED 2026-01-24
**Phases:** 27-28
**Total Plans:** 4

## Overview

Show conversion status on deals/potentials with links to converted projects, display estimate vs actual variance, make converted items read-only, and add archive system to reduce clutter.

## Phases

### Phase 27: Conversion Visibility & Archive

**Goal**: Users can see conversion status on deals/potentials, navigate to converted projects, and archive completed items
**Depends on**: Phase 26 (revenue model refinement)
**Plans**: 3 plans

Plans:
- [x] 27-01: Schema & API updates (isArchived field, project include, archive filter)
- [x] 27-02: Conversion Visibility UI (badges, View Project, variance, read-only)
- [x] 27-03: Archive system UI (toggle, archive buttons, deep linking)

**Details:**

Requirements covered: CONV-01, CONV-02, CONV-03, CONV-04, CONV-05, ARCH-01, ARCH-02, ARCH-03, ARCH-04

Success Criteria achieved:
1. CONFIRMED potential shows "Converted to Project" badge with project title
2. User can click "View Project" button on converted potential to navigate to project
3. Converted potential shows variance: Estimated vs Actual revenue from linked project
4. Converted potential is read-only (edit disabled)
5. WON deal shows same conversion indicators as potential
6. User can archive completed/converted deals, potentials, and projects
7. Archived items hidden from default views
8. User can toggle "Show Archived" to see archived items
9. User can unarchive items

### Phase 28: Server Query Project Include Fix

**Goal**: Fix server-side page queries to include project relation for conversion visibility on initial load
**Depends on**: Phase 27 (conversion visibility implemented)
**Gap Closure**: Closes all gaps from v1.3.2 audit
**Plans**: 1 plan

Plans:
- [x] 28-01: Add project include to page queries

**Details:**

Requirements covered: CONV-01 (gap closure)

Success Criteria achieved:
1. pipeline/page.tsx includes project relation in Prisma query with Decimal serialization
2. potential-projects/page.tsx includes project relation in Prisma query with Decimal serialization
3. Conversion badges visible on initial page load (not just after archive toggle)

---

## Milestone Summary

**Key Decisions:**
- isArchived defaults to false, preserving existing records as active
- Archive filter applied by default (showArchived=true needed to see archived)
- Project relation included in deals/potentials for conversion visibility
- Conversion badge only shows when stage is WON/CONFIRMED AND project exists
- Read-only mode applies to converted AND lost deals (no editing either)
- Variance shows positive (green) or negative (amber) color coding
- View button navigates via /projects?open={id} query param pattern
- Archive toggle updates URL param and refetches data client-side
- Archived items cannot be dragged in kanban boards
- Server-side page queries must include same relations as API routes for initial render parity

**Issues Resolved:**
- CONV-01 gap: Conversion badges not visible on initial page load (fixed in Phase 28)

**Issues Deferred:**
- Type hygiene: PipelineBoard/PotentialBoard interfaces missing project field (works at runtime)

**Technical Debt Incurred:**
- Board interfaces should include project field for complete type safety (low priority)

---

_For current project status, see .planning/ROADMAP.md_
