# Requirements Archive: v2.8 AI Analyze Button

**Archived:** 2026-01-29
**Status:** SHIPPED

This is the archived requirements specification for v2.8.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: SAAP 2026 v2 — v2.8 AI Analyze Button

**Defined:** 2026-01-29
**Core Value:** Admin can trigger AI analysis from the SAAP UI, leveraging Claude Code on Mac via SSH

## v1 Requirements

Requirements for v2.8 release. Each maps to roadmap phases.

### Infrastructure

- [x] **INFRA-01**: SSH from NAS to Mac works without password — *Documented, manual setup required*
- [x] **INFRA-02**: Claude command executes successfully on Mac via SSH — *Documented, manual setup required*

### Pending API

- [x] **API-01**: GET /api/ai/pending returns costs count (costs with supplierId but no normalizedItem)
- [x] **API-02**: GET /api/ai/pending returns deliverables count (documents without aiExtracted deliverables)
- [x] **API-03**: Response includes structured object: { costs, invoices, receipts, deliverables, total }

### Trigger API

- [x] **TRIG-01**: POST /api/ai/trigger accepts type parameter (all, costs, invoice, receipt, deliverables)
- [x] **TRIG-02**: Endpoint SSHs to Mac and runs Claude /ai-analyze command
- [x] **TRIG-03**: Admin-only access (role check)
- [x] **TRIG-04**: SSH errors return 500 with error message
- [x] **TRIG-05**: Environment variables for SSH host and project path

### UI Component

- [x] **UI-01**: Header button with Sparkles icon (admin-only visibility)
- [x] **UI-02**: Badge showing total pending count
- [x] **UI-03**: Dropdown menu with options: All, Costs, Invoices, Receipts, Deliverables
- [x] **UI-04**: Each dropdown item shows count for that type
- [x] **UI-05**: Toast feedback on trigger click ("Analyzing..." message)
- [x] **UI-06**: Error toast when SSH fails

### Polling

- [x] **POLL-01**: After trigger, poll pending count every 15 seconds
- [x] **POLL-02**: Stop polling after 90 seconds max
- [x] **POLL-03**: If count decreased, show success toast with items analyzed
- [x] **POLL-04**: If timeout with no change, show "Still running on Mac" info toast
- [x] **POLL-05**: Badge refreshes during polling

## v2 Requirements

Deferred to future release.

### Future Enhancements

- **FUT-01**: Run Claude Code directly on NAS (remove SSH dependency)
- **FUT-02**: Real-time log streaming from Claude to UI
- **FUT-03**: Analysis history with timestamps and results

## Out of Scope

Explicitly excluded. Documented to prevent scope creep.

| Feature | Reason |
|---------|--------|
| Run Claude on NAS directly | Requires Docker Claude Code setup; SSH to Mac is simpler for now |
| Real-time progress updates | Fire-and-forget with polling is sufficient |
| Analysis scheduling (cron) | Manual trigger is fine for 3-person team |
| Multiple Mac targets | Single Mac is sufficient |
| Analysis queue management | One-at-a-time is fine |

## Traceability

Which phases cover which requirements.

| Requirement | Phase | Status |
|-------------|-------|--------|
| INFRA-01 | Phase 80 | Complete (documented) |
| INFRA-02 | Phase 80 | Complete (documented) |
| API-01 | Phase 81 | Complete |
| API-02 | Phase 81 | Complete |
| API-03 | Phase 81 | Complete |
| TRIG-01 | Phase 82 | Complete |
| TRIG-02 | Phase 82 | Complete |
| TRIG-03 | Phase 82 | Complete |
| TRIG-04 | Phase 82 | Complete |
| TRIG-05 | Phase 82 | Complete |
| UI-01 | Phase 83 | Complete |
| UI-02 | Phase 83 | Complete |
| UI-03 | Phase 83 | Complete |
| UI-04 | Phase 83 | Complete |
| UI-05 | Phase 83 | Complete |
| UI-06 | Phase 83 | Complete |
| POLL-01 | Phase 83 | Complete |
| POLL-02 | Phase 83 | Complete |
| POLL-03 | Phase 83 | Complete |
| POLL-04 | Phase 83 | Complete |
| POLL-05 | Phase 83 | Complete |

**Coverage:**
- v1 requirements: 21 total
- Shipped: 21 (100%)
- Adjusted: 0
- Dropped: 0

---

## Milestone Summary

**Shipped:** 21 of 21 v1 requirements
**Adjusted:** None
**Dropped:** None

Note: INFRA-01 and INFRA-02 are infrastructure prerequisites documented in Phase 80. The SSH setup must be completed manually by the user for the trigger API to function.

---
*Archived: 2026-01-29 as part of v2.8 milestone completion*
