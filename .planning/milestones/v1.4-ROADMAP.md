# Milestone v1.4: Intelligent Automation & Organization

**Status:** SHIPPED 2026-01-25
**Phases:** 29-35
**Total Plans:** 15

## Overview

Transformed SAAP into an intelligent project delivery system with supplier management, company departments for organizational structure, project deliverables tracking, comprehensive task management with subtask hierarchies, bidirectional data sync between pipelines and projects, and AI-powered price comparison across suppliers.

## Phases

### Phase 29: Schema Foundation

**Goal**: Establish database models for all v1.4 features
**Depends on**: Phase 28 (v1.3.2 complete)
**Plans**: 1 plan

Plans:
- [x] 29-01-PLAN.md - Add v1.4 database models (Supplier, Department, Deliverable, Task, ActivityLog)

**Details:**
Added 8 new Prisma models:
- Supplier: Contact info, credit terms, payment terms
- Department: Under Company, for organizational structure
- Deliverable: Project scope items from quotes
- Task: With self-referencing parent/children for subtasks
- TaskComment: Comments on tasks
- Tag: Global tags with colors
- TaskTag: Many-to-many task-tag relation
- ActivityLog: Polymorphic entity reference for sync events

Renamed Department enum to InitiativeDepartment to avoid collision.

### Phase 30: Supplier Management

**Goal**: Users can track suppliers and link them to project costs
**Depends on**: Phase 29
**Plans**: 2 plans

Plans:
- [x] 30-01-PLAN.md - Supplier CRUD with list page, detail modal, and navigation
- [x] 30-02-PLAN.md - Supplier-Cost linking and spend analytics on detail page

**Details:**
- Full supplier CRUD API routes with cost protection on delete
- Supplier list page with search filtering and payment terms badges
- SupplierSelect combobox with lazy loading for cost-supplier linking
- Supplier detail with Financial Summary, Price List, and Projects Worked On sections

### Phase 31: Department Organization

**Goal**: Users can organize company contacts by department and scope deals/potentials
**Depends on**: Phase 29
**Plans**: 2 plans

Plans:
- [x] 31-01-PLAN.md - Department CRUD and contact assignment
- [x] 31-02-PLAN.md - Deal/potential department scoping and cascading selection

**Details:**
- Department CRUD API routes under company
- DepartmentSelect component with inline editing in company modal
- Cascading Company → Department → Contact selection in deal and potential forms
- Contact filtering shows department contacts plus company-wide contacts (departmentId null)

### Phase 32: Project Deliverables

**Goal**: Users can track project scope items (deliverables) from quotes
**Depends on**: Phase 29
**Plans**: 2 plans

Plans:
- [x] 32-01-PLAN.md - Deliverable CRUD API and UI components
- [x] 32-02-PLAN.md - AI deliverable extraction and review

**Details:**
- Deliverable CRUD API routes with auto sortOrder calculation
- DeliverableForm and DeliverableCard components
- AI extraction of deliverables from Talenta/Motionvii invoices
- DeliverableReviewSheet for user review before import
- Import Deliverables button on ANALYZED invoices

### Phase 33: Task Management

**Goal**: Users can track tasks and subtasks on projects with full workflow
**Depends on**: Phase 32 (tasks can link to deliverables)
**Plans**: 4 plans

Plans:
- [x] 33-01-PLAN.md - Task CRUD API and basic UI (TaskForm, TaskCard, integration)
- [x] 33-02-PLAN.md - Tags API and TaskTagSelect component
- [x] 33-03-PLAN.md - Task tree view with hierarchy, collapse/expand, progress, tag inheritance
- [x] 33-04-PLAN.md - Task comments API and TaskDetailSheet

**Details:**
- Task CRUD API with app-level cascade delete (MySQL limitation)
- TaskForm and TaskCard components with flat and tree views
- Tags CRUD API with 8-color palette and duplicate prevention
- TaskTagSelect combobox with inline tag creation
- Recursive TaskTree/TaskTreeNode with collapse/expand and progress badges
- Automatic tag inheritance propagation to descendant tasks
- Task Comments API with user avatars and relative timestamps
- TaskDetailSheet for full task editing

### Phase 34: Activity Logging & Bidirectional Sync

**Goal**: Users see live project data on pipeline and changes sync bidirectionally
**Depends on**: Phase 33 (activity logging touches all entities)
**Plans**: 2 plans

Plans:
- [x] 34-01-PLAN.md - Activity logging infrastructure and title sync
- [x] 34-02-PLAN.md - Live project metrics on cards and auto-refresh

**Details:**
- Activity logging utilities with bidirectional title sync
- ActivityTimeline component for deal/potential detail sheets
- Live project metrics (status, revenue, costs) on converted cards
- 60-second polling with auto-refresh on tab visibility change
- Activity logs API endpoint with entity filtering

### Phase 35: AI Price Comparison

**Goal**: Users can compare prices across suppliers using AI semantic matching
**Depends on**: Phase 30 (requires supplier data)
**Plans**: 2 plans

Plans:
- [x] 35-01-PLAN.md - Schema & embedding infrastructure (Cost.embedding, OpenAI SDK, lib/embeddings.ts)
- [x] 35-02-PLAN.md - Comparison API & UI (fire-and-forget embedding, /api/suppliers/compare, PriceComparisonSheet)

**Details:**
- OpenAI text-embedding-3-small integration (1536 dimensions)
- Cost.embedding JSON column for embedding storage
- Cosine similarity via dot product (OpenAI vectors pre-normalized)
- Fire-and-forget automatic embedding generation on cost create/update
- Price comparison API endpoint with 0.7 similarity threshold
- PriceComparisonSheet with confidence levels (HIGH >= 0.85, MEDIUM >= 0.7)

---

## Milestone Summary

**Key Decisions:**
- InitiativeDepartment enum rename (avoids collision with Department model)
- Global tags for tasks (simpler initial implementation)
- Task self-reference onDelete: NoAction (cascade in app code due to MySQL limitation)
- Delete protection on suppliers (cannot delete if costs linked)
- Fire-and-forget embedding generation (no await, background execution)
- 60-second poll interval for pipeline auto-refresh
- 0.7 similarity threshold for price comparison matching

**Issues Resolved:**
- MySQL self-referential FK cascade limitation (app-level cascade delete)
- Next.js route file export restriction (TAG_COLORS moved to lib/tag-utils.ts)
- Lazy OpenAI initialization (prevents build-time errors)

**Issues Deferred:**
- TASK-15: Convert deliverable to task (v2 feature)
- SUPP-12: Price history with effectiveDate (v2 feature)
- AI-01: Auto-extract supplier from receipts (v2 feature)

**Technical Debt Incurred:**
None. All implementations complete without TODOs or stubs.

---

*For current project status, see .planning/ROADMAP.md*
*Archived: 2026-01-25*
