# Requirements Archive: v2.4 Settings, Sidebar & Bug Fixes

**Archived:** 2026-01-28
**Status:** SHIPPED

This is the archived requirements specification for v2.4.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## v1 Requirements

Requirements for v2.4 release. Each maps to roadmap phases.

### Sidebar Bug Fixes (SIDE)

- [x] **SIDE-01**: Hidden nav items stay hidden regardless of which URL the user navigates to (autoReveal removed)
- [x] **SIDE-02**: Settings page shows a Save button that persists all sidebar visibility changes in a single batch
- [x] **SIDE-03**: Save button only appears when local state differs from persisted state (dirty detection)
- [x] **SIDE-04**: Sidebar visually updates immediately after saving without requiring page reload
- [x] **SIDE-05**: Toast notification confirms successful save ("Settings saved")

### Nested Sidebar Navigation (NEST)

- [x] **NEST-01**: Companies nav item has an expand/collapse chevron showing Departments and Contacts as indented sub-items
- [x] **NEST-02**: Clicking "Companies" label navigates to /companies; clicking the chevron toggles sub-items
- [x] **NEST-03**: Companies parent is highlighted when on /companies, /departments, or /contacts
- [x] **NEST-04**: Sub-items can be individually hidden via Settings page toggles
- [x] **NEST-05**: Hiding parent "Companies" also hides Departments and Contacts sub-items
- [x] **NEST-06**: Mobile sidebar renders nested items with same hierarchy and behavior
- [x] **NEST-07**: Settings page shows nested items with visual indentation under parent

### Sidebar Drag-and-Drop Reorder (REORD)

- [x] **REORD-01**: Settings page shows nav items with drag handles for each group
- [x] **REORD-02**: User can drag to reorder items within a group (SAAP, CRM, Admin)
- [x] **REORD-03**: Items cannot be dragged between groups
- [x] **REORD-04**: Custom order persisted per-user in UserPreferences (navItemOrder JSON field)
- [x] **REORD-05**: Sidebar renders items in user's custom order
- [x] **REORD-06**: "Reset Order" button restores default order from nav-config.ts
- [x] **REORD-07**: New nav items added in future deploys appear at end for users with custom order

### Revenue Accuracy (REV)

- [x] **REV-01**: Dashboard CRM Revenue KPI uses per-project `revenue ?? potentialRevenue` fallback
- [x] **REV-02**: Revenue calculation includes ACTIVE and COMPLETED projects
- [x] **REV-03**: Projects with both revenue and potentialRevenue count actual revenue only (no double-counting)
- [x] **REV-04**: Profit calculation updates consistently with the new revenue logic

### Task on Completed Projects (TASK)

- [x] **TASK-01**: User can create tasks on projects with COMPLETED status
- [x] **TASK-02**: User can create subtasks on tasks belonging to completed projects
- [x] **TASK-03**: User can edit existing tasks on completed projects

### Internal Project Field Config (INTL)

- [x] **INTL-01**: Admin settings section shows toggles for internal project field visibility
- [x] **INTL-02**: Configurable fields include: revenue, potentialRevenue, pipeline source, company/contact, initiative link
- [x] **INTL-03**: Configuration stored in AdminDefaults (system-wide, not per-user)
- [x] **INTL-04**: Project form dynamically hides fields based on admin config when project is internal
- [x] **INTL-05**: Project detail view follows same field visibility rules
- [x] **INTL-06**: Sensible defaults applied when no admin config exists

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| SIDE-01 | Phase 68 | Complete |
| SIDE-02 | Phase 68 | Complete |
| SIDE-03 | Phase 68 | Complete |
| SIDE-04 | Phase 68 | Complete |
| SIDE-05 | Phase 68 | Complete |
| NEST-01 | Phase 69 | Complete |
| NEST-02 | Phase 69 | Complete |
| NEST-03 | Phase 69 | Complete |
| NEST-04 | Phase 69 | Complete |
| NEST-05 | Phase 69 | Complete |
| NEST-06 | Phase 69 | Complete |
| NEST-07 | Phase 69 | Complete |
| REORD-01 | Phase 70 | Complete |
| REORD-02 | Phase 70 | Complete |
| REORD-03 | Phase 70 | Complete |
| REORD-04 | Phase 70 | Complete |
| REORD-05 | Phase 70 | Complete |
| REORD-06 | Phase 70 | Complete |
| REORD-07 | Phase 70 | Complete |
| REV-01 | Phase 68 | Complete |
| REV-02 | Phase 68 | Complete |
| REV-03 | Phase 68 | Complete |
| REV-04 | Phase 68 | Complete |
| TASK-01 | Phase 68 | Complete |
| TASK-02 | Phase 68 | Complete |
| TASK-03 | Phase 68 | Complete |
| INTL-01 | Phase 71 | Complete |
| INTL-02 | Phase 71 | Complete |
| INTL-03 | Phase 71 | Complete |
| INTL-04 | Phase 71 | Complete |
| INTL-05 | Phase 71 | Complete |
| INTL-06 | Phase 71 | Complete |

**Coverage:**
- v1 requirements: 32 total
- Shipped: 32
- Dropped: 0

---

## Milestone Summary

**Shipped:** 32 of 32 v1 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-01-28 as part of v2.4 milestone completion*
