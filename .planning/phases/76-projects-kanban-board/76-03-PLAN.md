# Plan 76-03: Projects Kanban Board Component

```yaml
wave: 2
depends_on:
  - 76-01
  - 76-02
files_modified:
  - src/components/projects/projects-kanban-board.tsx (NEW)
autonomous: true
```

## Objective

Create the main Kanban board component with DnD context, 4 status columns, and drag-and-drop status updates.

## Tasks

<task id="1">
Create `src/components/projects/projects-kanban-board.tsx` following the pattern from `src/components/tasks/task-kanban-view.tsx`:

**Imports:**
```typescript
import { useState, useCallback } from 'react'
import {
  DndContext,
  DragOverlay,
  pointerWithin,
  rectIntersection,
  KeyboardSensor,
  MouseSensor,
  TouchSensor,
  useSensor,
  useSensors,
  DragStartEvent,
  DragEndEvent,
  DragOverEvent,
  CollisionDetection,
} from '@dnd-kit/core'
import {
  SortableContext,
  sortableKeyboardCoordinates,
  verticalListSortingStrategy,
} from '@dnd-kit/sortable'
import { ProjectKanbanColumn } from './project-kanban-column'
import { ProjectKanbanCard } from './project-kanban-card'
import { cn } from '@/lib/utils'
```

**Constants:**
```typescript
const PROJECT_COLUMNS = [
  { id: 'DRAFT', title: 'Draft', colorDot: 'bg-gray-400' },
  { id: 'ACTIVE', title: 'Active', colorDot: 'bg-blue-500' },
  { id: 'COMPLETED', title: 'Completed', colorDot: 'bg-green-500' },
  { id: 'CANCELLED', title: 'Cancelled', colorDot: 'bg-red-400' },
]
const COLUMN_IDS = PROJECT_COLUMNS.map(c => c.id)
```

**Props:**
```typescript
interface ProjectsKanbanBoardProps {
  projects: ProjectForKanban[]
  onProjectClick: (project: ProjectForKanban) => void
  onProjectsChange: (projects: ProjectForKanban[]) => void
}
```
</task>

<task id="2">
Implement sensor configuration:
```typescript
const mouseSensor = useSensor(MouseSensor, {
  activationConstraint: { distance: 5 },
})
const touchSensor = useSensor(TouchSensor, {
  activationConstraint: {
    delay: 250,
    tolerance: 5,
  },
})
const keyboardSensor = useSensor(KeyboardSensor, {
  coordinateGetter: sortableKeyboardCoordinates,
})
const sensors = useSensors(mouseSensor, touchSensor, keyboardSensor)
```
</task>

<task id="3">
Implement custom collision detection that prioritizes columns:
```typescript
const collisionDetection: CollisionDetection = useCallback((args) => {
  const pointerCollisions = pointerWithin(args)
  const columnCollision = pointerCollisions.find(
    collision => COLUMN_IDS.includes(collision.id as string)
  )
  if (columnCollision) return [columnCollision]

  const rectCollisions = rectIntersection(args)
  const itemCollision = rectCollisions.find(
    collision => !COLUMN_IDS.includes(collision.id as string)
  )
  if (itemCollision) return [itemCollision]

  return rectCollisions.length > 0 ? [rectCollisions[0]] : []
}, [])
```
</task>

<task id="4">
Implement drag handlers:

**handleDragStart:**
- Set activeId state
- Set isDragging state to true

**handleDragOver:**
- Get target column from over.id (direct) or from overItem.status
- If status changes, optimistically update projects array

**handleDragEnd:**
- Clear activeId and isDragging
- Determine final status from over target
- Call onProjectsChange with updated projects
- Call PATCH `/api/projects/${projectId}` with new status
</task>

<task id="5">
Implement render:
```typescript
return (
  <DndContext
    sensors={sensors}
    collisionDetection={collisionDetection}
    onDragStart={handleDragStart}
    onDragOver={handleDragOver}
    onDragEnd={handleDragEnd}
    autoScroll={{ threshold: { x: 0.1, y: 0.1 }, acceleration: 5, interval: 10 }}
  >
    <div className={cn(
      'flex gap-4 pb-4 pl-1',
      'overflow-x-auto scroll-pl-1',
      !isDragging && 'snap-x snap-mandatory',
      '[&::-webkit-scrollbar]:hidden [-webkit-overflow-scrolling:touch]',
      'md:min-w-max md:snap-none md:pl-0 md:scroll-pl-0'
    )}>
      {PROJECT_COLUMNS.map(column => {
        const columnProjects = projects.filter(p => p.status === column.id)
        return (
          <ProjectKanbanColumn key={column.id} {...column} count={columnProjects.length}>
            <SortableContext items={columnProjects.map(p => p.id)} strategy={verticalListSortingStrategy}>
              {columnProjects.map(project => (
                <ProjectKanbanCard
                  key={project.id}
                  project={project}
                  onClick={() => onProjectClick(project)}
                />
              ))}
            </SortableContext>
          </ProjectKanbanColumn>
        )
      })}
    </div>
    <DragOverlay>
      {activeId && <ProjectKanbanCard project={projects.find(p => p.id === activeId)!} isDragging />}
    </DragOverlay>
  </DndContext>
)
```
</task>

## Verification

```bash
# File exists
ls src/components/projects/projects-kanban-board.tsx

# Has DnD imports
grep "DndContext" src/components/projects/projects-kanban-board.tsx
grep "DragOverlay" src/components/projects/projects-kanban-board.tsx

# Has all 4 columns
grep "DRAFT\|ACTIVE\|COMPLETED\|CANCELLED" src/components/projects/projects-kanban-board.tsx

# Has API call for status update
grep "/api/projects/" src/components/projects/projects-kanban-board.tsx
grep "PATCH" src/components/projects/projects-kanban-board.tsx

# Exports component
grep "export function ProjectsKanbanBoard" src/components/projects/projects-kanban-board.tsx
```

## must_haves

- [ ] Uses DndContext with sensors (mouse, touch, keyboard)
- [ ] Renders 4 status columns: Draft, Active, Completed, Cancelled
- [ ] Custom collision detection prioritizes columns
- [ ] Drag-and-drop updates project status optimistically
- [ ] Calls PATCH API to persist status changes
- [ ] DragOverlay shows card being dragged
- [ ] Mobile horizontal scroll with snap
