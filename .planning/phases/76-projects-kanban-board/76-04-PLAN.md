# Plan 76-04: Projects Page Client Component

```yaml
wave: 3
depends_on:
  - 76-03
files_modified:
  - src/components/projects/projects-page-client.tsx (NEW)
autonomous: true
```

## Objective

Create the client wrapper component that handles view toggle between List and Kanban views.

## Tasks

<task id="1">
Create `src/components/projects/projects-page-client.tsx` following the pattern from `src/components/tasks/tasks-page-client.tsx`:

**Imports:**
```typescript
'use client'

import { useState, useEffect } from 'react'
import { useRouter } from 'next/navigation'
import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Table2 as TableIcon, KanbanSquare } from 'lucide-react'
import { ProjectList } from './project-list'
import { ProjectsKanbanBoard } from './projects-kanban-board'
import { ProjectDetailSheet } from './project-detail-sheet'
```

**Storage key:**
```typescript
const STORAGE_KEY = 'projects-view-preference'
```

**Props interface:**
```typescript
export interface ProjectForKanban {
  id: string
  title: string
  description: string | null
  status: string
  company: { id: string; name: string } | null
  contact: { id: string; name: string } | null
  isInternal?: boolean
  internalEntity?: string | null
  startDate: string | null
  endDate: string | null
  revenue: number | null
  potentialRevenue: number | null
  taskCount: number
  taskDoneCount: number
  totalCost: number
  sourceDeal: { id: string; title: string } | null
  sourcePotential: { id: string; title: string } | null
  initiative: { id: string; title: string } | null
  isArchived?: boolean
}

interface ProjectsPageClientProps {
  initialData: ProjectForKanban[]
  initialShowArchived: boolean
  openProjectId?: string
}
```
</task>

<task id="2">
Implement view preference persistence:
```typescript
const [viewMode, setViewMode] = useState<'list' | 'kanban'>('list')

// Load from localStorage (SSR-safe)
useEffect(() => {
  try {
    const stored = localStorage.getItem(STORAGE_KEY)
    if (stored === 'list' || stored === 'kanban') {
      setViewMode(stored)
    }
  } catch { /* ignore */ }
}, [])

// Persist preference
const handleViewChange = (mode: string) => {
  const validMode = mode as 'list' | 'kanban'
  setViewMode(validMode)
  try {
    localStorage.setItem(STORAGE_KEY, validMode)
  } catch { /* ignore */ }
}
```
</task>

<task id="3">
Implement project state management:
```typescript
const [projects, setProjects] = useState<ProjectForKanban[]>(initialData)
const [selectedProject, setSelectedProject] = useState<ProjectForKanban | null>(null)
const [isSheetOpen, setIsSheetOpen] = useState(false)

// Handle project click (opens detail sheet)
const handleProjectClick = (project: ProjectForKanban) => {
  setSelectedProject(project)
  setIsSheetOpen(true)
}

// Handle projects change (from kanban drag)
const handleProjectsChange = (updatedProjects: ProjectForKanban[]) => {
  setProjects(updatedProjects)
}
```
</task>

<task id="4">
Implement render with view toggle:
```typescript
return (
  <div className="space-y-4">
    {/* View Toggle (top right aligned) */}
    <div className="flex justify-end">
      <Tabs value={viewMode} onValueChange={handleViewChange}>
        <TabsList className="bg-white/70 backdrop-blur-xl border border-gray-200/50">
          <TabsTrigger value="list" className="gap-1.5 data-[state=active]:bg-white">
            <TableIcon className="h-4 w-4" />
            List
          </TabsTrigger>
          <TabsTrigger value="kanban" className="gap-1.5 data-[state=active]:bg-white">
            <KanbanSquare className="h-4 w-4" />
            Kanban
          </TabsTrigger>
        </TabsList>
      </Tabs>
    </div>

    {/* List View */}
    {viewMode === 'list' && (
      <ProjectList
        initialData={projects}
        initialShowArchived={initialShowArchived}
        openProjectId={openProjectId}
      />
    )}

    {/* Kanban View */}
    {viewMode === 'kanban' && (
      <ProjectsKanbanBoard
        projects={projects}
        onProjectClick={handleProjectClick}
        onProjectsChange={handleProjectsChange}
      />
    )}

    {/* Detail Sheet */}
    {selectedProject && (
      <ProjectDetailSheet
        projectId={selectedProject.id}
        open={isSheetOpen}
        onOpenChange={setIsSheetOpen}
      />
    )}
  </div>
)
```
</task>

## Verification

```bash
# File exists
ls src/components/projects/projects-page-client.tsx

# Has view toggle
grep "Tabs" src/components/projects/projects-page-client.tsx
grep "list\|kanban" src/components/projects/projects-page-client.tsx

# Has localStorage persistence
grep "localStorage" src/components/projects/projects-page-client.tsx
grep "projects-view-preference" src/components/projects/projects-page-client.tsx

# Renders both views
grep "ProjectList" src/components/projects/projects-page-client.tsx
grep "ProjectsKanbanBoard" src/components/projects/projects-page-client.tsx

# Exports component
grep "export function ProjectsPageClient" src/components/projects/projects-page-client.tsx
```

## must_haves

- [ ] View toggle between List and Kanban
- [ ] View preference persisted to localStorage
- [ ] List view uses existing ProjectList component
- [ ] Kanban view uses new ProjectsKanbanBoard component
- [ ] Project click opens detail sheet
- [ ] Handles project state updates from kanban drag
