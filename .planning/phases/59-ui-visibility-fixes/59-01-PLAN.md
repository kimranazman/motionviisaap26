# Plan 59-01: Verify UI Visibility Features

## Frontmatter

- **Phase:** 59
- **Plan:** 01
- **Wave:** 1
- **Depends on:** None
- **Files modified:** None (verification only)
- **Autonomous:** true

## Context

Research (59-RESEARCH.md) found that all VIS-01 through VIS-05 requirements are already fully implemented:

- Departments section with full CRUD exists in CompanyDetailModal
- Tasks section with tree hierarchy and full CRUD exists in ProjectDetailSheet
- API endpoints for both features exist and are functional
- Build passes with zero errors

This plan verifies that the existing implementation meets all success criteria.

## Tasks

<task id="1">
**Verify build passes**

Run `npx next build` and confirm no TypeScript or compilation errors.

**Verification:** Build completes with exit code 0.
</task>

<task id="2">
**Verify department components exist and are wired**

Confirm the following files exist and are properly connected:
- `src/components/companies/department-section.tsx` - renders department list + add form
- `src/components/companies/department-card.tsx` - renders individual department with edit/delete
- `src/components/companies/department-form.tsx` - create department form
- `src/components/companies/company-detail-modal.tsx` - imports and renders DepartmentSection

**Verification:** All files exist. CompanyDetailModal imports DepartmentSection and renders it with companyId, departments, and onDepartmentChange props.
</task>

<task id="3">
**Verify task components exist and are wired**

Confirm the following files exist and are properly connected:
- `src/components/projects/task-tree.tsx` - renders task tree with add form
- `src/components/projects/task-tree-node.tsx` - renders task node with edit/delete/add-subtask
- `src/components/projects/task-form.tsx` - create/edit task form
- `src/components/projects/task-detail-sheet.tsx` - task detail view
- `src/components/projects/project-detail-sheet.tsx` - imports TaskTree and renders it

**Verification:** All files exist. ProjectDetailSheet imports TaskTree and renders it with projectId, tasks, and onTasksChange props. Tasks are fetched on mount.
</task>

<task id="4">
**Verify API endpoints exist**

Confirm these API routes exist and handle expected methods:
- `src/app/api/companies/[id]/departments/route.ts` - GET, POST
- `src/app/api/companies/[id]/departments/[deptId]/route.ts` - PATCH, DELETE
- `src/app/api/projects/[id]/tasks/route.ts` - GET, POST
- `src/app/api/projects/[id]/tasks/[taskId]/route.ts` - GET, PATCH, DELETE

**Verification:** All files exist with correct HTTP method handlers.
</task>

## must_haves

These are derived from the Phase 59 success criteria in the roadmap:

1. Opening a company detail view shows a Departments section with existing departments listed
2. User can add, edit, and delete departments directly from the company detail view
3. Opening a project detail view shows a Tasks section with existing tasks and subtask hierarchy
4. User can add, edit, delete tasks and change task status directly from the project detail view

## Verification

All must_haves are met by existing code:
- must_have 1: CompanyDetailModal renders DepartmentSection which lists departments
- must_have 2: DepartmentSection has add form, DepartmentCard has inline edit + delete
- must_have 3: ProjectDetailSheet renders TaskTree which shows tree hierarchy
- must_have 4: TaskTreeNode has add subtask, edit, delete buttons; TaskForm handles status changes
