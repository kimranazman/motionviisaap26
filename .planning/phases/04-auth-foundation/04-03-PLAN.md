---
plan: 04-03
title: Login Page, Access Denied Page, and Sign Out Button
wave: 3
depends_on: ["04-02"]
files_modified:
  - src/app/(auth)/login/page.tsx
  - src/app/(auth)/access-denied/page.tsx
  - src/app/(auth)/layout.tsx
  - src/components/auth/sign-out-button.tsx
autonomous: true
user_setup:
  - service: google-oauth
    why: "Google OAuth for @talenta.com.my users"
    env_vars:
      - name: AUTH_SECRET
        source: "Generate with: npx auth secret"
      - name: AUTH_GOOGLE_ID
        source: "Google Cloud Console -> APIs & Services -> Credentials -> OAuth 2.0 Client ID"
      - name: AUTH_GOOGLE_SECRET
        source: "Google Cloud Console -> APIs & Services -> Credentials -> OAuth 2.0 Client Secret"
      - name: AUTH_URL
        source: "Set to https://saap.motionvii.com (production) or http://localhost:3000 (dev)"
    dashboard_config:
      - task: "Create OAuth 2.0 Client ID"
        location: "Google Cloud Console -> APIs & Services -> Credentials"
      - task: "Add authorized redirect URI: {AUTH_URL}/api/auth/callback/google"
        location: "OAuth 2.0 Client ID settings"
      - task: "Configure OAuth consent screen as Internal (Google Workspace org)"
        location: "Google Cloud Console -> APIs & Services -> OAuth consent screen"
must_haves:
  truths:
    - "User visiting /login sees branded login page"
    - "User can click Google sign-in button"
    - "User without @talenta.com.my email is redirected to /access-denied"
    - "Access denied page explains why access was rejected"
    - "User can sign out and return to login page"
  artifacts:
    - path: "src/app/(auth)/login/page.tsx"
      provides: "Branded login page with Google sign-in"
      min_lines: 30
    - path: "src/app/(auth)/access-denied/page.tsx"
      provides: "Access denied page for non-domain emails"
      min_lines: 20
    - path: "src/app/(auth)/layout.tsx"
      provides: "Minimal layout for auth pages"
    - path: "src/components/auth/sign-out-button.tsx"
      provides: "Sign out button component"
      min_lines: 15
  key_links:
    - from: "src/app/(auth)/login/page.tsx"
      to: "src/auth.ts"
      via: "signIn function import"
      pattern: "signIn.*google"
    - from: "src/components/auth/sign-out-button.tsx"
      to: "next-auth/react"
      via: "signOut function import"
      pattern: "signOut"
---

# Plan 04-03: Login Page, Access Denied Page, and Sign Out Button

## Objective
Create the branded login page with Google sign-in button, the access denied page for rejected domain users, and a sign-out button component.

## Context
This plan creates the user-facing auth pages and components:
1. Login page (/login) - Branded with Talenta logo and Google sign-in button
2. Access denied page (/access-denied) - Shows when non-@talenta.com.my user tries to sign in
3. Sign out button - Reusable component for signing out users

The login page uses server action to trigger sign-in. When a non-domain user attempts to sign in, Auth.js redirects to /login?error=AccessDenied which we'll redirect to /access-denied.

Note: Environment variables (AUTH_GOOGLE_ID, AUTH_GOOGLE_SECRET, AUTH_SECRET, AUTH_URL) must be set before testing. The user_setup frontmatter documents what the user needs to configure in Google Cloud Console.

## Tasks

<task id="1">
Create auth layout at `src/app/(auth)/layout.tsx`:

```tsx
export default function AuthLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800">
      {children}
    </div>
  )
}
```

This provides a centered layout for auth pages with a subtle gradient background.
</task>

<task id="2">
Create login page at `src/app/(auth)/login/page.tsx`:

```tsx
import { signIn } from "@/auth"
import { redirect } from "next/navigation"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"

export default async function LoginPage({
  searchParams,
}: {
  searchParams: Promise<{ error?: string; callbackUrl?: string }>
}) {
  const params = await searchParams

  // Redirect access denied errors to dedicated page
  if (params.error === "AccessDenied") {
    redirect("/access-denied")
  }

  return (
    <Card className="w-full max-w-md mx-4">
      <CardHeader className="space-y-1 text-center">
        <div className="flex justify-center mb-4">
          {/* Talenta branding */}
          <div className="w-16 h-16 rounded-xl bg-primary flex items-center justify-center">
            <span className="text-2xl font-bold text-primary-foreground">T</span>
          </div>
        </div>
        <CardTitle className="text-2xl font-bold">Welcome to SAAP</CardTitle>
        <CardDescription>
          Strategic Annual Action Plan - Talenta
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        {params.error && params.error !== "AccessDenied" && (
          <div className="p-3 text-sm text-red-500 bg-red-50 dark:bg-red-900/20 rounded-md text-center">
            Authentication failed. Please try again.
          </div>
        )}

        <form
          action={async () => {
            "use server"
            await signIn("google", { redirectTo: params.callbackUrl || "/" })
          }}
        >
          <Button type="submit" className="w-full" size="lg">
            <svg className="mr-2 h-5 w-5" viewBox="0 0 24 24">
              <path
                fill="currentColor"
                d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
              />
              <path
                fill="currentColor"
                d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
              />
              <path
                fill="currentColor"
                d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
              />
              <path
                fill="currentColor"
                d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
              />
            </svg>
            Sign in with Google
          </Button>
        </form>

        <p className="text-xs text-center text-muted-foreground">
          Only @talenta.com.my accounts are allowed
        </p>
      </CardContent>
    </Card>
  )
}
```

Key points:
- Uses server action for signIn (no client component needed)
- Redirects AccessDenied error to /access-denied
- Shows generic error for other auth failures
- Displays Google OAuth button with icon
- Informs users about domain restriction
</task>

<task id="3">
Create access denied page at `src/app/(auth)/access-denied/page.tsx`:

```tsx
import Link from "next/link"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { ShieldX } from "lucide-react"

export default function AccessDeniedPage() {
  return (
    <Card className="w-full max-w-md mx-4 text-center">
      <CardHeader className="space-y-1">
        <div className="flex justify-center mb-4">
          <div className="w-16 h-16 rounded-full bg-red-100 dark:bg-red-900/20 flex items-center justify-center">
            <ShieldX className="w-8 h-8 text-red-600 dark:text-red-400" />
          </div>
        </div>
        <CardTitle className="text-2xl font-bold">Access Denied</CardTitle>
        <CardDescription>
          Your account is not authorized to access this application.
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        <p className="text-sm text-muted-foreground">
          Only <span className="font-medium">@talenta.com.my</span> email addresses are allowed.
          Please sign in with your Talenta work account.
        </p>

        <Button asChild variant="outline" className="w-full">
          <Link href="/login">Try Another Account</Link>
        </Button>
      </CardContent>
    </Card>
  )
}
```

This page:
- Clearly explains why access was denied
- Shows the required domain
- Provides a link back to login to try another account
</task>

<task id="4">
Create sign-out button component at `src/components/auth/sign-out-button.tsx`:

```tsx
"use client"

import { signOut } from "next-auth/react"
import { Button } from "@/components/ui/button"
import { LogOut } from "lucide-react"

interface SignOutButtonProps {
  variant?: "default" | "destructive" | "outline" | "secondary" | "ghost" | "link"
  size?: "default" | "sm" | "lg" | "icon"
  className?: string
  showIcon?: boolean
  children?: React.ReactNode
}

export function SignOutButton({
  variant = "ghost",
  size = "default",
  className,
  showIcon = true,
  children,
}: SignOutButtonProps) {
  return (
    <Button
      variant={variant}
      size={size}
      className={className}
      onClick={() => signOut({ callbackUrl: "/login" })}
    >
      {showIcon && <LogOut className="h-4 w-4 mr-2" />}
      {children ?? "Sign out"}
    </Button>
  )
}
```

This component:
- Uses `signOut` from `next-auth/react` (client-side)
- Redirects to /login after sign out
- Accepts customization props for variant, size, icon visibility
- Can be placed in dashboard header or settings menu
- Is a client component ("use client") since it uses onClick handler
</task>

## Verification

<verification>
<check>File exists: src/app/(auth)/layout.tsx</check>
<check>File exists: src/app/(auth)/login/page.tsx with Google sign-in button</check>
<check>File exists: src/app/(auth)/access-denied/page.tsx with domain explanation</check>
<check>File exists: src/components/auth/sign-out-button.tsx with signOut function</check>
<check>Run `npm run build` - no TypeScript errors in auth pages or components</check>
<check>Navigate to /login - shows branded login page (requires env vars)</check>
</verification>

## must_haves
- Login page shows at /login with Talenta branding
- Google sign-in button visible and styled
- AccessDenied error redirects to /access-denied
- Access denied page explains domain restriction
- Link to try another account from access denied page
- SignOutButton component created and can be imported
