---
phase: 43-bug-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/supplier-items/supplier-items-table.tsx
  - src/components/timeline/gantt-chart.tsx
  - src/components/projects/task-form.tsx
  - src/components/projects/task-detail-sheet.tsx
autonomous: true

must_haves:
  truths:
    - "Price Comparison page (/supplier-items) loads and displays supplier item data without crashing"
    - "Timeline page (/timeline) renders Gantt chart bars for initiatives that have both start and end dates"
    - "Timeline page shows 'No initiatives scheduled' message when filters produce no results"
    - "Task form and task detail sheet do not crash when selecting 'Unassigned' assignee"
  artifacts:
    - path: "src/components/supplier-items/supplier-items-table.tsx"
      provides: "Price Comparison table with working Select filters"
      contains: "value=\"all\""
    - path: "src/components/timeline/gantt-chart.tsx"
      provides: "Gantt chart with visible bars and correct empty state"
      contains: "No initiatives scheduled"
    - path: "src/components/projects/task-form.tsx"
      provides: "Task form with safe assignee Select"
      contains: "value=\"__unassigned__\""
    - path: "src/components/projects/task-detail-sheet.tsx"
      provides: "Task detail sheet with safe assignee Select"
      contains: "value=\"__unassigned__\""
  key_links:
    - from: "supplier-items-table.tsx SelectItem"
      to: "Radix Select value prop"
      via: "sentinel value 'all' instead of empty string"
      pattern: "value=\"all\""
    - from: "gantt-chart.tsx bar container"
      to: "absolutely-positioned bar div"
      via: "min-h-[2.5rem] ensuring bar has rendering space"
      pattern: "min-h-\\[2\\.5rem\\]"
---

<objective>
Fix all crashing and non-rendering pages across the application.

Purpose: BUG-01, BUG-02, BUG-03 are blocking users from accessing Price Comparison and Timeline pages. Two latent bugs in task management share the same root cause and should be fixed preventively.
Output: All four affected components patched and rendering correctly.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/43-bug-fixes/43-RESEARCH.md

@src/components/supplier-items/supplier-items-table.tsx
@src/components/timeline/gantt-chart.tsx
@src/components/projects/task-form.tsx
@src/components/projects/task-detail-sheet.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Radix Select empty value crashes (BUG-01 + latent bugs)</name>
  <files>
    src/components/supplier-items/supplier-items-table.tsx
    src/components/projects/task-form.tsx
    src/components/projects/task-detail-sheet.tsx
  </files>
  <action>
    Fix the `<SelectItem value="">` crash in three files. `@radix-ui/react-select` v2.x throws a runtime error when value is an empty string because it is reserved for clearing the select to placeholder state.

    **supplier-items-table.tsx (BUG-01 -- Price Comparison crash):**
    1. Line 125: Change `value={categoryFilter ?? ''}` to `value={categoryFilter ?? 'all'}`
    2. Line 127: Change the comparison `value === ''` to `value === 'all'`
    3. Line 134: Change `<SelectItem value="">` to `<SelectItem value="all">`
    4. Line 145: Change `value={supplierFilter ?? ''}` to `value={supplierFilter ?? 'all'}`
    5. Line 147: Change the comparison `value === ''` to `value === 'all'`
    6. Line 154: Change `<SelectItem value="">` to `<SelectItem value="all">`

    This matches the established pattern used in 7+ other Select components in this codebase (e.g., gantt-chart.tsx already uses `value="all"` for department filter).

    **task-form.tsx (latent bug):**
    1. Line 195: Change `<SelectItem value="">Unassigned</SelectItem>` to `<SelectItem value="__unassigned__">Unassigned</SelectItem>`
    2. Line 190: Change `value={assignee}` to `value={assignee || '__unassigned__'}`
    3. Line 190: Change `onValueChange={setAssignee}` to `onValueChange={(v) => setAssignee(v === '__unassigned__' ? '' : v)}`

    **task-detail-sheet.tsx (latent bug):**
    1. Line 296: Change `<SelectItem value="">Unassigned</SelectItem>` to `<SelectItem value="__unassigned__">Unassigned</SelectItem>`
    2. Line 291: Change `value={assignee}` to `value={assignee || '__unassigned__'}`
    3. Line 291: Change `onValueChange={setAssignee}` to `onValueChange={(v) => setAssignee(v === '__unassigned__' ? '' : v)}`

    The `__unassigned__` sentinel matches the pattern already used in initiative-detail.tsx for unassignment.

    DO NOT change the `clearFilters` function logic -- setting state to `null` is correct; the sentinel mapping happens only in the Select value/onValueChange props.
  </action>
  <verify>
    1. Run `npx tsc --noEmit` -- no type errors
    2. Run `npm run build` -- build succeeds without errors
    3. Grep to confirm no remaining `value=""` in Select components: `grep -rn 'SelectItem value=""' src/components/`
  </verify>
  <done>
    - No `<SelectItem value="">` exists in any of the three files
    - supplier-items-table.tsx uses `value="all"` for both category and supplier filter SelectItems
    - task-form.tsx and task-detail-sheet.tsx use `value="__unassigned__"` for the Unassigned SelectItem
    - TypeScript compilation passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Timeline Gantt bar rendering and empty state (BUG-02 + BUG-03)</name>
  <files>
    src/components/timeline/gantt-chart.tsx
  </files>
  <action>
    **BUG-02 -- Gantt bars not rendering:**
    Line 205: Change the bar container class from `py-2` to `min-h-[2.5rem]` to give the absolutely-positioned bar (which is `h-6` = 24px, centered with `top-1/2 -translate-y-1/2`) enough vertical space to render.

    Change:
    ```
    <div className="flex-1 relative py-2 min-w-[600px]">
    ```
    To:
    ```
    <div className="flex-1 relative min-h-[2.5rem] min-w-[600px]">
    ```

    Also check: Line 145 has `overflow-hidden` on the Card. This is acceptable because the CardContent handles overflow with `overflow-x-auto`. The bars are inside the CardContent, not overflowing the Card boundary. Leave `overflow-hidden` as-is unless runtime verification shows it clips bars (the research notes MEDIUM confidence on the root cause).

    **BUG-03 -- Empty state message:**
    Lines 250-254: Update the empty state to match the requirement "No initiatives scheduled" and add filter context hint.

    Change:
    ```tsx
    {filteredInitiatives.length === 0 && (
      <div className="p-8 text-center text-gray-500">
        No initiatives found
      </div>
    )}
    ```
    To:
    ```tsx
    {filteredInitiatives.length === 0 && (
      <div className="p-12 text-center">
        <p className="text-gray-900 font-medium">No initiatives scheduled</p>
        {filterDepartment !== 'all' && (
          <p className="text-sm text-gray-500 mt-1">
            Try adjusting your filters
          </p>
        )}
      </div>
    )}
    ```

    The filter hint only shows when a department filter is active, helping users understand why no results appear.
  </action>
  <verify>
    1. Run `npx tsc --noEmit` -- no type errors
    2. Run `npm run build` -- build succeeds
    3. Grep to confirm new empty state text: `grep -n "No initiatives scheduled" src/components/timeline/gantt-chart.tsx`
    4. Grep to confirm min-h applied: `grep -n "min-h-\[2.5rem\]" src/components/timeline/gantt-chart.tsx`
  </verify>
  <done>
    - Gantt bar container has `min-h-[2.5rem]` instead of `py-2`, providing adequate height for the 24px absolutely-positioned bars
    - Empty state message reads "No initiatives scheduled" (not "No initiatives found")
    - Filter hint "Try adjusting your filters" appears when department filter is active
    - Build passes cleanly
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` completes without errors
2. No `<SelectItem value="">` patterns remain in any modified file
3. Navigate to `/supplier-items` -- page loads without crash, category and supplier filters work
4. Navigate to `/timeline` -- Gantt bars are visible for initiatives with date ranges
5. On `/timeline`, filter to a department with no initiatives -- "No initiatives scheduled" message appears
6. On any project task view, the "Unassigned" option in assignee dropdown works without crash
</verification>

<success_criteria>
- BUG-01: Price Comparison page renders and filters work (category and supplier)
- BUG-02: Timeline Gantt chart bars are visible for initiatives with valid date ranges
- BUG-03: Timeline empty state shows "No initiatives scheduled" with filter hint when applicable
- Latent bugs: Task form and task detail sheet assignee selects use sentinel values, no crash risk
- Zero TypeScript errors, clean build
</success_criteria>

<output>
After completion, create `.planning/phases/43-bug-fixes/43-01-SUMMARY.md`
</output>
