# Plan 60-01: Event API Routes (Create, Update, Delete)

## Frontmatter

- **Phase**: 60 — Event CRUD
- **Plan**: 60-01
- **Wave**: 1
- **Depends on**: None
- **Files modified**:
  - `src/app/api/events-to-attend/route.ts` (add POST)
  - `src/app/api/events-to-attend/[id]/route.ts` (new — GET, PATCH, DELETE)
- **Autonomous**: true

## Objective

Create full CRUD API endpoints for EventToAttend so the frontend can create, edit, and delete events.

## Tasks

<task id="1" name="Add POST handler to events-to-attend route">
Add a POST handler to `src/app/api/events-to-attend/route.ts` that:

1. Uses `requireEditor()` for auth
2. Accepts JSON body with all EventToAttend fields:
   - `name` (required, string)
   - `priority` (required, EventPriority enum)
   - `category` (required, EventCategory enum)
   - `eventDate` (required, string)
   - `location` (required, string)
   - `estimatedCost` (optional, number → Decimal)
   - `whyAttend` (optional, string)
   - `targetCompanies` (optional, string)
   - `actionRequired` (optional, string)
   - `status` (optional, defaults to PLANNED)
   - `remarks` (optional, string)
3. Validates required fields (name, priority, category, eventDate, location), returns 400 if missing
4. Creates via `prisma.eventToAttend.create()`
5. Returns created event with 201 status
6. Follows the pattern from `src/app/api/suppliers/route.ts` POST handler

Reference: `src/app/api/suppliers/route.ts` for POST pattern.
</task>

<task id="2" name="Create per-ID route for GET/PATCH/DELETE">
Create `src/app/api/events-to-attend/[id]/route.ts` with three handlers:

**GET handler:**
1. Uses `requireAuth()` for auth
2. Accepts `params: Promise<{ id: string }>` (Next.js 15 pattern)
3. Fetches event by ID via `prisma.eventToAttend.findUnique({ where: { id } })`
4. Returns 404 if not found
5. Serializes `estimatedCost` Decimal to Number
6. Returns JSON event

**PATCH handler:**
1. Uses `requireEditor()` for auth
2. Accepts `params: Promise<{ id: string }>` and JSON body
3. Supports partial update of ALL fields:
   - name, priority, category, eventDate, location, estimatedCost, whyAttend, targetCompanies, actionRequired, status, remarks
4. Uses conditional spread pattern: `...(body.name !== undefined && { name: body.name })`
5. Updates via `prisma.eventToAttend.update()`
6. Returns updated event

**DELETE handler:**
1. Uses `requireEditor()` for auth
2. Accepts `params: Promise<{ id: string }>`
3. Checks event exists first, returns 404 if not found
4. Deletes via `prisma.eventToAttend.delete({ where: { id } })`
5. Returns `{ success: true }`

Reference: `src/app/api/suppliers/[id]/route.ts` for the exact pattern (params, auth, error handling).
</task>

## Verification

- [ ] POST /api/events-to-attend creates a new event with all fields
- [ ] POST returns 400 when required fields (name, priority, category, eventDate, location) are missing
- [ ] GET /api/events-to-attend/[id] returns a single event
- [ ] GET /api/events-to-attend/[id] returns 404 for non-existent ID
- [ ] PATCH /api/events-to-attend/[id] updates any subset of fields
- [ ] DELETE /api/events-to-attend/[id] removes the event
- [ ] All write endpoints use requireEditor()
- [ ] TypeScript compiles without errors

## Must Haves

1. POST endpoint creates events with all EventToAttend fields
2. PATCH endpoint updates any subset of fields on an existing event
3. DELETE endpoint removes an event
4. Required field validation on POST (name, priority, category, eventDate, location)
5. Auth guards: requireAuth for reads, requireEditor for writes
