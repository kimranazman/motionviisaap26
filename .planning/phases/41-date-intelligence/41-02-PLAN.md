---
phase: 41-date-intelligence
plan: 02
type: execute
wave: 2
depends_on: ["41-01"]
files_modified:
  - src/components/objectives/timeline-suggestions.tsx
  - src/components/kanban/initiative-detail-sheet.tsx
autonomous: true

must_haves:
  truths:
    - "Opening an initiative with date issues shows timeline adjustment suggestions"
    - "Suggestions are context-specific based on which flags are active"
    - "Overdue initiatives suggest extending end date or marking completed"
    - "Late-start initiatives suggest updating status or adjusting start date"
    - "Long-duration initiatives suggest breaking into smaller initiatives"
    - "Invalid-date initiatives suggest correcting the date range"
    - "High-overlap owners see suggestion to redistribute workload"
    - "Initiatives with no date issues show no suggestions section"
  artifacts:
    - path: "src/components/objectives/timeline-suggestions.tsx"
      provides: "TimelineSuggestions component rendering suggestion cards"
      exports: ["TimelineSuggestions"]
    - path: "src/components/kanban/initiative-detail-sheet.tsx"
      provides: "Detail sheet with TimelineSuggestions section after dates"
  key_links:
    - from: "src/components/objectives/timeline-suggestions.tsx"
      to: "src/lib/initiative-date-utils.ts"
      via: "import analyzeDates, detectOwnerOverlap, generateTimelineSuggestions"
      pattern: "generateTimelineSuggestions.*initiative-date-utils"
    - from: "src/components/kanban/initiative-detail-sheet.tsx"
      to: "src/components/objectives/timeline-suggestions.tsx"
      via: "renders TimelineSuggestions component"
      pattern: "<TimelineSuggestions"
---

<objective>
Add timeline suggestions to the initiative detail sheet. When an initiative has date issues (overdue, late-start, long-duration, invalid-dates, or high owner overlap), the detail sheet shows an actionable suggestions section recommending timeline adjustments.

Purpose: Users opening an initiative detail see specific, actionable guidance for resolving date-related issues, making it easy to act on the intelligence surfaced by date badges.
Output: TimelineSuggestions component rendered in the detail sheet, showing context-specific suggestions only when relevant.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/41-date-intelligence/41-RESEARCH.md
@.planning/phases/41-date-intelligence/41-01-SUMMARY.md

Key source files:
@src/lib/initiative-date-utils.ts
@src/components/kanban/initiative-detail-sheet.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TimelineSuggestions component</name>
  <files>src/components/objectives/timeline-suggestions.tsx</files>
  <action>
Create `src/components/objectives/timeline-suggestions.tsx` as a 'use client' component.

Props interface:
```typescript
interface TimelineSuggestionsProps {
  startDate: string
  endDate: string
  status: string
  allInitiatives: Array<{
    id: string
    personInCharge: string | null
    startDate: string | Date
    endDate: string | Date
    status: string
  }>
  currentInitiativeId: string
}
```

Implementation:
1. Import `analyzeDates`, `detectOwnerOverlap`, `generateTimelineSuggestions` from `@/lib/initiative-date-utils`
2. Call `analyzeDates(startDate, endDate, status)` to get flags and durationDays
3. Call `detectOwnerOverlap(allInitiatives)` to get overlap map, then get current initiative's overlap count
4. Call `generateTimelineSuggestions(flags, durationDays, overlapCount)` to get suggestions array
5. If suggestions array is empty, return null (render nothing)
6. Render as an amber/yellow info box:
   ```tsx
   <div className="bg-amber-50 border border-amber-200 rounded-lg p-3 space-y-2">
     <h4 className="text-sm font-medium text-amber-800 flex items-center gap-1.5">
       <Lightbulb className="h-4 w-4" />
       Timeline Suggestions
     </h4>
     <ul className="space-y-1">
       {suggestions.map((suggestion, i) => (
         <li key={i} className="text-sm text-amber-700 flex items-start gap-2">
           <span className="shrink-0 mt-0.5">&#8226;</span>
           <span>{suggestion}</span>
         </li>
       ))}
     </ul>
   </div>
   ```

Import Lightbulb from lucide-react.

Note: The component re-computes overlap detection from allInitiatives. This is fine performance-wise since there are only ~30 initiatives total and the computation is O(n*k) where k is max initiatives per person (~10).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors.
  </verify>
  <done>
TimelineSuggestions component renders an amber suggestion box with bullet-pointed recommendations based on active date flags and overlap count. Returns null when no suggestions are applicable.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate TimelineSuggestions into InitiativeDetailSheet</name>
  <files>src/components/kanban/initiative-detail-sheet.tsx</files>
  <action>
Modify `src/components/kanban/initiative-detail-sheet.tsx`:

1. Add import: `import { TimelineSuggestions } from '@/components/objectives/timeline-suggestions'`

2. The detail sheet needs access to all initiatives for overlap detection. The component already receives `initiative` as a prop. Add a new optional prop `allInitiatives` to `InitiativeDetailSheetProps`:
   ```typescript
   interface InitiativeDetailSheetProps {
     initiative: Initiative | null
     open: boolean
     onOpenChange: (open: boolean) => void
     onUpdate?: (updated: Initiative) => void
     allInitiatives?: Array<{
       id: string
       personInCharge: string | null
       startDate: string | Date
       endDate: string | Date
       status: string
     }>
   }
   ```

3. Destructure `allInitiatives` in the component props (default to empty array).

4. Insert the `<TimelineSuggestions>` component after the "Due Date" field in the Quick Info Grid, before the KPI Tracking section (before the first `<Separator />`). Place it between the grid's closing `</div>` and the `<Separator />`:
   ```tsx
   </div>  {/* end of Quick Info Grid */}

   {/* Timeline Suggestions */}
   {allInitiatives && allInitiatives.length > 0 && initiative && (
     <TimelineSuggestions
       startDate={initiative.startDate}
       endDate={initiative.endDate}
       status={status}
       allInitiatives={allInitiatives}
       currentInitiativeId={initiative.id}
     />
   )}

   <Separator />  {/* existing separator before KPI */}
   ```

   Note: Use `status` (the local state variable) not `initiative.status` so suggestions reflect any unsaved status changes.

5. Update `src/components/objectives/objective-hierarchy.tsx` to pass `allInitiatives` to `InitiativeDetailSheet`:
   ```tsx
   <InitiativeDetailSheet
     initiative={selectedInitiative}
     open={isSheetOpen}
     onOpenChange={setIsSheetOpen}
     onUpdate={handleInitiativeUpdate}
     allInitiatives={initialData}
   />
   ```

This requires a small modification to `objective-hierarchy.tsx` -- add the `allInitiatives` prop pass-through.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Run `npm run build` to verify build succeeds. Navigate to `/objectives`, click an initiative that has date issues (overdue, long-duration, etc.) and verify the detail sheet shows the amber "Timeline Suggestions" box with relevant recommendations. Click an initiative with no date issues and verify no suggestions section appears.
  </verify>
  <done>
InitiativeDetailSheet shows contextual timeline suggestions for initiatives with date issues. Suggestions appear in an amber info box between the date fields and KPI section. Initiatives without date issues show no suggestions. The detail sheet receives all initiatives for overlap computation.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- zero type errors
2. `npm run build` -- build succeeds
3. Click an overdue initiative -- detail sheet shows suggestion about extending end date
4. Click a late-start initiative -- detail sheet shows suggestion about updating status
5. Click a long-duration initiative -- detail sheet shows suggestion about breaking into smaller initiatives
6. Click an initiative with invalid dates -- detail sheet shows suggestion about correcting date range
7. Click initiative of owner with >3 concurrent -- detail sheet shows workload redistribution suggestion
8. Click a healthy initiative (no flags, low overlap) -- no suggestions section appears
</verification>

<success_criteria>
- DATE-08 requirement satisfied: system suggests timeline adjustments for initiatives with date issues
- TimelineSuggestions component only renders when there are actionable suggestions
- Suggestions are specific to the active flags (not generic)
- Build passes, no type errors
- All DATE-01 through DATE-08 requirements complete across Plan 01 + Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/41-date-intelligence/41-02-SUMMARY.md`
</output>
