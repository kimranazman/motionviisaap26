---
phase: 24-dashboard-customization-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/date-utils.ts
  - src/components/dashboard/date-range-filter.tsx
  - src/types/dashboard.ts
autonomous: true

must_haves:
  truths:
    - "Date presets (Last 7/30/90 days, MTD, QTD, YTD) calculate correct date ranges"
    - "Date range filter component displays current selection and allows changes"
    - "Custom date range selection works with calendar picker"
  artifacts:
    - path: "src/lib/date-utils.ts"
      provides: "Date preset calculations using date-fns"
      exports: ["getDateRangeFromPreset", "DATE_PRESETS", "DatePreset"]
    - path: "src/components/dashboard/date-range-filter.tsx"
      provides: "Dashboard date filter dropdown component"
      exports: ["DateRangeFilter"]
  key_links:
    - from: "src/components/dashboard/date-range-filter.tsx"
      to: "src/lib/date-utils.ts"
      via: "getDateRangeFromPreset for preset selections"
      pattern: "getDateRangeFromPreset"
---

<objective>
Create date range filter component and utilities for dashboard filtering.

Purpose: Users can filter all dashboard widgets by date range using presets (Last 7/30/90 days, MTD, QTD, YTD) or custom dates.
Output: Date utilities and reusable date range filter component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/24-dashboard-customization-ui/24-CONTEXT.md
@.planning/phases/24-dashboard-customization-ui/24-RESEARCH.md
@src/types/dashboard.ts
@src/components/ui/popover.tsx
@src/components/ui/button.tsx
@src/components/ui/calendar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create date utilities</name>
  <files>
    - src/lib/date-utils.ts
    - src/types/dashboard.ts
  </files>
  <action>
1. Update src/types/dashboard.ts DateFilter interface to use the expanded presets:
   ```typescript
   export type DatePreset =
     | 'last7days'
     | 'last30days'
     | 'last90days'
     | 'mtd'      // Month to date
     | 'qtd'      // Quarter to date
     | 'ytd'      // Year to date
     | 'custom';

   export interface DateFilter {
     startDate: string | null;  // ISO date string
     endDate: string | null;    // ISO date string
     preset: DatePreset;
   }
   ```

2. Create src/lib/date-utils.ts:

   ```typescript
   import {
     subDays,
     startOfMonth,
     startOfQuarter,
     startOfYear,
     format,
     parseISO
   } from 'date-fns';
   import type { DatePreset, DateFilter } from '@/types/dashboard';
   ```

   Define DATE_PRESETS constant (array of {id, label}):
   - last7days: "Last 7 days"
   - last30days: "Last 30 days"
   - last90days: "Last 90 days"
   - mtd: "Month to date"
   - qtd: "Quarter to date"
   - ytd: "Year to date"
   - custom: "Custom range"

   Create getDateRangeFromPreset(preset: DatePreset): { start: Date; end: Date }:
   - last7days: subDays(today, 7) to today
   - last30days: subDays(today, 30) to today
   - last90days: subDays(today, 90) to today
   - mtd: startOfMonth(today) to today
   - qtd: startOfQuarter(today) to today
   - ytd: startOfYear(today) to today
   - custom/default: subDays(today, 30) to today (fallback)

   Create formatDateRange(filter: DateFilter): string:
   - If preset is not 'custom', return the preset label from DATE_PRESETS
   - If custom with both dates, return "MMM d - MMM d, yyyy" format
   - If missing dates, return "Select dates"

   Create createDateFilter(preset: DatePreset, customStart?: Date, customEnd?: Date): DateFilter:
   - For presets: calculate range and return with ISO strings
   - For custom: use provided dates

Export: DatePreset, DATE_PRESETS, getDateRangeFromPreset, formatDateRange, createDateFilter
  </action>
  <verify>
    - File exists at src/lib/date-utils.ts
    - TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Date utilities with preset calculations and formatting</done>
</task>

<task type="auto">
  <name>Task 2: Create date range filter component</name>
  <files>
    - src/components/dashboard/date-range-filter.tsx
  </files>
  <action>
Create src/components/dashboard/date-range-filter.tsx:

```typescript
'use client';

import { useState } from 'react';
import { Calendar, ChevronDown } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';
import { Calendar as CalendarComponent } from '@/components/ui/calendar';
import { cn } from '@/lib/utils';
import {
  DATE_PRESETS,
  getDateRangeFromPreset,
  formatDateRange,
  createDateFilter
} from '@/lib/date-utils';
import type { DateFilter, DatePreset } from '@/types/dashboard';
```

Props interface:
```typescript
interface DateRangeFilterProps {
  value: DateFilter;
  onChange: (filter: DateFilter) => void;
  className?: string;
}
```

Component structure:
1. Popover with trigger button showing:
   - Calendar icon
   - Current selection (formatDateRange(value))
   - ChevronDown icon

2. PopoverContent with two sections:
   a) Preset buttons (grid of DATE_PRESETS excluding 'custom'):
      - On click: call onChange with createDateFilter(preset)
      - Highlight selected preset

   b) Custom range section (when 'custom' selected or user clicks "Custom range"):
      - Two CalendarComponent instances (start date, end date)
      - Or use the DatePickerCalendar component if Calendar doesn't work
      - Start date picker, End date picker
      - On date select: call onChange with updated DateFilter

Styling:
- Popover width: w-80 or w-96
- Preset buttons: grid-cols-2, small buttons
- Active preset: bg-primary text-primary-foreground
- Custom calendars: flex flex-row gap-4

Close popover on preset selection (but keep open for custom range editing).
  </action>
  <verify>
    - File exists at src/components/dashboard/date-range-filter.tsx
    - Exports DateRangeFilter component
    - TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Date range filter component with presets and custom range selection</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- Date utilities calculate correct ranges for all presets
- Component renders in isolation (can test in dev tools)
</verification>

<success_criteria>
- DATE_PRESETS includes all 7 options (6 presets + custom)
- getDateRangeFromPreset returns correct Date objects for each preset
- DateRangeFilter component accepts value/onChange props
- Preset selection and custom range both work
- TypeScript types compile
</success_criteria>

<output>
After completion, create `.planning/phases/24-dashboard-customization-ui/24-02-SUMMARY.md`
</output>
