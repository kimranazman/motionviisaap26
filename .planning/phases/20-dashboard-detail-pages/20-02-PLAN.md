---
phase: 20-dashboard-detail-pages
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/dashboard/status-chart.tsx
  - src/components/dashboard/pipeline-stage-chart.tsx
  - src/components/dashboard/department-chart.tsx
autonomous: true

must_haves:
  truths:
    - "User on phone can read chart axis labels without truncation"
    - "User on phone can see chart legend without overlap"
    - "User on phone can read pipeline stage names in bar chart"
    - "Chart tooltips are accessible on touch devices"
  artifacts:
    - path: "src/components/dashboard/status-chart.tsx"
      provides: "PieChart with bottom-aligned legend for mobile"
      contains: "verticalAlign=\"bottom\""
    - path: "src/components/dashboard/pipeline-stage-chart.tsx"
      provides: "Horizontal bar chart with mobile-friendly axis"
      contains: "fontSize: 10"
    - path: "src/components/dashboard/department-chart.tsx"
      provides: "Department bar chart with mobile-friendly axis"
      contains: "fontSize: 10"
  key_links:
    - from: "src/app/(dashboard)/page.tsx"
      to: "StatusChart, PipelineStageChart, DepartmentChart"
      via: "component import"
      pattern: "<StatusChart|<PipelineStageChart|<DepartmentChart"
---

<objective>
Make dashboard charts readable and functional on mobile devices with proper legend positioning and axis labels.

Purpose: DSH-03 requires the pipeline chart to be readable on mobile. DSH-04 requires chart legends to not overflow. The horizontal bar charts need smaller font sizes and proper label handling for mobile screens.

Output: All dashboard charts render correctly on mobile with legible labels and non-overlapping legends.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-dashboard-detail-pages/20-RESEARCH.md
@src/components/dashboard/status-chart.tsx
@src/components/dashboard/pipeline-stage-chart.tsx
@src/components/dashboard/department-chart.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Status chart legend and sizing</name>
  <files>src/components/dashboard/status-chart.tsx</files>
  <action>
    Update the StatusChart PieChart for better mobile display:

    1. Increase chart container height for legend space:
       - Change `<div className="h-64">` to `<div className="h-64 md:h-72">`

    2. Adjust Pie position to make room for bottom legend:
       - Change `cy="50%"` to `cy="45%"` (moves pie slightly up)

    3. Reduce pie radius for mobile to leave legend room:
       - Change `innerRadius={50}` to `innerRadius={35}`
       - Change `outerRadius={80}` to `outerRadius={60}`

    4. Update Legend for better mobile display:
       - Keep `verticalAlign="bottom"` (already correct)
       - Change `height={36}` to `height={48}` (more room for wrapped legend items)
       - Add `iconSize={8}` prop to make legend icons smaller
       - Update wrapperStyle to add paddingTop:
         ```
         wrapperStyle={{
           paddingTop: '12px',
         }}
         ```

    5. Update legend formatter for smaller text:
       - Change `className="text-xs text-gray-600"` to `className="text-xs text-gray-600 ml-1"`
  </action>
  <verify>
    Check that:
    - Legend is positioned at bottom with adequate spacing
    - Pie chart doesn't overlap with legend
    - Legend items are readable
  </verify>
  <done>Status chart displays with non-overlapping legend on mobile</done>
</task>

<task type="auto">
  <name>Task 2: Pipeline stage chart mobile readability</name>
  <files>src/components/dashboard/pipeline-stage-chart.tsx</files>
  <action>
    Update the PipelineStageChart horizontal bar chart for mobile:

    1. Update XAxis for mobile-friendly display:
       - Change `tick={{ fontSize: 12 }}` to `tick={{ fontSize: 10 }}`
       - Update tickFormatter to use shorter currency format:
         ```typescript
         tickFormatter={(value) => {
           if (value >= 1000000) return `${(value/1000000).toFixed(0)}M`
           if (value >= 1000) return `${(value/1000).toFixed(0)}K`
           return formatCurrency(value)
         }}
         ```

    2. Update YAxis for mobile display:
       - Change `tick={{ fontSize: 12 }}` to `tick={{ fontSize: 10 }}`
       - Change `width={80}` to `width={70}` (slightly narrower to give chart more room)
       - Add tickFormatter to truncate long names:
         ```typescript
         tickFormatter={(value: string) =>
           value.length > 12 ? value.slice(0, 10) + '...' : value
         }
         ```

    3. Adjust margin for mobile:
       - Change `margin={{ left: 20 }}` to `margin={{ left: 10, right: 10 }}`
  </action>
  <verify>
    Check that:
    - Stage names are visible (truncated if too long)
    - Currency values use K/M abbreviations
    - Font size is smaller (10px)
    - Chart has proper margins
  </verify>
  <done>Pipeline stage chart is readable on mobile with proper axis formatting</done>
</task>

<task type="auto">
  <name>Task 3: Department chart mobile readability</name>
  <files>src/components/dashboard/department-chart.tsx</files>
  <action>
    Update the DepartmentChart horizontal bar chart for mobile:

    1. Update XAxis for mobile:
       - Change `tick={{ fontSize: 12 }}` to `tick={{ fontSize: 10 }}`

    2. Update YAxis for mobile display:
       - Change `tick={{ fontSize: 12 }}` to `tick={{ fontSize: 10 }}`
       - Change `width={80}` to `width={70}`
       - Add tickFormatter to truncate long department names:
         ```typescript
         tickFormatter={(value: string) =>
           value.length > 12 ? value.slice(0, 10) + '...' : value
         }
         ```

    3. Adjust margin:
       - Change `margin={{ left: 20 }}` to `margin={{ left: 10, right: 10 }}`
  </action>
  <verify>
    Check that:
    - Department names are visible
    - Font size is smaller (10px)
    - Chart fits properly on mobile
  </verify>
  <done>Department chart is readable on mobile with proper axis formatting</done>
</task>

</tasks>

<verification>
Run the development server and test charts at mobile viewport:

```bash
npm run dev
```

Test at 375px width:
1. Status chart - legend should be at bottom, not overlapping pie
2. Pipeline chart - stage names visible (may be truncated), values in K/M format
3. Department chart - department names visible, proper font size

Test touch interaction:
- Tap on chart elements to see tooltips
- Tooltips should be visible and not cut off
</verification>

<success_criteria>
- DSH-03: Pipeline stage chart is readable on mobile
- DSH-04: Chart legends don't overflow or overlap content
- All chart axis labels use appropriate font sizes (10px on mobile)
- Currency values use abbreviated format (K/M) on small screens
</success_criteria>

<output>
After completion, create `.planning/phases/20-dashboard-detail-pages/20-02-SUMMARY.md`
</output>
