---
phase: 26-revenue-model-refinement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
autonomous: true

must_haves:
  truths:
    - "Project model has potentialRevenue field for estimated revenue"
    - "aiImportedRevenue field is removed (all revenue is from AI)"
    - "Database schema is migrated without data loss"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "Updated Project model with potentialRevenue"
      contains: "potentialRevenue"
  key_links:
    - from: "prisma/schema.prisma"
      to: "database"
      via: "prisma db push"
      pattern: "potentialRevenue.*Decimal"
---

<objective>
Update Prisma schema to separate potential revenue (from deal/potential conversion) from actual revenue (from AI invoices)

Purpose: Establish data model that clearly distinguishes estimates from actuals
Output: Updated schema.prisma with potentialRevenue field, aiImportedRevenue removed, migration applied
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/26-revenue-model-refinement/26-CONTEXT.md
@.planning/phases/26-revenue-model-refinement/26-RESEARCH.md
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Project model in schema</name>
  <files>prisma/schema.prisma</files>
  <action>
Update the Project model (around line 384):

1. ADD `potentialRevenue` field:
```prisma
potentialRevenue  Decimal?  @db.Decimal(12, 2) @map("potential_revenue")
```
Add after `revenue` field.

2. REMOVE `aiImportedRevenue` field (line ~389):
```prisma
// DELETE THIS LINE:
aiImportedRevenue Decimal?      @db.Decimal(12, 2) @map("ai_imported_revenue")
```

Final Project model revenue fields should be:
```prisma
revenue           Decimal?        @db.Decimal(12, 2)  // Actual revenue from AI invoices
potentialRevenue  Decimal?        @db.Decimal(12, 2) @map("potential_revenue")  // From deal/potential conversion
```

Keep all other fields unchanged.
  </action>
  <verify>
grep -A 5 "revenue.*Decimal" prisma/schema.prisma
# Should show revenue and potentialRevenue, NOT aiImportedRevenue
  </verify>
  <done>Schema has potentialRevenue field and aiImportedRevenue is removed</done>
</task>

<task type="auto">
  <name>Task 2: Apply schema migration</name>
  <files>prisma/schema.prisma</files>
  <action>
Run Prisma push to apply schema changes to database:

```bash
npx prisma db push
```

This will:
1. Add potential_revenue column to projects table
2. Remove ai_imported_revenue column from projects table

NOTE: Data migration for existing projects will be handled by the application - any project with revenue > 0 that came from a deal/potential (has sourceDeal or sourcePotential) should treat that as potentialRevenue. Since this is a refinement, we accept that existing data may need manual adjustment if needed. The main goal is that NEW conversions will correctly set potentialRevenue.

After push, generate Prisma client:

```bash
npx prisma generate
```
  </action>
  <verify>
npx prisma db push --accept-data-loss 2>&1 | tail -5
# Should show success, no errors
  </verify>
  <done>Database has potential_revenue column, ai_imported_revenue column removed</done>
</task>

</tasks>

<verification>
1. Run `npx prisma format` - schema is valid
2. Run `npx prisma validate` - no errors
3. Check schema has potentialRevenue, no aiImportedRevenue
4. Prisma client generated successfully
</verification>

<success_criteria>
- Project model has potentialRevenue field with Decimal(12,2)
- aiImportedRevenue field is removed from Project model
- Database schema updated via prisma db push
- Prisma client regenerated with new types
</success_criteria>

<output>
After completion, create `.planning/phases/26-revenue-model-refinement/26-01-SUMMARY.md`
</output>
