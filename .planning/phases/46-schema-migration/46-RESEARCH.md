# Phase 46: Schema Migration - Research

**Researched:** 2026-01-27
**Domain:** Prisma ORM Schema Migration (MySQL/MariaDB), OKR data model restructure
**Confidence:** HIGH

## Summary

Phase 46 transforms the database schema from a flat Initiative-centric model (keyResult as a `String @db.VarChar(20)`) to a proper relational OKR hierarchy with `KeyResult`, `SupportTask`, and `SupportTaskKeyResult` as first-class Prisma models. This is a **breaking schema change** that adds 3 new models, 4 new enums, and modifies the existing `Initiative` model by adding new fields and removing 7 old ones.

The project has historically used `prisma db push` for all schema changes (no `prisma/migrations/` directory exists). The v2.0 project research recommends switching to `prisma migrate dev` for this structural change to get versioned SQL migrations. However, the MariaDB FK drift loop bug (GitHub #11242, #10900) is a known risk that requires using `--create-only` and batching all FK changes into a single migration.

Since the v2.0 approach is wipe-and-reseed from Excel, data preservation is not a concern. The simplest approach is: edit schema, generate migration with `--create-only`, review SQL, apply. The seed script (Phase 47) will repopulate all OKR data.

**Primary recommendation:** Edit `prisma/schema.prisma` with all model/enum/field changes in one pass, then generate a single migration using `npx prisma migrate dev --create-only --name v2_okr_restructure`. Review the generated SQL for any MariaDB FK drift artifacts. Apply once clean.

## Standard Stack

The established libraries/tools for this domain:

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| Prisma ORM | 6.19.2 | Schema definition, migration, client generation | Already used; only ORM in the project |
| @prisma/client | 6.19.2 | Generated database client | Auto-generated from schema |
| MariaDB (mysql provider) | Via Docker on NAS | Database engine | Already deployed; `datasource db { provider = "mysql" }` |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| tsx | 4.21.0 | TypeScript execution for seed scripts | Already available; used by `seed-admin.ts` and `seed-cost-categories.ts` |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| `prisma migrate dev` | `prisma db push` | Project historically uses `db push`. But `migrate dev` gives versioned SQL files for this structural change. Since this is a one-time restructure, `migrate dev` is better for auditability and MariaDB drift control. |
| Single migration | Multiple incremental migrations | Single migration avoids MariaDB FK drift loop. Multiple migrations increase risk of redundant FK drop/recreate. |

## Architecture Patterns

### Recommended Project Structure

No new files are created in Phase 46 (schema only). The changes are confined to:

```
prisma/
  schema.prisma          # Modified (new models, enums, Initiative field changes)
  migrations/
    20260127_v2_okr_restructure/
      migration.sql      # Generated by prisma migrate dev --create-only
```

### Pattern 1: Existing ID Convention (CUID Strings)

**What:** All models in the schema use `String @id @default(cuid())` for primary keys. The requirements doc mentions `keyResultId (Int, FK to KeyResult)` and `id (Int, autoincrement)` for SupportTask -- these MUST be adapted to the codebase convention of CUID strings, not integers.

**When to use:** Always. Every model follows this pattern.

**Example:**
```prisma
// Source: Existing schema pattern (all 20+ models use this)
model KeyResult {
  id String @id @default(cuid())
  // ...
}
```

**Confidence: HIGH** -- Verified against all existing models in schema.prisma. Using Int autoincrement would break the established convention and require different FK types across the codebase.

**Note on SCHEMA-04/06:** The requirements say `keyResultId (Int)` and SupportTask `id (Int, autoincrement)`. This is an error in the requirements spec -- it contradicts the codebase convention. The implementation MUST use `String @id @default(cuid())` and `keyResultId String` to match every other model and FK in the schema.

### Pattern 2: Foreign Key Naming Convention

**What:** camelCase in Prisma, snake_case in database via `@map()`.

**Example:**
```prisma
// Source: Existing Deal, Contact, Cost models in schema
keyResultId String @map("key_result_id")
keyResult   KeyResult @relation(fields: [keyResultId], references: [id])
```

### Pattern 3: Table Mapping Convention

**What:** `@@map("snake_case_plural")` on every model.

**Example:**
```prisma
// Source: All existing models
@@map("key_results")
@@map("support_tasks")
@@map("support_task_key_results")
```

### Pattern 4: Explicit Join Table (Following TaskTag)

**What:** Many-to-many relationships use explicit join models, not implicit Prisma M:N syntax. The existing `TaskTag` model (lines 756-773) is the exact template.

**Example:**
```prisma
// Source: Existing TaskTag pattern (schema.prisma lines 756-773)
model SupportTaskKeyResult {
  id            String      @id @default(cuid())

  supportTaskId String      @map("support_task_id")
  supportTask   SupportTask @relation(fields: [supportTaskId], references: [id], onDelete: Cascade)

  keyResultId   String      @map("key_result_id")
  keyResult     KeyResult   @relation(fields: [keyResultId], references: [id], onDelete: Cascade)

  createdAt     DateTime    @default(now())

  @@unique([supportTaskId, keyResultId])
  @@index([supportTaskId])
  @@index([keyResultId])
  @@map("support_task_key_results")
}
```

### Pattern 5: Enum Naming Convention

**What:** SCREAMING_SNAKE_CASE for enum values, PascalCase for enum names.

**Example:**
```prisma
// Source: All existing enums (InitiativeStatus, DealStage, etc.)
enum MetricType {
  REVENUE
  COUNT
}
enum SupportTaskCategory {
  DESIGN_CREATIVE
  BUSINESS_ADMIN
  TALENTA_IDEAS
  OPERATIONS
}
```

### Anti-Patterns to Avoid

- **Using Int autoincrement IDs:** The requirements say `Int` but the codebase uses `String @default(cuid())`. Follow the codebase, not the requirements spec for ID types.
- **Using implicit M:N:** Prisma's implicit many-to-many creates a hidden join table with no PK. Use explicit join model matching the TaskTag pattern.
- **Splitting into multiple migrations:** MariaDB FK drift loop (GitHub #11242) makes incremental FK migrations dangerous. Batch everything into one migration.
- **Making keyResultId required on Initiative:** Make it `String?` (nullable) so the migration can apply to existing data without needing a default. After seed runs, all values will be populated.

## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Migration SQL | Custom SQL scripts | `prisma migrate dev --create-only` | Prisma generates correct ALTER TABLE statements for MariaDB |
| FK constraint ordering | Manual ordering logic | Prisma's migration engine | Handles dependency graph automatically |
| Join table structure | Implicit M:N or raw SQL | Explicit Prisma model (TaskTag pattern) | Full API support, customizable, PK included |
| Enum changes in MariaDB | Raw ALTER TABLE MODIFY | Prisma migration with `--create-only` review | Prisma handles MySQL enum column DDL, but review generated SQL for correctness |

**Key insight:** The only manual intervention needed is reviewing the generated migration SQL before applying it (to catch MariaDB FK drift artifacts). Everything else should be generated by Prisma.

## Common Pitfalls

### Pitfall 1: MariaDB FK Drift Loop (C3 from Roadmap)

**What goes wrong:** `prisma migrate dev` generates redundant migrations that drop and recreate foreign keys on every run when used with MariaDB. This creates an infinite migration loop.

**Why it happens:** MariaDB stores FK metadata differently from MySQL 8. Prisma's introspection sees FKs as "changed" on each run. Documented in [GitHub #11242](https://github.com/prisma/prisma/issues/11242) and [#10900](https://github.com/prisma/prisma/issues/10900). As of Prisma 6.19.2, this issue is NOT fully resolved.

**How to avoid:**
1. Use `--create-only` flag to generate SQL without applying
2. Review generated SQL for redundant `DROP FOREIGN KEY` / `ADD CONSTRAINT` pairs
3. Remove any redundant FK operations from the SQL
4. Apply once with `npx prisma migrate dev` (which will see the edited file and apply it)
5. If drift is detected on next run, use `prisma migrate resolve --applied <name>` to stop the loop
6. Batch ALL FK changes into ONE migration -- do not create separate migrations for each model

**Warning signs:** Running `prisma migrate dev` a second time (without schema changes) generates a new migration.

### Pitfall 2: Non-Nullable Field on Existing Data

**What goes wrong:** Making `keyResultId` required (`String` without `?`) on Initiative will fail if any existing initiative rows lack a value. Since the project is wiping and reseeding, this is only a problem if the migration is applied before the seed runs.

**Why it happens:** Prisma generates `ALTER TABLE initiatives ADD COLUMN key_result_id VARCHAR(191) NOT NULL` which fails on existing rows.

**How to avoid:** Make `keyResultId String?` (nullable). The seed will populate all values. If you want a non-null constraint, add it in a later migration after seed.

**Warning signs:** Migration fails with "Cannot add a NOT NULL column without default value."

### Pitfall 3: Dropping Columns Loses Data (C4 from Roadmap)

**What goes wrong:** Removing KPI fields (`kpiTarget`, `kpiActual`, etc.) and `monthlyObjective`/`weeklyTasks` from Initiative permanently deletes that data.

**Why it happens:** Prisma migration generates `ALTER TABLE initiatives DROP COLUMN kpi_target, ...` which is irreversible.

**How to avoid:** This is **acceptable** per prior decisions. The seed will repopulate from the v2 Excel. The old KPI data lived on initiatives; the new data lives on KeyResult. No data preservation needed.

**Warning signs:** None -- this is intentional. Just verify the migration SQL includes the expected DROP COLUMN statements.

### Pitfall 4: Enum Value Mismatch Between Requirements and Codebase

**What goes wrong:** The requirements specify `KeyResultStatus` with values `NOT_STARTED, ON_TRACK, AT_RISK, BEHIND, ACHIEVED`. The existing `InitiativeStatus` has different values: `NOT_STARTED, IN_PROGRESS, ON_HOLD, AT_RISK, COMPLETED, CANCELLED`. These are DIFFERENT enums for different models. Creating a new enum is correct.

The requirements also specify `owner (String)` on KeyResult, but the codebase uses `TeamMember` enum for person fields (see Initiative.personInCharge, Initiative.accountable). Using a plain String for `owner` would be inconsistent.

**How to avoid:**
- Create a NEW `KeyResultStatus` enum (do not reuse `InitiativeStatus`)
- Use `owner String @db.VarChar(100)` as specified in requirements -- this is intentional because KR owners may be team names or roles, not just individual TeamMembers. The requirements explicitly say `owner (String)`.

**Warning signs:** TypeScript errors if wrong enum is used in seed/API code.

### Pitfall 5: SupportTask `taskId` Field Conflicts with Existing `Task` Model

**What goes wrong:** The schema already has a `Task` model (project tasks) and a `TaskTag` join table. Adding `SupportTask` with a `taskId` field (the "ST-001" identifier) could cause naming confusion but NOT a schema conflict since Prisma models are namespaced.

**How to avoid:** Use `taskId` as specified in SCHEMA-06 for the human-readable identifier (e.g., "ST-001"). This is a display/lookup field, not a foreign key. The `id` field remains the CUID primary key.

### Pitfall 6: `prisma db push` to `prisma migrate dev` Transition

**What goes wrong:** The project has NEVER used Prisma Migrate. Switching from `db push` to `migrate dev` requires initializing the migration history. Running `prisma migrate dev` against a database that was managed with `db push` will detect "drift" because there's no migration history.

**How to avoid:** Two options:

**Option A (Recommended -- Simplest):** Continue using `prisma db push`. The roadmap success criteria says "npx prisma migrate dev applies cleanly" but `prisma db push` achieves the same schema result without the MariaDB drift complications. Since this is a wipe-and-reseed operation, versioned migrations add complexity without benefit.

**Option B:** Use `prisma migrate dev --create-only` to bootstrap the migration history. If the existing database has data, first run `prisma migrate reset` (which will wipe the database and create the migration table). Then apply the generated migration.

**Recommendation:** Use Option A (`prisma db push`) for development and production, which is the established workflow. The success criteria can be verified by running `npx prisma db push` and `npx prisma generate` successfully. If the team specifically wants migration history for this change, use Option B with careful review.

## Code Examples

### Complete KeyResult Model (Following All Codebase Conventions)

```prisma
// Source: Requirements SCHEMA-01, SCHEMA-02, SCHEMA-03 + codebase conventions

enum MetricType {
  REVENUE
  COUNT
}

enum KeyResultStatus {
  NOT_STARTED
  ON_TRACK
  AT_RISK
  BEHIND
  ACHIEVED
}

model KeyResult {
  id          String          @id @default(cuid())
  krId        String          @unique @db.VarChar(20) // "KR1.1", "KR2.3"
  objective   Objective       // Reuse existing Objective enum
  description String          @db.VarChar(500)
  metricType  MetricType
  target      Decimal         @db.Decimal(12, 2)
  actual      Decimal         @default(0) @db.Decimal(12, 2)
  unit        String          @db.VarChar(50) // "RM", "clients", "programs"
  progress    Decimal         @default(0) @db.Decimal(5, 2) // 0.00 - 100.00
  deadline    String          @db.VarChar(50) // "Q4 2026" -- String not DateTime per M1 pitfall
  status      KeyResultStatus @default(NOT_STARTED)
  owner       String          @db.VarChar(100) // String per requirements, not TeamMember enum
  howWeMeasure String?        @map("how_we_measure") @db.Text
  notes       String?         @db.Text
  weight      Decimal         @default(1) @db.Decimal(5, 2) // For weighted objective rollup

  // Relations
  initiatives      Initiative[]
  supportTaskLinks SupportTaskKeyResult[]

  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([objective])
  @@index([status])
  @@map("key_results")
}
```

### Complete SupportTask Model

```prisma
// Source: Requirements SCHEMA-06, SCHEMA-07 + codebase conventions

enum SupportTaskCategory {
  DESIGN_CREATIVE
  BUSINESS_ADMIN
  TALENTA_IDEAS
  OPERATIONS
}

model SupportTask {
  id          String              @id @default(cuid())
  taskId      String              @unique @db.VarChar(20) // "ST-001"
  category    SupportTaskCategory
  task        String              @db.VarChar(500)
  owner       String              @db.VarChar(100) // String per requirements
  frequency   String?             @db.VarChar(50) // "Weekly", "Monthly" -- too many variations for enum per SCHEMA-06
  priority    TaskPriority        @default(MEDIUM) // Reuse existing TaskPriority enum
  notes       String?             @db.Text

  // Relations
  keyResultLinks SupportTaskKeyResult[]

  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt

  @@index([category])
  @@index([priority])
  @@map("support_tasks")
}
```

### Complete SupportTaskKeyResult Join Table

```prisma
// Source: Requirements SCHEMA-08 + TaskTag pattern (schema.prisma lines 756-773)

model SupportTaskKeyResult {
  id            String      @id @default(cuid())

  supportTaskId String      @map("support_task_id")
  supportTask   SupportTask @relation(fields: [supportTaskId], references: [id], onDelete: Cascade)

  keyResultId   String      @map("key_result_id")
  keyResult     KeyResult   @relation(fields: [keyResultId], references: [id], onDelete: Cascade)

  createdAt     DateTime    @default(now())

  @@unique([supportTaskId, keyResultId])
  @@index([supportTaskId])
  @@index([keyResultId])
  @@map("support_task_key_results")
}
```

### Initiative Model Changes

```prisma
// Source: Requirements SCHEMA-04, SCHEMA-05

model Initiative {
  id                    String           @id @default(cuid())
  sequenceNumber        Int              @unique
  objective             Objective
  // REMOVED: keyResult String @db.VarChar(20) -- replaced by FK
  department            InitiativeDepartment
  title                 String           @db.VarChar(500)
  // REMOVED: monthlyObjective String? @db.Text
  // REMOVED: weeklyTasks String? @db.Text
  startDate             DateTime
  endDate               DateTime
  resourcesFinancial    Decimal?         @db.Decimal(12, 2) // Keep existing field name
  resourcesNonFinancial String?          @db.Text           // Keep existing field name
  personInCharge        TeamMember?
  accountable           TeamMember?
  status                InitiativeStatus @default(NOT_STARTED)
  remarks               String?          @db.Text
  position              Int              @default(0)

  // NEW: FK to KeyResult (replaces keyResult string)
  keyResultId       String?      @map("key_result_id")
  keyResult         KeyResult?   @relation(fields: [keyResultId], references: [id])

  // NEW: Budget and resources fields
  budget            String?      @db.VarChar(255) // Per SCHEMA-04: String, optional
  resources         String?      @db.Text          // Per SCHEMA-04: String, optional

  // REMOVED: All KPI fields (per SCHEMA-05)
  // kpiLabel          String?  @map("kpi_label") @db.VarChar(100)
  // kpiTarget         Decimal? @map("kpi_target") @db.Decimal(12, 2)
  // kpiActual         Decimal? @map("kpi_actual") @db.Decimal(12, 2)
  // kpiUnit           String?  @map("kpi_unit") @db.VarChar(50)
  // kpiManualOverride Boolean  @default(false) @map("kpi_manual_override")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  comments Comment[]
  projects Project[]

  @@index([status])
  @@index([department])
  @@index([objective])
  @@index([personInCharge])
  @@index([startDate, endDate])
  @@index([keyResultId]) // NEW index for FK
  @@map("initiatives")
}
```

### Migration Strategy: `prisma db push` (Recommended)

```bash
# Step 1: Edit prisma/schema.prisma with all changes
# Step 2: Push schema to database
npx prisma db push

# Step 3: Regenerate client
npx prisma generate

# Step 4: Verify
npx prisma studio  # Visual inspection of new tables
```

### Migration Strategy: `prisma migrate dev` (Alternative if versioned history wanted)

```bash
# Step 1: Edit prisma/schema.prisma with all changes
# Step 2: Generate migration SQL without applying
npx prisma migrate dev --create-only --name v2_okr_restructure

# Step 3: Review generated SQL in prisma/migrations/<timestamp>_v2_okr_restructure/migration.sql
# Look for redundant DROP FOREIGN KEY / ADD CONSTRAINT pairs (MariaDB drift)
# Remove any redundant FK operations

# Step 4: Apply the reviewed migration
npx prisma migrate dev

# Step 5: If drift detected on second run, resolve it
npx prisma migrate resolve --applied <migration_folder_name>
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| `prisma db push` (all prior phases) | `prisma db push` or `prisma migrate dev` (v2.0 decision) | Phase 46 | First time considering versioned migrations |
| `keyResult` as String field | `keyResultId` FK to KeyResult model | Phase 46 | Breaking change to Initiative; 22 files affected in later phases |
| KPI fields on Initiative | Metrics on KeyResult model | Phase 46 | 7 fields removed from Initiative; 8 files affected in later phases |
| No join table for KR-Task | Explicit `SupportTaskKeyResult` | Phase 46 | New M:N pattern following existing TaskTag template |

**Deprecated/outdated:**
- Initiative `kpiLabel`, `kpiTarget`, `kpiActual`, `kpiUnit`, `kpiManualOverride` fields -- removed in this phase
- Initiative `monthlyObjective`, `weeklyTasks` fields -- removed in this phase
- Initiative `keyResult String` field -- replaced by `keyResultId` FK

## Decisions to Resolve

### Decision 1: `prisma db push` vs `prisma migrate dev`

The roadmap success criteria says `npx prisma migrate dev` applies cleanly. But:
- The project has **never** used `prisma migrate` (no migrations/ directory)
- MariaDB FK drift loop (GitHub #11242) is a known unresolved issue in Prisma 6
- `prisma db push` is simpler and has worked for all 45 prior phases
- This is a wipe-and-reseed; versioned migration history adds little value

**Recommendation:** Use `prisma db push` as the primary approach. It achieves the same schema result. The success criteria should be interpreted as "schema applies cleanly and client generates correctly" rather than literally requiring `prisma migrate dev`.

If the user insists on `prisma migrate dev`, use `--create-only` and review SQL carefully for MariaDB artifacts.

### Decision 2: Keep or Remove `resourcesFinancial` / `resourcesNonFinancial`

SCHEMA-04 says Initiative gains `budget (String, optional)` and `resources (String, optional)`. The existing schema already has `resourcesFinancial Decimal?` and `resourcesNonFinancial String?`. Options:

**Option A:** Add new `budget` and `resources` fields alongside existing ones. Remove old ones later.
**Option B:** Rename `resourcesFinancial` to `budget` and `resourcesNonFinancial` to `resources`. This is a data-preserving rename but note `resourcesFinancial` is `Decimal` while `budget` is `String` per requirements.
**Option C:** Keep `resourcesFinancial` and `resourcesNonFinancial` as-is, and add `budget String?` and `resources String?` as additional fields.

**Recommendation:** Option A -- add `budget String?` and `resources String?` as new fields. Keep old fields for now. Phase 52 (Cleanup) can remove the old fields. Since the seed wipes and repopulates, the old fields will just be null after seeding. The `budget` field is `String` (not `Decimal`) per requirements, which suggests it may contain non-numeric values like "RM5,000 - allocated from Q1 budget".

### Decision 3: SupportTask `owner` Field Type

SCHEMA-06 says `owner (String)`. The existing codebase uses `TeamMember?` enum for person fields on Initiative. SupportTask owners might include values not in the TeamMember enum (e.g., external contributors, team names).

**Recommendation:** Use `String @db.VarChar(100)` as specified. This matches the requirements and provides flexibility for non-enum owner values. The seed can map known names to strings.

## Open Questions

1. **Migration approach confirmation**
   - What we know: The roadmap says `prisma migrate dev`, but the project has always used `prisma db push`
   - What's unclear: Is the user committed to switching to `prisma migrate`, or is `db push` acceptable?
   - Recommendation: Default to `prisma db push` unless explicitly told otherwise. Both achieve the same schema result.

2. **`resourcesFinancial` / `resourcesNonFinancial` disposition**
   - What we know: New `budget` and `resources` fields are required. Old fields exist with different types.
   - What's unclear: Should old fields be removed in this phase or kept until Phase 52?
   - Recommendation: Keep old fields, add new fields. Let Phase 52 clean up.

3. **Whether `kpiAutoCalculated` exists in schema**
   - What we know: SCHEMA-05 lists `kpiAutoCalculated` for removal, but the current schema has `kpiManualOverride` (not `kpiAutoCalculated`)
   - What's unclear: Is `kpiAutoCalculated` a typo for `kpiManualOverride`?
   - Recommendation: Remove `kpiManualOverride` (the field that actually exists). The requirement likely meant this field.

## Sources

### Primary (HIGH confidence)
- `/Users/khairul/Documents/MyDev/Work/Motionvii/saap2026v2/prisma/schema.prisma` -- Full existing schema (797 lines, 20+ models, all patterns analyzed)
- `/Users/khairul/Documents/MyDev/Work/Motionvii/saap2026v2/package.json` -- Prisma 6.19.2 confirmed, `db:push` script, no migrate scripts
- `/Users/khairul/Documents/MyDev/Work/Motionvii/saap2026v2/.planning/research/v2.0-PITFALLS.md` -- C3 (MariaDB drift), C4 (KPI removal), full file impact analysis
- `/Users/khairul/Documents/MyDev/Work/Motionvii/saap2026v2/.planning/research/v2.0-ARCHITECTURE.md` -- Complete model designs, query patterns, migration strategy
- `/Users/khairul/Documents/MyDev/Work/Motionvii/saap2026v2/.planning/research/v2.0-STACK.md` -- Technology decisions, no new packages needed
- `/Users/khairul/Documents/MyDev/Work/Motionvii/saap2026v2/.planning/phases/29-schema-foundation/29-RESEARCH.md` -- Prior schema research; confirmed `db push` workflow, all codebase conventions

### Secondary (MEDIUM confidence)
- [Prisma Migrate Dev MariaDB FK Drift - GitHub #11242](https://github.com/prisma/prisma/issues/11242) -- Confirmed still open as of 2026
- [Prisma FK Drop/Recreate Loop - GitHub #10900](https://github.com/prisma/prisma/issues/10900) -- Confirmed still open
- [Prisma Customizing Migrations](https://www.prisma.io/docs/orm/prisma-migrate/workflows/customizing-migrations) -- `--create-only` workflow
- [Prisma Development and Production](https://www.prisma.io/docs/orm/prisma-migrate/workflows/development-and-production) -- `migrate dev` vs `migrate deploy`

### Tertiary (LOW confidence)
- None -- all findings verified against codebase and official sources

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH -- Prisma 6.19.2, no new packages, all patterns from existing schema
- Architecture: HIGH -- Model designs verified against codebase conventions and requirements
- Pitfalls: HIGH -- MariaDB FK drift documented in GitHub issues; all other pitfalls from direct schema analysis

**Research date:** 2026-01-27
**Valid until:** 2026-03-27 (60 days -- Prisma schema patterns stable; MariaDB drift issue unlikely to be fixed soon)
