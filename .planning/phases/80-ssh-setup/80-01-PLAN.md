# Phase 80: SSH Setup & Test

## Goal
Verify NAS can SSH to Mac and run Claude without password prompt.

## Status
**MANUAL SETUP REQUIRED** - This phase requires infrastructure configuration that cannot be automated.

## Current State (Detected)
- **Mac IP Address**: 192.168.100.148
- **Mac Username**: khairul
- **Mac Hostname**: Khairuls-MacBook-Pro.local
- **Remote Login Status**: DISABLED (SSH connection refused on port 22)
- **NAS Host**: 192.168.1.20 (adminmotionvii user)

## Required Manual Steps

### Step 1: Enable Remote Login on Mac
1. Open **System Settings** (or System Preferences)
2. Navigate to **General** → **Sharing**
3. Enable **Remote Login**
4. Ensure "All users" is selected, or add specific users who can log in

### Step 2: Generate SSH Key on NAS Docker Container
SSH into the NAS and access the Docker container:
```bash
# SSH to NAS
ssh adminmotionvii@192.168.1.20

# Access the running app container
sudo /usr/local/bin/docker exec -it saap2026-app /bin/sh

# Generate SSH key (if not exists)
ssh-keygen -t ed25519 -C "saap-nas-to-mac" -N "" -f ~/.ssh/id_ed25519

# Display the public key
cat ~/.ssh/id_ed25519.pub
```

### Step 3: Copy Public Key to Mac
On the Mac, add the NAS container's public key to authorized_keys:
```bash
# Create .ssh directory if it doesn't exist
mkdir -p ~/.ssh
chmod 700 ~/.ssh

# Add the public key (paste the key from Step 2)
echo "ssh-ed25519 AAAA... saap-nas-to-mac" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

### Step 4: Test SSH Connection from NAS Container
```bash
# From inside the NAS Docker container
ssh -o StrictHostKeyChecking=no khairul@192.168.100.148 "echo hello"
```
Expected output: `hello`

### Step 5: Test Claude Command
```bash
# From inside the NAS Docker container
ssh khairul@192.168.100.148 "cd /Users/khairul/Documents/MyDev/Work/Motionvii/saap2026v2 && claude --version"
```
Expected output: Claude version info

## Environment Variables to Add
After SSH setup is complete, add these to the NAS docker-compose.yml:
```yaml
environment:
  - MAC_SSH_HOST=192.168.100.148
  - MAC_SSH_USER=khairul
  - MAC_PROJECT_PATH=/Users/khairul/Documents/MyDev/Work/Motionvii/saap2026v2
```

## Success Criteria
- [ ] Mac has Remote Login enabled (System Settings → General → Sharing)
- [ ] Mac's local IP address documented: **192.168.100.148**
- [ ] SSH key generated on NAS and copied to Mac
- [ ] `ssh khairul@192.168.100.148 "echo hello"` works without password
- [ ] `ssh khairul@192.168.100.148 "cd /path/to/saap && claude --version"` executes successfully

## Network Notes
- Mac IP (192.168.100.148) is on a different subnet than NAS (192.168.1.20)
- Ensure network routing allows NAS to reach Mac's subnet
- If subnets can't communicate, VPN or network bridge may be needed

## Troubleshooting

### SSH Connection Refused
- Verify Remote Login is enabled on Mac
- Check Mac firewall settings (System Settings → Network → Firewall)
- Verify Mac IP hasn't changed (use `ipconfig getifaddr en0`)

### Permission Denied
- Verify public key is correctly added to ~/.ssh/authorized_keys
- Check permissions: ~/.ssh (700), authorized_keys (600)
- Try verbose SSH: `ssh -v khairul@192.168.100.148`

### Network Unreachable
- Different subnets (192.168.100.x vs 192.168.1.x) may not route by default
- Check if both devices are on the same network
- Verify with: `ping 192.168.100.148` from NAS

---
*Plan created: 2026-01-29*
*Type: Manual Infrastructure Setup*
