---
phase: 56-member-workload-dashboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/member-utils.ts
  - src/app/(dashboard)/members/page.tsx
  - src/components/members/members-overview.tsx
  - src/components/members/member-card.tsx
autonomous: true

must_haves:
  truths:
    - "User navigates to /members and sees 3 member cards"
    - "Each card shows member name, avatar with colored initials, and aggregated counts for KRs, initiatives, tasks, and support tasks"
    - "User clicks a member card and navigates to /members/[name]"
  artifacts:
    - path: "src/lib/member-utils.ts"
      provides: "MEMBER_PROFILES constant, getMemberBySlug(), getMemberByEnum(), isItemOverdue(), isItemAtRisk(), shouldHighlightRed(), getStatusBreakdown()"
      contains: "MEMBER_PROFILES"
    - path: "src/app/(dashboard)/members/page.tsx"
      provides: "Server component overview page with parallel Prisma queries"
      contains: "force-dynamic"
    - path: "src/components/members/members-overview.tsx"
      provides: "Grid layout rendering 3 member cards"
      min_lines: 15
    - path: "src/components/members/member-card.tsx"
      provides: "Individual card with avatar, name, 4 count badges, link to detail"
      min_lines: 40
  key_links:
    - from: "src/app/(dashboard)/members/page.tsx"
      to: "prisma"
      via: "Promise.all querying initiative, task, keyResult, supportTask"
      pattern: "Promise\\.all"
    - from: "src/components/members/member-card.tsx"
      to: "/members/[slug]"
      via: "Next.js Link"
      pattern: "href.*members/"
---

<objective>
Create the /members overview page showing 3 team member cards with aggregated workload counts, plus the shared member-utils.ts utility layer that both this plan and Plan 02 will use.

Purpose: Delivers the entry point for the member workload dashboard (MBR-01, MBR-02, MBR-03) and establishes the utility foundation for the detail page.
Output: Working /members page with 3 clickable cards, member-utils.ts with profiles/helpers.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/56-member-workload-dashboard/56-RESEARCH.md

Key existing files to reference:
@src/app/(dashboard)/tasks/page.tsx (server component pattern)
@src/components/dashboard/team-workload.tsx (TEAM_COLORS, TEAM_INITIALS, Avatar pattern)
@src/lib/utils.ts (formatTeamMember, formatStatus, getStatusColor, cn)
@src/lib/task-utils.ts (formatTaskStatus, getTaskStatusColor, formatTaskPriority, getTaskPriorityColor)
@src/components/support-tasks/support-tasks-view.tsx (CATEGORY_LABELS, CATEGORY_COLORS constants)
@src/components/objectives/key-result-group.tsx (getKrStatusColor, formatKrStatus, getProgressBarColor)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create member-utils.ts utility layer</name>
  <files>src/lib/member-utils.ts</files>
  <action>
Create `src/lib/member-utils.ts` with the following exports:

**MemberProfile interface:**
```typescript
export interface MemberProfile {
  enumValue: string   // "KHAIRUL" (TeamMember enum)
  name: string        // "Khairul" (matches KR/ST owner strings)
  slug: string        // "khairul" (URL slug for /members/[name])
  initials: string    // "KH"
  color: string       // "bg-blue-600"
}
```

**MEMBER_PROFILES constant:**
```typescript
export const MEMBER_PROFILES: MemberProfile[] = [
  { enumValue: 'KHAIRUL', name: 'Khairul', slug: 'khairul', initials: 'KH', color: 'bg-blue-600' },
  { enumValue: 'AZLAN', name: 'Azlan', slug: 'azlan', initials: 'AZ', color: 'bg-green-600' },
  { enumValue: 'IZYANI', name: 'Izyani', slug: 'izyani', initials: 'IZ', color: 'bg-purple-600' },
]
```

**Lookup functions:**
- `getMemberBySlug(slug: string): MemberProfile | undefined` -- finds by lowercase slug
- `getMemberByEnum(enumValue: string): MemberProfile | undefined` -- finds by enum value

**Overdue/At-Risk helpers (for Plan 02 but define now):**
- `isItemOverdue(dueDate: string | null, status: string): boolean` -- returns false for null dates and completed statuses (DONE, COMPLETED, ACHIEVED, CANCELLED), true if date is past
- `isItemAtRisk(status: string): boolean` -- returns true for AT_RISK or BEHIND
- `shouldHighlightRed(status: string, dueDate?: string | null): boolean` -- combines both checks

**Status breakdown helper:**
- `getStatusBreakdown(items: Array<{ status: string }>): Array<{ status: string; label: string; count: number }>` -- groups items by status, formats label using replace(/_/g, ' ') title-case, filters out zero counts

**KR status helpers (extracted from key-result-group.tsx for reuse):**
- `getKrStatusColor(status: string): string` -- same mapping as key-result-group.tsx
- `formatKrStatus(status: string): string` -- same mapping
- `getProgressBarColor(progress: number): string` -- same mapping

Do NOT import from component files. Duplicate the small constant maps so member-utils is self-contained. The component file versions remain for backward compatibility.
  </action>
  <verify>
Run `npx tsc --noEmit` and confirm no type errors. Grep for MEMBER_PROFILES export in the file.
  </verify>
  <done>
member-utils.ts exports MemberProfile interface, MEMBER_PROFILES array with 3 members, getMemberBySlug, getMemberByEnum, isItemOverdue, isItemAtRisk, shouldHighlightRed, getStatusBreakdown, getKrStatusColor, formatKrStatus, getProgressBarColor.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create /members overview page with server data fetching and member cards</name>
  <files>
    src/app/(dashboard)/members/page.tsx
    src/components/members/members-overview.tsx
    src/components/members/member-card.tsx
  </files>
  <action>
**Server page (`src/app/(dashboard)/members/page.tsx`):**

Follow the exact pattern from `src/app/(dashboard)/tasks/page.tsx`:
- `export const dynamic = 'force-dynamic'`
- Import prisma, Header, MembersOverview, MEMBER_PROFILES
- Create `getMemberOverviewData()` async function that uses `Promise.all` to query all 4 models in parallel:
  1. `prisma.initiative.groupBy({ by: ['personInCharge'], _count: true })` -- count initiatives per personInCharge
  2. `prisma.task.groupBy({ by: ['assignee'], where: { parentId: null }, _count: true })` -- count root tasks per assignee
  3. `prisma.keyResult.findMany({ select: { owner: true } })` -- get all KR owners for in-memory counting
  4. `prisma.supportTask.findMany({ select: { owner: true } })` -- get all ST owners for in-memory counting

- Map over MEMBER_PROFILES to aggregate counts per member:
  - `initiatives`: find in groupBy result where personInCharge === member.enumValue
  - `tasks`: find in groupBy result where assignee === member.enumValue
  - `keyResults`: filter KRs where owner.toUpperCase() === member.enumValue
  - `supportTasks`: filter STs where owner.toUpperCase() === member.enumValue

- Render `<Header title="Members" description="Team workload overview" />` + `<MembersOverview members={members} />`
- Use `p-3 md:p-6` for content padding (matches mobile pattern)

**MembersOverview (`src/components/members/members-overview.tsx`):**
- 'use client'
- Props: `members: Array<MemberProfile & { counts: { keyResults: number; initiatives: number; tasks: number; supportTasks: number } }>`
- Render a `grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6` with MemberCard for each member

**MemberCard (`src/components/members/member-card.tsx`):**
- 'use client'
- Wrap entire card in `<Link href={/members/${member.slug}}>` for navigation (MBR-03)
- Use shadcn Card with `hover:shadow-md transition-shadow cursor-pointer`
- CardHeader: Avatar (h-12 w-12) with AvatarFallback using member.color and member.initials, member.name as h3 (text-lg font-semibold), total items count as subtitle
- CardContent: 2x2 grid (grid-cols-2 gap-3) showing 4 count items, each with:
  - Icon from lucide-react: Target for KRs, Briefcase for Initiatives, ListChecks for Tasks, ClipboardList for Support Tasks
  - Count number (text-2xl font-bold)
  - Label text (text-xs text-gray-500)
- Import Avatar, AvatarFallback from @/components/ui/avatar
- Import Card, CardContent, CardHeader from @/components/ui/card
- Import cn from @/lib/utils
- Import Link from next/link
- Import Target, Briefcase, ListChecks, ClipboardList from lucide-react
  </action>
  <verify>
Run `npx tsc --noEmit` and confirm no type errors. Visit /members in the browser (dev server) and verify 3 cards appear with counts. Click a card and confirm it navigates to /members/[name] (will show 404 until Plan 02, that is expected).
  </verify>
  <done>
/members page renders 3 member cards with names (Khairul, Azlan, Izyani), colored avatars (blue, green, purple), and aggregated counts for KRs, initiatives, tasks, and support tasks from the database. Each card links to /members/[slug].
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. /members page loads and shows 3 member cards in a responsive grid
3. Each card shows name, avatar, and 4 count badges (KRs, initiatives, tasks, support tasks)
4. Clicking a card navigates to /members/[name] (404 expected until Plan 02)
5. member-utils.ts exports all functions listed in Task 1
</verification>

<success_criteria>
- 3 member cards visible on /members with correct counts from database
- Cards are clickable and navigate to /members/[slug]
- member-utils.ts provides all utility functions for both Plan 01 and Plan 02
- TypeScript compiles with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/56-member-workload-dashboard/56-01-SUMMARY.md`
</output>
