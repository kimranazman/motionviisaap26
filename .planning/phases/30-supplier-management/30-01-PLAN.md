---
phase: 30-supplier-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/suppliers/page.tsx
  - src/app/api/suppliers/route.ts
  - src/app/api/suppliers/[id]/route.ts
  - src/components/suppliers/supplier-list.tsx
  - src/components/suppliers/supplier-detail-modal.tsx
  - src/components/suppliers/supplier-inline-field.tsx
  - src/components/suppliers/payment-terms-select.tsx
  - src/components/layout/sidebar.tsx
  - src/components/layout/mobile-sidebar.tsx
  - src/lib/supplier-utils.ts
autonomous: true

must_haves:
  truths:
    - "User can create supplier with name, contact info, and payment terms"
    - "User can view list of all suppliers with search"
    - "User can view supplier details in modal"
    - "User can edit supplier details inline"
    - "User can delete supplier (with confirmation)"
  artifacts:
    - path: "src/app/(dashboard)/suppliers/page.tsx"
      provides: "Suppliers page with server-side data fetch"
      min_lines: 20
    - path: "src/app/api/suppliers/route.ts"
      provides: "GET list and POST create endpoints"
      exports: ["GET", "POST"]
    - path: "src/app/api/suppliers/[id]/route.ts"
      provides: "GET detail, PATCH update, DELETE endpoints"
      exports: ["GET", "PATCH", "DELETE"]
    - path: "src/components/suppliers/supplier-list.tsx"
      provides: "Client-side supplier table with search and create dialog"
      min_lines: 200
    - path: "src/components/suppliers/supplier-detail-modal.tsx"
      provides: "Modal with inline editing for supplier details"
      min_lines: 150
    - path: "src/lib/supplier-utils.ts"
      provides: "Payment terms formatters and color helpers"
      exports: ["PAYMENT_TERMS_OPTIONS", "formatPaymentTerms", "getPaymentTermsColor", "getCreditStatusBadge"]
  key_links:
    - from: "src/app/(dashboard)/suppliers/page.tsx"
      to: "prisma.supplier.findMany"
      via: "direct Prisma query"
      pattern: "prisma\\.supplier\\.findMany"
    - from: "src/components/suppliers/supplier-list.tsx"
      to: "/api/suppliers"
      via: "fetch for refresh and create"
      pattern: "fetch.*api/suppliers"
    - from: "src/components/suppliers/supplier-detail-modal.tsx"
      to: "/api/suppliers/[id]"
      via: "fetch for detail, PATCH, DELETE"
      pattern: "fetch.*api/suppliers"
    - from: "src/components/layout/sidebar.tsx"
      to: "/suppliers"
      via: "navigation Link"
      pattern: "href=./suppliers."
---

<objective>
Create supplier CRUD functionality with list page, detail modal, and navigation

Purpose: Allow users to track vendors/suppliers with contact info and credit terms (SUPP-01 to SUPP-05)
Output: Working /suppliers page with create, read, update, delete operations
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-supplier-management/30-RESEARCH.md

# Existing patterns to follow
@src/app/(dashboard)/companies/page.tsx
@src/components/companies/company-list.tsx
@src/components/companies/company-detail-modal.tsx
@src/components/companies/company-inline-field.tsx
@src/app/api/companies/route.ts
@src/app/api/companies/[id]/route.ts
@src/components/layout/sidebar.tsx
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create supplier API routes and utilities</name>
  <files>
    src/app/api/suppliers/route.ts
    src/app/api/suppliers/[id]/route.ts
    src/lib/supplier-utils.ts
  </files>
  <action>
Create supplier API routes following the companies API pattern:

1. Create `src/lib/supplier-utils.ts`:
   - Export `PAYMENT_TERMS_OPTIONS` array with id/label/description for each PaymentTerms enum value (IMMEDIATE, NET_7, NET_15, NET_30, NET_45, NET_60, NET_90)
   - Export `formatPaymentTerms(terms: string | null): string` - returns human-readable label or "Not specified"
   - Export `getPaymentTermsColor(terms: string | null): string` - returns Tailwind badge classes (IMMEDIATE=red, NET_7=amber, NET_15=yellow, NET_30=blue, NET_45=indigo, NET_60=purple, NET_90=violet, default=gray)
   - Export `getCreditStatusBadge(acceptsCredit: boolean): { label: string; color: string }` - returns "Accepts Credit"/green or "No Credit"/gray

2. Create `src/app/api/suppliers/route.ts`:
   - GET: List suppliers with optional `search` query param, include `_count: { costs: true }`, order by name asc. Use requireAuth.
   - POST: Create supplier with name (required), email, phone, address, website, contactPerson, acceptsCredit (default false), paymentTerms, notes. Use requireEditor. Return 201 with created supplier including _count.

3. Create `src/app/api/suppliers/[id]/route.ts`:
   - GET: Fetch single supplier by id with all fields. Use requireAuth. Return 404 if not found.
   - PATCH: Partial update - only update fields that are provided. Use requireEditor.
   - DELETE: Delete supplier. Use requireEditor. Check for linked costs first - if `_count.costs > 0`, return 400 with error message "Cannot delete: X cost(s) linked to this supplier". Only delete if no costs linked.

Important: Follow exact patterns from `src/app/api/companies/route.ts` and `src/app/api/companies/[id]/route.ts`.
  </action>
  <verify>
Run `npm run build` - should complete without TypeScript errors.
Verify files exist:
- `ls src/app/api/suppliers/route.ts`
- `ls src/app/api/suppliers/[id]/route.ts`
- `ls src/lib/supplier-utils.ts`
  </verify>
  <done>
API routes for supplier CRUD operations exist and TypeScript compiles successfully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create supplier list page with create dialog</name>
  <files>
    src/app/(dashboard)/suppliers/page.tsx
    src/components/suppliers/supplier-list.tsx
    src/components/suppliers/payment-terms-select.tsx
  </files>
  <action>
Create the suppliers page and list component following the companies pattern:

1. Create `src/components/suppliers/payment-terms-select.tsx`:
   - Client component with Select dropdown for PaymentTerms enum values
   - Props: `value: string | null`, `onValueChange: (value: string | null) => void`, `disabled?: boolean`
   - Use PAYMENT_TERMS_OPTIONS from supplier-utils for options
   - Include "Not specified" option that sets value to null
   - Use Radix Select component from shadcn/ui

2. Create `src/components/suppliers/supplier-list.tsx`:
   - Client component following `company-list.tsx` pattern exactly
   - Props: `initialData: Supplier[]` where Supplier has id, name, email, phone, address, website, contactPerson, acceptsCredit, paymentTerms, notes, createdAt, _count.costs
   - State: suppliers, search, isCreateOpen, selectedSupplierId, isDetailOpen
   - Search filters by name (case-insensitive contains)
   - Create dialog with fields:
     * Name (required, Input)
     * Email (optional, Input)
     * Phone (optional, Input)
     * Contact Person (optional, Input)
     * Accepts Credit (Checkbox/Switch)
     * Payment Terms (PaymentTermsSelect)
     * Notes (optional, Textarea)
   - Table columns: Name (with Truck icon), Email, Costs count, Payment Terms (as badge with color), Added date
   - Row click opens detail modal
   - Use Truck icon from lucide-react instead of Building2
   - Import and use SupplierDetailModal (created in next task)

3. Create `src/app/(dashboard)/suppliers/page.tsx`:
   - Server component following `companies/page.tsx` pattern
   - Fetch suppliers with `prisma.supplier.findMany` including `_count: { select: { costs: true } }`
   - Pass to SupplierList as initialData
   - Page title: "Suppliers", subtitle: "Manage your vendors and track spending"
  </action>
  <verify>
Run `npm run build` - should compile (may warn about missing SupplierDetailModal import, that's OK for now).
Files exist:
- `ls src/app/(dashboard)/suppliers/page.tsx`
- `ls src/components/suppliers/supplier-list.tsx`
- `ls src/components/suppliers/payment-terms-select.tsx`
  </verify>
  <done>
Suppliers page renders with list table, search, and create dialog. Page is accessible at /suppliers.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create supplier detail modal and add navigation</name>
  <files>
    src/components/suppliers/supplier-detail-modal.tsx
    src/components/suppliers/supplier-inline-field.tsx
    src/components/layout/sidebar.tsx
    src/components/layout/mobile-sidebar.tsx
  </files>
  <action>
Create the detail modal and update navigation:

1. Create `src/components/suppliers/supplier-inline-field.tsx`:
   - Copy pattern from `company-inline-field.tsx`
   - Client component for inline text editing
   - Props: value, onSave, placeholder, className?, multiline?
   - Shows text display, on click becomes input/textarea
   - onBlur or Enter saves, Escape cancels
   - Shows loading state during save

2. Create `src/components/suppliers/supplier-detail-modal.tsx`:
   - Client component following `company-detail-modal.tsx` pattern
   - Props: supplierId (string|null), open, onOpenChange, onDeleted, onUpdated
   - Fetch supplier from `/api/suppliers/[id]` on open
   - Sections:
     a) Header with inline-editable name
     b) Contact info grid (email, phone, address, website, contact person) - all inline editable
     c) Credit terms section:
        - Checkbox/Switch for acceptsCredit with label
        - PaymentTermsSelect for paymentTerms
        - Show badges for current status using getCreditStatusBadge and getPaymentTermsColor
     d) Notes (inline editable textarea)
     e) Separator
     f) Summary Card showing:
        - Cost count (from _count.costs)
        - "View price list and projects in next update" placeholder text
     g) Footer with Delete button (AlertDialog confirm) and Close button
   - Delete handler: calls DELETE /api/suppliers/[id], shows error if costs linked
   - handleFieldSave: PATCH /api/suppliers/[id] with single field update

3. Update `src/components/layout/sidebar.tsx`:
   - Add Truck import from lucide-react
   - Add Suppliers link in CRM section, after Projects:
     ```tsx
     <Link
       href="/suppliers"
       className={cn(
         'flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium transition-colors',
         pathname.startsWith('/suppliers')
           ? 'bg-gray-100 text-gray-900'
           : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900'
       )}
     >
       <Truck className="h-5 w-5" />
       Suppliers
     </Link>
     ```

4. Update `src/components/layout/mobile-sidebar.tsx`:
   - Add same Suppliers link in CRM section, matching the existing link pattern
  </action>
  <verify>
Run `npm run build` - should complete without errors.
Run `npm run dev` and verify:
1. Navigate to /suppliers - page loads with empty state or list
2. Click "Add Supplier" - create dialog opens
3. Create a supplier with name "Test Supplier"
4. Supplier appears in list
5. Click supplier row - detail modal opens
6. Edit name inline - saves correctly
7. Delete supplier - confirmation appears, supplier removed
8. Sidebar shows "Suppliers" link under CRM section
  </verify>
  <done>
Supplier detail modal works with inline editing. Navigation includes Suppliers link. Full CRUD flow functional.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build verification:
   - `npm run build` completes without errors

2. Functional verification (manual):
   - Navigate to /suppliers from sidebar
   - Create supplier with: name, email, phone, contact person, accepts credit ON, payment terms Net 30, notes
   - Supplier appears in list with correct badges
   - Click supplier - detail modal shows all fields
   - Edit each field inline - changes persist
   - Toggle accepts credit - badge updates
   - Change payment terms - badge updates
   - Delete supplier (should work since no costs linked)

3. API verification:
   - GET /api/suppliers returns list with _count
   - POST /api/suppliers creates and returns supplier
   - GET /api/suppliers/[id] returns single supplier
   - PATCH /api/suppliers/[id] updates fields
   - DELETE /api/suppliers/[id] removes supplier
</verification>

<success_criteria>
- Supplier list page renders at /suppliers
- User can create supplier with all fields (SUPP-01, SUPP-02)
- User can search suppliers by name (SUPP-03)
- User can edit supplier details inline (SUPP-04)
- User can delete supplier with confirmation (SUPP-05)
- Navigation shows Suppliers in CRM section
- All API routes protected with auth
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/30-supplier-management/30-01-SUMMARY.md`
</output>
