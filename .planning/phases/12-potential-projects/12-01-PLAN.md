---
phase: 12-potential-projects
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/potential-utils.ts
  - src/app/api/potential-projects/route.ts
  - src/app/api/potential-projects/[id]/route.ts
  - src/app/api/potential-projects/reorder/route.ts
  - src/components/potential-projects/potential-board.tsx
  - src/components/potential-projects/potential-column.tsx
  - src/components/potential-projects/potential-card.tsx
  - src/components/potential-projects/potential-form-modal.tsx
  - src/components/potential-projects/potential-detail-sheet.tsx
  - src/components/potential-projects/potential-metrics.tsx
  - src/app/(dashboard)/potential-projects/page.tsx
  - src/components/layout/sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User sees potential projects in Kanban board with 3 stages (Potential, Confirmed, Cancelled)"
    - "User can create potential project with title, description, estimated value, company, and contact"
    - "User can drag potential project between stages"
    - "User can edit potential project details"
    - "User can delete potential project with confirmation"
  artifacts:
    - path: "src/lib/potential-utils.ts"
      provides: "Stage configuration and formatters for 3 stages"
      exports: ["POTENTIAL_STAGES", "formatPotentialStage", "getPotentialStageColor"]
    - path: "src/app/api/potential-projects/route.ts"
      provides: "GET/POST API for potential projects"
      exports: ["GET", "POST"]
    - path: "src/app/api/potential-projects/[id]/route.ts"
      provides: "GET/PATCH/DELETE API for single potential project"
      exports: ["GET", "PATCH", "DELETE"]
    - path: "src/app/api/potential-projects/reorder/route.ts"
      provides: "Batch position/stage update for drag-and-drop"
      exports: ["PATCH"]
    - path: "src/components/potential-projects/potential-board.tsx"
      provides: "Main Kanban board with DndContext"
      min_lines: 150
    - path: "src/components/potential-projects/potential-form-modal.tsx"
      provides: "Create potential project dialog"
      min_lines: 80
    - path: "src/components/potential-projects/potential-detail-sheet.tsx"
      provides: "Edit/delete slide-out sheet"
      min_lines: 100
    - path: "src/app/(dashboard)/potential-projects/page.tsx"
      provides: "Server component page"
      contains: "prisma.potentialProject.findMany"
  key_links:
    - from: "src/components/potential-projects/potential-board.tsx"
      to: "/api/potential-projects/reorder"
      via: "fetch in handleDragEnd"
      pattern: "fetch.*api/potential-projects/reorder"
    - from: "src/components/potential-projects/potential-form-modal.tsx"
      to: "/api/potential-projects"
      via: "fetch POST"
      pattern: "fetch.*api/potential-projects.*POST"
    - from: "src/components/potential-projects/potential-detail-sheet.tsx"
      to: "/api/potential-projects/[id]"
      via: "fetch PATCH/DELETE"
      pattern: "fetch.*api/potential-projects/"
    - from: "src/components/layout/sidebar.tsx"
      to: "/potential-projects"
      via: "Link href"
      pattern: "href=\"/potential-projects\""
---

<objective>
Build Potential Projects Kanban board for tracking repeat client opportunities

Purpose: Allow users to manage repeat client pipeline with 3-stage tracking (Potential, Confirmed, Cancelled). This is a simplified version of the Sales Pipeline for existing client opportunities.

Output: Complete Kanban board with create/edit/delete functionality, accessible via sidebar navigation under CRM section.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-potential-projects/12-RESEARCH.md

Reference implementations to copy and adapt:
@src/lib/pipeline-utils.ts
@src/app/api/deals/route.ts
@src/app/api/deals/[id]/route.ts
@src/app/api/deals/reorder/route.ts
@src/components/pipeline/pipeline-board.tsx
@src/components/pipeline/pipeline-column.tsx
@src/components/pipeline/pipeline-card.tsx
@src/components/pipeline/pipeline-metrics.tsx
@src/components/pipeline/deal-form-modal.tsx
@src/components/pipeline/deal-detail-sheet.tsx
@src/components/pipeline/company-select.tsx
@src/components/pipeline/contact-select.tsx
@src/app/(dashboard)/pipeline/page.tsx
@src/components/layout/sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create API routes and utilities for potential projects</name>
  <files>
    src/lib/potential-utils.ts
    src/app/api/potential-projects/route.ts
    src/app/api/potential-projects/[id]/route.ts
    src/app/api/potential-projects/reorder/route.ts
  </files>
  <action>
    Create potential-utils.ts by adapting pipeline-utils.ts:
    - Define POTENTIAL_STAGES with 3 stages: POTENTIAL (blue-400), CONFIRMED (green-500), CANCELLED (gray-400)
    - Export PotentialStageId type
    - Export formatPotentialStage() and getPotentialStageColor() functions

    Create /api/potential-projects/route.ts by adapting /api/deals/route.ts:
    - GET: Return all potentialProjects with company and contact includes, ordered by stage and position
    - POST: Create new potential project in POTENTIAL stage with auto-calculated position
    - Import PotentialStage from @prisma/client (NOT DealStage)
    - Use estimatedValue field (NOT value) with Decimal parsing

    Create /api/potential-projects/[id]/route.ts by adapting /api/deals/[id]/route.ts:
    - GET: Return single potential project with company/contact includes
    - PATCH: Update potential project, include stageChangedAt if stage changes
    - DELETE: Delete potential project
    - No lostReason field - remove that logic entirely

    Create /api/potential-projects/reorder/route.ts by adapting /api/deals/reorder/route.ts:
    - PATCH: Accept updates array with id, position, stage
    - Update all items in transaction
    - Include stageChangedAt update when stage changes
    - No lostReason handling - remove that logic entirely
  </action>
  <verify>
    curl http://localhost:3000/api/potential-projects returns 200 with empty array or existing data
    TypeScript compiles without errors: npm run build (check for PotentialStage import)
  </verify>
  <done>
    API endpoints respond correctly: GET returns array, POST creates with POTENTIAL stage, PATCH updates, DELETE removes
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Kanban board components and page</name>
  <files>
    src/components/potential-projects/potential-board.tsx
    src/components/potential-projects/potential-column.tsx
    src/components/potential-projects/potential-card.tsx
    src/components/potential-projects/potential-form-modal.tsx
    src/components/potential-projects/potential-detail-sheet.tsx
    src/components/potential-projects/potential-metrics.tsx
    src/app/(dashboard)/potential-projects/page.tsx
    src/components/layout/sidebar.tsx
  </files>
  <action>
    Create components/potential-projects/ directory with these components, all adapted from pipeline/:

    potential-board.tsx - Adapt from pipeline-board.tsx:
    - Import POTENTIAL_STAGES from @/lib/potential-utils
    - Remove ALL lost reason logic: no pendingLostDeal state, no LostReasonDialog import, no handleLostConfirm/handleLostCancel
    - Simplify handleDragEnd - no stage interception needed
    - Change Deal interface to PotentialProject: estimatedValue instead of value, no lostReason field
    - Update API endpoint to /api/potential-projects
    - Import PotentialFormModal and PotentialDetailSheet instead of deal components
    - Button text: "Add Project" instead of "Add Deal"

    potential-column.tsx - Copy from pipeline-column.tsx:
    - No changes needed, same interface works

    potential-card.tsx - Adapt from pipeline-card.tsx:
    - Change interface: estimatedValue instead of value
    - Remove lostReason display if present
    - Same company/contact display pattern

    potential-form-modal.tsx - Adapt from deal-form-modal.tsx:
    - Change field name: estimatedValue instead of value
    - Change API endpoint to /api/potential-projects
    - Change labels: "Estimated Value" instead of "Deal Value"
    - Reuse CompanySelect and ContactSelect from @/components/pipeline/
    - Title: "Add Potential Project"

    potential-detail-sheet.tsx - Adapt from deal-detail-sheet.tsx:
    - Change field name: estimatedValue instead of value
    - Remove lostReason field entirely (both display and edit)
    - Change API endpoint to /api/potential-projects/[id]
    - Change labels accordingly
    - Title: "Potential Project Details"

    potential-metrics.tsx - Adapt from pipeline-metrics.tsx:
    - Use POTENTIAL_STAGES configuration (3 stages)
    - "Open" shows POTENTIAL stage only (not POTENTIAL + CONFIRMED)
    - Simpler metrics - no need for per-stage weighted values

    Create page.tsx - Adapt from pipeline/page.tsx:
    - Fetch prisma.potentialProject.findMany with company/contact includes
    - Title: "Potential Projects"
    - Import PotentialBoard from @/components/potential-projects/potential-board

    Update sidebar.tsx:
    - Add FolderKanban import from lucide-react
    - Add "Potential Projects" link after "Pipeline" in CRM section
    - href="/potential-projects", icon FolderKanban
    - Use same active state pattern as Pipeline link
  </action>
  <verify>
    Navigate to http://localhost:3000/potential-projects shows Kanban board with 3 columns
    Click "Add Project" opens modal with company/contact selection
    Create, edit, delete potential projects works
    Drag between stages persists on refresh
    Sidebar shows "Potential Projects" link under CRM section
  </verify>
  <done>
    Full Kanban board functional: 3 columns (Potential, Confirmed, Cancelled), create modal works, detail sheet edits/deletes, drag-and-drop persists, navigation accessible from sidebar
  </done>
</task>

</tasks>

<verification>
Phase 12 requirements verification:

PTNL-01: User can view potential projects in Kanban board (Potential, Confirmed, Cancelled)
- Visit /potential-projects, see 3 columns with stage labels

PTNL-02: User can create potential project with title, description, estimated value, company, and contact
- Click "Add Project", fill form with all fields, submit, see card appear in Potential column

PTNL-03: User can drag potential between stages
- Drag a card from Potential to Confirmed, refresh page, card remains in Confirmed

PTNL-04: User can edit potential project details
- Click a card, sheet opens, edit title/value/description, save, see changes reflected

PTNL-05: User can delete potential project (with confirmation)
- Click a card, click Delete, confirm in AlertDialog, card removed from board
</verification>

<success_criteria>
- Kanban board displays 3 columns: Potential, Confirmed, Cancelled
- All CRUD operations work (create, read, update, delete)
- Drag-and-drop between stages persists to database
- Company and Contact selects work in create/edit forms
- Metrics bar shows open potential value and per-stage counts
- Navigation link appears in sidebar under CRM section
- No TypeScript errors on build
- Page loads without console errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-potential-projects/12-01-SUMMARY.md`
</output>
