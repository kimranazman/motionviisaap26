---
phase: 16-navigation-layout-foundation
plan: 02
type: execute
wave: 2
depends_on: [16-01]
files_modified:
  - src/components/layout/mobile-sidebar.tsx
  - src/components/layout/header.tsx
  - src/components/layout/header-search.tsx
autonomous: true

must_haves:
  truths:
    - "User on mobile can tap hamburger menu to access full sidebar navigation"
    - "User on mobile sees search icon that opens search overlay when tapped"
    - "User on any device can access profile menu and sign out"
    - "Mobile header shows page title and hamburger menu"
  artifacts:
    - path: "src/components/layout/mobile-sidebar.tsx"
      provides: "Sheet-based sidebar for mobile"
      min_lines: 50
    - path: "src/components/layout/header.tsx"
      provides: "Responsive header with mobile adaptations"
      contains: "md:hidden"
    - path: "src/components/layout/header-search.tsx"
      provides: "Search with mobile icon mode"
      contains: "Dialog"
  key_links:
    - from: "src/components/layout/header.tsx"
      to: "src/components/layout/mobile-sidebar.tsx"
      via: "import and render"
      pattern: "MobileSidebar"
    - from: "src/components/layout/header.tsx"
      to: "Dialog"
      via: "mobile search overlay"
      pattern: "Dialog"
---

<objective>
Complete mobile navigation with hamburger menu sidebar and responsive header.

Purpose: Mobile users need access to ALL navigation items (not just the 4 in bottom nav), and the header needs to adapt for smaller screens by collapsing search to an icon.

Output: Mobile sidebar component (Sheet-based), responsive header with hamburger trigger and collapsible search.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-navigation-layout-foundation/16-RESEARCH.md
@.planning/phases/16-navigation-layout-foundation/16-01-SUMMARY.md

Key files:
@src/components/layout/header.tsx
@src/components/layout/header-search.tsx
@src/components/layout/sidebar.tsx
@src/components/ui/sheet.tsx
@src/components/ui/dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobileSidebar component with Sheet</name>
  <files>
    - src/components/layout/mobile-sidebar.tsx
  </files>
  <action>
Create `src/components/layout/mobile-sidebar.tsx`:

```typescript
'use client'

import { useState } from 'react'
import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { useSession } from 'next-auth/react'
import { Menu, Target, X } from 'lucide-react'
import {
  LayoutDashboard,
  GanttChart,
  KanbanSquare,
  Calendar,
  ListTodo,
  Ticket,
  Users,
  Building2,
  Funnel,
  FolderKanban,
  Briefcase,
} from 'lucide-react'
import { Button } from '@/components/ui/button'
import { Sheet, SheetContent, SheetTrigger, SheetTitle } from '@/components/ui/sheet'
import { cn } from '@/lib/utils'

const navigation = [
  { name: 'Dashboard', href: '/', icon: LayoutDashboard },
  { name: 'Timeline', href: '/timeline', icon: GanttChart },
  { name: 'Kanban', href: '/kanban', icon: KanbanSquare },
  { name: 'Calendar', href: '/calendar', icon: Calendar },
  { name: 'Initiatives', href: '/initiatives', icon: ListTodo },
  { name: 'Events to Attend', href: '/events', icon: Ticket },
]

const crmNavigation = [
  { name: 'Companies', href: '/companies', icon: Building2 },
  { name: 'Pipeline', href: '/pipeline', icon: Funnel },
  { name: 'Potential Projects', href: '/potential-projects', icon: FolderKanban },
  { name: 'Projects', href: '/projects', icon: Briefcase },
]

export function MobileSidebar() {
  const [open, setOpen] = useState(false)
  const pathname = usePathname()
  const { data: session } = useSession()

  const NavLink = ({ item }: { item: { name: string; href: string; icon: React.ComponentType<{ className?: string }> } }) => {
    const isActive = pathname === item.href ||
      (item.href !== '/' && pathname.startsWith(item.href))
    return (
      <Link
        href={item.href}
        onClick={() => setOpen(false)}
        className={cn(
          'flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium transition-colors',
          isActive
            ? 'bg-gray-100 text-gray-900'
            : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900'
        )}
      >
        <item.icon className="h-5 w-5" />
        {item.name}
      </Link>
    )
  }

  return (
    <Sheet open={open} onOpenChange={setOpen}>
      <SheetTrigger asChild>
        <Button variant="ghost" size="icon" className="md:hidden">
          <Menu className="h-6 w-6" />
          <span className="sr-only">Open menu</span>
        </Button>
      </SheetTrigger>
      <SheetContent side="left" className="w-64 p-0">
        <SheetTitle className="sr-only">Navigation Menu</SheetTitle>
        {/* Logo */}
        <div className="flex items-center gap-2 px-6 py-5 border-b border-gray-200">
          <div className="flex h-8 w-8 items-center justify-center rounded-lg bg-blue-600">
            <Target className="h-5 w-5 text-white" />
          </div>
          <div>
            <h1 className="text-lg font-semibold text-gray-900">SAAP 2026</h1>
            <p className="text-xs text-gray-500">MotionVii</p>
          </div>
        </div>

        {/* Navigation */}
        <nav className="flex flex-col gap-1 p-4 overflow-y-auto max-h-[calc(100vh-80px)]">
          {navigation.map((item) => (
            <NavLink key={item.name} item={item} />
          ))}

          {/* CRM Section */}
          <div className="mt-6 mb-2 px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">
            CRM
          </div>
          {crmNavigation.map((item) => (
            <NavLink key={item.name} item={item} />
          ))}

          {/* Admin Section */}
          {session?.user?.role === "ADMIN" && (
            <>
              <div className="mt-6 mb-2 px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">
                Admin
              </div>
              <NavLink item={{ name: 'Users', href: '/admin/users', icon: Users }} />
            </>
          )}
        </nav>
      </SheetContent>
    </Sheet>
  )
}
```

This component:
- Uses Sheet from shadcn/ui (slide from left)
- Replicates full sidebar navigation structure
- Closes sheet on navigation (onClick setOpen(false))
- Shows Admin section only for ADMIN role
- Has sr-only SheetTitle for accessibility
- Only renders hamburger button on mobile (md:hidden)
  </action>
  <verify>
- `ls src/components/layout/mobile-sidebar.tsx` confirms file exists
- `grep "SheetContent" src/components/layout/mobile-sidebar.tsx` confirms Sheet usage
- `grep "md:hidden" src/components/layout/mobile-sidebar.tsx` confirms mobile-only button
  </verify>
  <done>MobileSidebar component exists with full navigation in Sheet, accessible via hamburger menu</done>
</task>

<task type="auto">
  <name>Task 2: Make Header responsive with hamburger and collapsible search</name>
  <files>
    - src/components/layout/header.tsx
    - src/components/layout/header-search.tsx
  </files>
  <action>
1. Update `src/components/layout/header-search.tsx` to support mobile mode:

Add props interface and mobile dialog:
```typescript
'use client'

import { useState, useEffect } from 'react'
import Link from 'next/link'
import { Search } from 'lucide-react'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from '@/components/ui/popover'
import {
  Dialog,
  DialogContent,
  DialogTrigger,
  DialogTitle,
} from '@/components/ui/dialog'
import { ScrollArea } from '@/components/ui/scroll-area'
import { Badge } from '@/components/ui/badge'
import { useDebounce } from '@/lib/hooks/use-debounce'
import { getStatusColor, formatStatus, formatTeamMember } from '@/lib/utils'

interface SearchResult {
  id: string
  title: string
  status: string
  personInCharge: string | null
}

interface HeaderSearchProps {
  mobile?: boolean
}

export function HeaderSearch({ mobile = false }: HeaderSearchProps) {
  const [query, setQuery] = useState('')
  const [results, setResults] = useState<SearchResult[]>([])
  const [isOpen, setIsOpen] = useState(false)
  const [isLoading, setIsLoading] = useState(false)

  const debouncedQuery = useDebounce(query, 300)

  // Fetch search results when debounced query changes
  useEffect(() => {
    if (!debouncedQuery.trim()) {
      setResults([])
      if (!mobile) setIsOpen(false)
      return
    }

    const searchInitiatives = async () => {
      setIsLoading(true)
      try {
        const response = await fetch(
          `/api/initiatives/search?q=${encodeURIComponent(debouncedQuery)}`
        )
        if (response.ok) {
          const data = await response.json()
          setResults(data)
          if (!mobile) {
            setIsOpen(data.length > 0 || debouncedQuery.trim().length > 0)
          }
        }
      } catch (error) {
        console.error('Search failed:', error)
        setResults([])
      } finally {
        setIsLoading(false)
      }
    }

    searchInitiatives()
  }, [debouncedQuery, mobile])

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Escape') {
      setIsOpen(false)
    }
  }

  const handleResultClick = () => {
    setIsOpen(false)
    setQuery('')
  }

  const SearchResults = () => (
    <ScrollArea className="max-h-80">
      {isLoading ? (
        <div className="p-4 text-center text-sm text-gray-500">
          Searching...
        </div>
      ) : results.length === 0 && debouncedQuery.trim() ? (
        <div className="p-4 text-center text-sm text-gray-500">
          No results for &quot;{debouncedQuery}&quot;
        </div>
      ) : results.length === 0 ? (
        <div className="p-4 text-center text-sm text-gray-500">
          Type to search initiatives...
        </div>
      ) : (
        <div className="p-1">
          {results.map((result) => (
            <Link
              key={result.id}
              href={`/initiatives/${result.id}`}
              onClick={handleResultClick}
              className="flex items-center gap-2 p-2 rounded hover:bg-gray-100"
            >
              <div className="flex-1 min-w-0">
                <p className="text-sm truncate">{result.title}</p>
                <p className="text-xs text-gray-500">{formatTeamMember(result.personInCharge)}</p>
              </div>
              <Badge className={getStatusColor(result.status)}>
                {formatStatus(result.status)}
              </Badge>
            </Link>
          ))}
          {results.length > 0 && (
            <div className="px-2 py-1.5 text-xs text-gray-400 border-t mt-1">
              {results.length} result{results.length !== 1 ? 's' : ''} found
            </div>
          )}
        </div>
      )}
    </ScrollArea>
  )

  // Mobile: Dialog with search input
  if (mobile) {
    return (
      <Dialog open={isOpen} onOpenChange={setIsOpen}>
        <DialogTrigger asChild>
          <Button variant="ghost" size="icon">
            <Search className="h-5 w-5" />
            <span className="sr-only">Search</span>
          </Button>
        </DialogTrigger>
        <DialogContent className="top-4 translate-y-0 max-w-[calc(100%-2rem)] p-4">
          <DialogTitle className="sr-only">Search initiatives</DialogTitle>
          <div className="relative">
            <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400" />
            <Input
              placeholder="Search initiatives..."
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              onKeyDown={handleKeyDown}
              autoFocus
              className="pl-9 bg-gray-50 border-gray-200"
            />
          </div>
          <SearchResults />
        </DialogContent>
      </Dialog>
    )
  }

  // Desktop: Popover with search input (existing behavior)
  return (
    <Popover open={isOpen} onOpenChange={setIsOpen}>
      <PopoverTrigger asChild>
        <div className="relative">
          <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400" />
          <Input
            placeholder="Search initiatives..."
            value={query}
            onChange={(e) => setQuery(e.target.value)}
            onKeyDown={handleKeyDown}
            onFocus={() => {
              if (results.length > 0 || (query.trim() && debouncedQuery.trim())) {
                setIsOpen(true)
              }
            }}
            className="w-64 pl-9 bg-gray-50 border-gray-200"
          />
        </div>
      </PopoverTrigger>
      <PopoverContent
        className="w-80 p-0"
        align="start"
        onOpenAutoFocus={(e) => e.preventDefault()}
      >
        <SearchResults />
      </PopoverContent>
    </Popover>
  )
}
```

2. Update `src/components/layout/header.tsx` to be responsive:

```typescript
'use client'

import { useSession } from 'next-auth/react'
import { Button } from '@/components/ui/button'
import { Avatar, AvatarFallback } from '@/components/ui/avatar'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { HeaderSearch } from './header-search'
import { NotificationBell } from './notification-bell'
import { MobileSidebar } from './mobile-sidebar'
import { SignOutButton } from '@/components/auth/sign-out-button'

interface HeaderProps {
  title: string
  description?: string
}

export function Header({ title, description }: HeaderProps) {
  const { data: session } = useSession()

  // Get initials from name or email
  const getInitials = () => {
    if (session?.user?.name) {
      return session.user.name
        .split(' ')
        .map((n) => n[0])
        .join('')
        .toUpperCase()
        .slice(0, 2)
    }
    if (session?.user?.email) {
      return session.user.email.slice(0, 2).toUpperCase()
    }
    return '?'
  }

  return (
    <header className="sticky top-0 z-40 flex h-14 md:h-16 items-center justify-between border-b border-gray-200 bg-white px-4 md:px-6">
      {/* Mobile: Hamburger + Title */}
      <div className="flex items-center gap-2 md:hidden">
        <MobileSidebar />
        <h1 className="text-lg font-semibold text-gray-900 truncate max-w-[200px]">{title}</h1>
      </div>

      {/* Desktop: Title + Description */}
      <div className="hidden md:block">
        <h1 className="text-xl font-semibold text-gray-900">{title}</h1>
        {description && (
          <p className="text-sm text-gray-500">{description}</p>
        )}
      </div>

      <div className="flex items-center gap-2 md:gap-4">
        {/* Mobile search icon */}
        <div className="md:hidden">
          <HeaderSearch mobile />
        </div>

        {/* Desktop search */}
        <div className="hidden md:block">
          <HeaderSearch />
        </div>

        {/* Notifications */}
        <NotificationBell />

        {/* User Menu - works on all sizes */}
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <Button variant="ghost" className="relative h-8 w-8 rounded-full">
              <Avatar className="h-8 w-8">
                <AvatarFallback className="bg-blue-600 text-white text-sm">
                  {getInitials()}
                </AvatarFallback>
              </Avatar>
            </Button>
          </DropdownMenuTrigger>
          <DropdownMenuContent className="w-56" align="end" forceMount>
            <DropdownMenuLabel className="font-normal">
              <div className="flex flex-col space-y-1">
                <p className="text-sm font-medium leading-none">
                  {session?.user?.name || 'User'}
                </p>
                <p className="text-xs leading-none text-gray-500">
                  {session?.user?.email || ''}
                </p>
              </div>
            </DropdownMenuLabel>
            <DropdownMenuSeparator />
            <DropdownMenuItem asChild>
              <SignOutButton
                variant="ghost"
                className="w-full justify-start cursor-pointer"
              />
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </div>
    </header>
  )
}
```

Key changes:
- Header height: h-14 on mobile, h-16 on desktop
- Mobile shows hamburger (MobileSidebar) + truncated title
- Desktop shows full title + optional description
- Search: icon on mobile (Dialog), full input on desktop (Popover)
- User menu unchanged (already works on all sizes)
- Reduced gap between items on mobile (gap-2 vs gap-4)
  </action>
  <verify>
- `grep "MobileSidebar" src/components/layout/header.tsx` confirms import
- `grep "md:hidden" src/components/layout/header.tsx` confirms mobile-specific sections
- `grep "mobile.*Dialog" src/components/layout/header-search.tsx` confirms mobile mode
  </verify>
  <done>Header responsive with hamburger menu on mobile, search collapses to icon, user menu accessible on all sizes</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Open app on mobile width (<768px):
   - Header shows hamburger menu on left, truncated title, search icon, notifications, user avatar
   - Tap hamburger - full sidebar slides in from left
   - Tap search icon - dialog opens with search input
   - Tap user avatar - dropdown menu appears
2. Open app on desktop width (>=768px):
   - Header shows full title, search input, notifications, user avatar
   - No hamburger menu visible
   - Search results appear in popover below input
3. Navigate between pages - hamburger menu closes automatically after selection
</verification>

<success_criteria>
- NAV-03 (enhanced): Mobile users can access full sidebar via hamburger menu
- NAV-04: Header adapts to mobile (search icon instead of full search bar) - DONE
- NAV-05: User menu accessible on all screen sizes - DONE (unchanged, already works)
- Mobile header shows hamburger + title + search icon + notifications + user menu
- Desktop header shows title + description + search input + notifications + user menu
</success_criteria>

<output>
After completion, create `.planning/phases/16-navigation-layout-foundation/16-02-SUMMARY.md`
</output>
