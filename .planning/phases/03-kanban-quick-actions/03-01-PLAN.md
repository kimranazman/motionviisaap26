---
phase: 03-kanban-quick-actions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/kanban/kanban-card.tsx
  - src/components/kanban/kanban-board.tsx
autonomous: true

must_haves:
  truths:
    - "User can change initiative status from Kanban card dropdown menu"
    - "User can reassign initiative from Kanban card dropdown menu"
    - "Card moves to correct column immediately after status change"
    - "Card shows new owner immediately after reassign"
  artifacts:
    - path: "src/components/kanban/kanban-card.tsx"
      provides: "Dropdown submenus for status change and reassign"
      contains: "DropdownMenuSub"
    - path: "src/components/kanban/kanban-board.tsx"
      provides: "Handler functions for status and person updates"
      contains: "handleStatusChange"
  key_links:
    - from: "kanban-card.tsx"
      to: "kanban-board.tsx"
      via: "callback props onStatusChange, onReassign"
      pattern: "onStatusChange\\?\\."
    - from: "kanban-board.tsx"
      to: "/api/initiatives/[id]"
      via: "fetch PATCH"
      pattern: "fetch.*api/initiatives"
---

<objective>
Make the existing "Change Status" and "Reassign" dropdown menu items functional.

Purpose: Users can quickly update initiative status or reassign ownership directly from the Kanban board without navigating away or opening a detail page.

Output: Enhanced KanbanCard with working submenus, KanbanBoard with update handlers.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-kanban-quick-actions/03-RESEARCH.md

# Files to modify
@src/components/kanban/kanban-card.tsx
@src/components/kanban/kanban-board.tsx
@src/lib/utils.ts (STATUS_OPTIONS, TEAM_MEMBER_OPTIONS, getStatusColor)
@src/components/ui/dropdown-menu.tsx (DropdownMenuSub, DropdownMenuSubTrigger, DropdownMenuSubContent, DropdownMenuRadioGroup, DropdownMenuRadioItem)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add dropdown submenus to KanbanCard</name>
  <files>src/components/kanban/kanban-card.tsx</files>
  <action>
Modify the KanbanCard component to:

1. Add imports from dropdown-menu.tsx:
   - DropdownMenuSub, DropdownMenuSubTrigger, DropdownMenuSubContent
   - DropdownMenuRadioGroup, DropdownMenuRadioItem

2. Add imports from utils.ts:
   - STATUS_OPTIONS, TEAM_MEMBER_OPTIONS, getStatusColor

3. Update KanbanCardProps interface to include:
   - onStatusChange?: (id: string, status: string) => Promise<void>
   - onReassign?: (id: string, personInCharge: string | null) => Promise<void>

4. Replace the "Change Status" DropdownMenuItem with a DropdownMenuSub:
   - DropdownMenuSubTrigger with RefreshCw icon and "Change Status" text
   - DropdownMenuSubContent containing DropdownMenuRadioGroup
   - Map STATUS_OPTIONS to DropdownMenuRadioItem, showing status badge with getStatusColor
   - onValueChange calls onStatusChange?.(item.id, value)
   - Add onPointerDown={(e) => e.stopPropagation()} to SubTrigger and RadioItems

5. Replace the "Reassign" DropdownMenuItem with a DropdownMenuSub:
   - DropdownMenuSubTrigger with UserPlus icon and "Reassign" text
   - DropdownMenuSubContent containing DropdownMenuRadioGroup
   - First item: "Unassigned" with value ""
   - Map TEAM_MEMBER_OPTIONS to DropdownMenuRadioItem
   - onValueChange calls onReassign?.(item.id, value || null)
   - Add onPointerDown={(e) => e.stopPropagation()} to SubTrigger and RadioItems

Key patterns from research:
- DropdownMenuSub > DropdownMenuSubTrigger + DropdownMenuSubContent structure
- Radio group value={item.status} or value={item.personInCharge || ''}
- stopPropagation on all interactive elements (prevents drag conflicts)
  </action>
  <verify>
TypeScript compiles without errors:
```bash
npx tsc --noEmit
```
  </verify>
  <done>
KanbanCard accepts onStatusChange and onReassign props, dropdown shows submenus with status/person options.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add handlers in KanbanBoard and wire to cards</name>
  <files>src/components/kanban/kanban-board.tsx</files>
  <action>
Modify the KanbanBoard component to:

1. Add handleStatusChange function (after existing handleInitiativeUpdate):
   ```typescript
   const handleStatusChange = async (id: string, newStatus: string) => {
     // Optimistic update - card moves to new column immediately
     setInitiatives(prev =>
       prev.map(item => (item.id === id ? { ...item, status: newStatus } : item))
     )

     // Persist to API (PATCH endpoint supports status field)
     try {
       const response = await fetch(`/api/initiatives/${id}`, {
         method: 'PATCH',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ status: newStatus }),
       })
       if (!response.ok) {
         console.error('Failed to update status:', await response.text())
       }
     } catch (error) {
       console.error('Failed to update status:', error)
     }
   }
   ```

2. Add handleReassign function:
   ```typescript
   const handleReassign = async (id: string, personInCharge: string | null) => {
     // Optimistic update - avatar changes immediately
     setInitiatives(prev =>
       prev.map(item => (item.id === id ? { ...item, personInCharge } : item))
     )

     // Persist to API (PATCH endpoint supports personInCharge field)
     try {
       const response = await fetch(`/api/initiatives/${id}`, {
         method: 'PATCH',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ personInCharge }),
       })
       if (!response.ok) {
         console.error('Failed to reassign:', await response.text())
       }
     } catch (error) {
       console.error('Failed to reassign:', error)
     }
   }
   ```

3. Pass handlers to KanbanCard in the Board View section (around line 458):
   ```tsx
   <KanbanCard
     key={item.id}
     item={item}
     onClick={() => handleCardClick(item)}
     onStatusChange={handleStatusChange}
     onReassign={handleReassign}
   />
   ```

4. Also pass handlers to KanbanCard in DragOverlay (around line 472):
   ```tsx
   <KanbanCard
     item={getActiveItem()!}
     isDragging
     onStatusChange={handleStatusChange}
     onReassign={handleReassign}
   />
   ```

Note: The swimlane view uses a different SwimlaneCard component. Quick actions only work on the main Board view for now (acceptable scope).
  </action>
  <verify>
TypeScript compiles without errors:
```bash
npx tsc --noEmit
```

Dev server runs:
```bash
npm run dev &
sleep 5
curl -s http://localhost:3000 | head -20
```
  </verify>
  <done>
KanbanBoard passes onStatusChange and onReassign to KanbanCard components. Handlers use optimistic updates and persist to API.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Dev server starts: `npm run dev`
3. Manual verification (human):
   - Navigate to Kanban board
   - Hover over any card to reveal menu button
   - Click menu button, hover "Change Status" - submenu appears with 6 status options
   - Select different status - card moves to appropriate column immediately
   - Click menu again, hover "Reassign" - submenu appears with team members + Unassigned
   - Select different person - card avatar updates immediately
</verification>

<success_criteria>
- KANB-01: User changes status via dropdown submenu, card moves to correct column
- KANB-02: User reassigns via dropdown submenu, card shows new owner
- No drag conflicts when using menus (stopPropagation working)
- Changes persist to database (API PATCH calls succeed)
</success_criteria>

<output>
After completion, create `.planning/phases/03-kanban-quick-actions/03-01-SUMMARY.md`
</output>
