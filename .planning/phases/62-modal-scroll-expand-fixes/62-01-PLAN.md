# Plan 62-01: Fix Modal Scroll in All Detail Views

---
wave: 1
depends_on: []
files_modified:
  - src/components/ui/dialog.tsx
  - src/components/ui/detail-view.tsx
autonomous: true
---

## Objective

Fix scrolling in all 7 detail modals so content is never clipped regardless of length.
Requirements: UX-01, UX-03, UX-04

## Context

The `DetailView` component wraps all detail modal content in a Radix `ScrollArea`. However, `DialogContent` in `dialog.tsx` has `overflow-y-auto` which conflicts with ScrollArea's custom scrollbar mechanism. ScrollArea needs its parent to have a fixed/constrained height and `overflow: hidden` so the Radix viewport handles scrolling.

Additionally, in mobile drawer mode, `DetailView` adds `h-[85vh] rounded-t-2xl` to `SheetContent` but omits `flex flex-col`, preventing the `flex-1` on ScrollArea from working.

## Tasks

<task id="1">
**Fix DialogContent overflow conflict in dialog.tsx**

Open `src/components/ui/dialog.tsx`.

In the `DialogContent` component, change `overflow-y-auto` to `overflow-hidden` in the className string on line 42.

Change:
```
"fixed z-50 w-full gap-4 border bg-background p-6 shadow-lg duration-200 overflow-y-auto",
```
To:
```
"fixed z-50 w-full gap-4 border bg-background p-6 shadow-lg duration-200 overflow-hidden",
```

This lets ScrollArea (used by DetailView) handle all scrolling with its custom scrollbar. Dialogs that don't use DetailView/ScrollArea can still add `overflow-y-auto` via className prop.
</task>

<task id="2">
**Fix mobile drawer flex layout in detail-view.tsx**

Open `src/components/ui/detail-view.tsx`.

In the drawer mode branch (line 81-83), add `flex flex-col` to the mobile drawer variant so ScrollArea's `flex-1` works:

Change:
```tsx
className={cn(
  isMobile && 'h-[85vh] rounded-t-2xl',
  !isMobile && 'flex flex-col',
  className
)}
```
To:
```tsx
className={cn(
  isMobile && 'h-[85vh] rounded-t-2xl flex flex-col',
  !isMobile && 'flex flex-col',
  className
)}
```

This ensures the flex column layout is applied in BOTH mobile and desktop drawer modes.
</task>

<task id="3">
**Add overflow-hidden to DialogContent in detail-view.tsx dialog mode**

In `src/components/ui/detail-view.tsx`, the dialog mode branch passes `className` to `DialogContent` on line 111.

Currently:
```tsx
<DialogContent className={cn('md:max-w-[650px] p-0 flex flex-col', className)}>
```

Add `max-h-[85vh]` explicitly and `overflow-hidden` to ensure the flex container has a clear height constraint for ScrollArea:

```tsx
<DialogContent className={cn('md:max-w-[650px] p-0 flex flex-col max-h-[85vh] overflow-hidden', className)}>
```

Wait -- `DialogContent` already has `md:max-h-[85vh]` in its base styles. And on mobile it has `h-[calc(100vh-2rem)]`. So the height constraint exists. The `overflow-hidden` from task 1 will apply at the base level. No additional change needed here.

Actually, check if `flex flex-col` + `overflow-hidden` from the base DialogContent combined with `p-0 flex flex-col` from DetailView creates any conflicts. The `flex flex-col` is in both places which is fine (redundant but harmless). The `p-0` overrides `p-6` from base. This is correct.

No changes needed in this task -- task 1 already handles it.
</task>

<task id="4">
**Verify scroll behavior with all 7 detail sheet types**

After making changes to dialog.tsx and detail-view.tsx, verify conceptually:

1. `ProjectDetailSheet` -- Very long content (financials, deliverables, tasks, costs, documents). Uses `DetailView` with dialog mode. ScrollArea will now scroll because DialogContent has `overflow-hidden` + constrained height.

2. `DealDetailSheet` -- Medium content. Same fix applies.

3. `PotentialDetailSheet` -- Medium content. Same fix applies.

4. `CompanyDetailModal` -- Long content (contacts, departments, related items). Same fix applies.

5. `SupplierDetailModal` -- Long content (fields, credit terms, financials, price list). Same fix applies.

6. `TaskDetailSheet` -- Medium content with comments. Same fix applies.

7. `InitiativeDetailSheet` -- Long content (info grid, linked projects, comments). Same fix applies.

All 7 use `DetailView` which uses `ScrollArea` inside either `DialogContent` or `SheetContent`. The fix is centralized.

For drawer mode: SheetContent doesn't have `overflow-y-auto` in its base styles, so no conflict exists there. The `flex flex-col` fix in task 2 ensures mobile drawer scrolls correctly.

No code changes in this task -- it's verification.
</task>

## Verification

- [ ] `dialog.tsx` has `overflow-hidden` instead of `overflow-y-auto`
- [ ] `detail-view.tsx` has `flex flex-col` in mobile drawer branch
- [ ] All 7 detail sheets inherit the fix via DetailView wrapper
- [ ] No regressions in other Dialog usages (event-form-modal, lost-reason-dialog, permission-denied-dialog, image-preview-dialog, alert-dialog) -- these either use ScrollArea themselves or have short content that fits without scrolling

## must_haves

- DialogContent uses overflow-hidden instead of overflow-y-auto to let ScrollArea handle scrolling
- Mobile drawer mode has flex flex-col for proper ScrollArea height constraint
- All 7 detail sheet types scroll correctly through DetailView wrapper
- Dialog mode and Drawer mode both scroll identically
