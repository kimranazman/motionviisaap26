# Plan 62-02: Fix Expand-to-Page for Detail Views

---
wave: 2
depends_on: [62-01]
files_modified:
  - src/app/(dashboard)/projects/[id]/project-detail-page-client.tsx
autonomous: true
---

## Objective

Fix the expand-to-page button so clicking it opens a dedicated full page (not a modal on an empty page).
Requirements: UX-02

## Context

Currently two detail views have `expandHref`:
1. **ProjectDetailSheet**: `expandHref={/projects/${project.id}}` -- page exists at `src/app/(dashboard)/projects/[id]/page.tsx` but `project-detail-page-client.tsx` renders `ProjectDetailSheet` with `open={true}` on an empty page. This means clicking "expand" just shows the same modal on a blank background -- not a true full-page experience.
2. **InitiativeDetailSheet**: `expandHref={/initiatives/${initiative.id}}` -- page exists and renders `InitiativeDetail`, a proper full-page component. This works correctly.

The fix: Rewrite `project-detail-page-client.tsx` to render project detail inline as a proper full page, similar to how `InitiativeDetail` works. The server page (`page.tsx`) already fetches the project data and passes it down.

## Tasks

<task id="1">
**Rewrite project-detail-page-client.tsx as a proper full-page detail view**

Open `src/app/(dashboard)/projects/[id]/project-detail-page-client.tsx`.

Replace the current implementation (which renders `ProjectDetailSheet` as an always-open modal on an empty page) with a proper full-page layout.

The new component should:
1. Show a header with back button (ArrowLeft) that navigates to `/projects`
2. Show project title with status badge
3. Render project detail content inline (not in a modal)
4. Include all the same sections that ProjectDetailSheet shows:
   - Title (editable), Status, Company, Contact, KRI Link, Description
   - Project Dates (Start/End)
   - Source info
   - Financials Summary
   - Deliverables section
   - Tasks section (TaskTree)
   - Costs section
   - Documents section
5. Save/Delete/Archive buttons in a sticky footer or inline
6. Reuse existing sub-components: `FinancialsSummary`, `CostForm`, `CostCard`, `DeliverableForm`, `DeliverableCard`, `TaskTree`, `DocumentsSection`, `ImagePreviewDialog`, `AIReviewSheet`, `DeliverableReviewSheet`

The implementation pattern should mirror `InitiativeDetail` (`src/components/initiatives/initiative-detail.tsx`):
- Full-page layout with `min-h-screen bg-gray-50`
- White header bar with back button and title
- Content in `max-w-4xl mx-auto` container
- Card-based sections

However, since ProjectDetailSheet is a very large component (~1400 lines) with extensive state management, the simplest and most maintainable approach is to extract the inner content rendering into a shared function or just inline the full-page layout.

**Recommended approach**: Keep it simple. The full-page client component should:
1. Import ArrowLeft, Button, and Link from the same packages
2. Use `useRouter` for back navigation
3. Manage all the same state as ProjectDetailSheet (title, status, costs, deliverables, tasks, documents, etc.)
4. Render the same content sections but in Card wrappers instead of inside a modal

Since this duplicates significant logic from ProjectDetailSheet, an alternative cleaner approach:
- Create a `ProjectDetailContent` component that contains the form fields and sections
- Use it in both ProjectDetailSheet (inside DetailView) and the full page
- This avoids 1400 lines of duplication

**Simplest approach (recommended)**: Refactor the full-page client to NOT use the modal at all. Instead, render content directly in page layout. Since time is constrained, the pragmatic solution is:

1. Keep the existing `project-detail-page-client.tsx` structure
2. But instead of rendering `ProjectDetailSheet` as an open modal, render the content in a page-native layout
3. The fastest way: Create a minimal full-page wrapper that shows the project content in `Card` components similar to `InitiativeDetail`

Given the complexity, the MOST PRAGMATIC approach is:
- Accept that ProjectDetailSheet has all the logic
- Create a wrapper that forces `DetailView` into a full-page-like rendering by NOT wrapping in Dialog/Sheet but rendering content directly
- OR: Create a dedicated `ProjectDetailPage` component that duplicates the essential project info in a simpler read-view with an "Edit" button that opens the modal

**Final decision**: Create a clean full-page project detail view that shows project info in a read-friendly layout with Card sections. Include an "Edit in modal" button for editing. This avoids duplicating all the form state management.

The full-page view should display:
- Header with back button, title, status badge, company name
- Details Card: Company, Contact, KRI, Description, Dates, Source info
- Financials Card: Reuse the FinancialsSummary component (import it)
- Deliverables Card: List deliverables
- Tasks Card: Show TaskTree
- Costs Card: List costs with totals
- Documents Card: Show documents list
- Action buttons: "Edit Project" (opens /projects?open={id}), Archive, Delete

This requires fetching additional data (deliverables, tasks, documents) via API calls on mount, similar to what ProjectDetailSheet does.

Write the new `project-detail-page-client.tsx` with this approach:

```tsx
'use client'

import { useState, useEffect } from 'react'
import { useRouter } from 'next/navigation'
import Link from 'next/link'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Separator } from '@/components/ui/separator'
import {
  ArrowLeft,
  Building2,
  User,
  Target,
  Calendar,
  ArrowRight,
  Plus,
  DollarSign,
  Package,
  ListChecks,
  FileText,
  Pencil,
  Archive,
  ArchiveRestore,
  Trash2,
  Loader2,
  Sparkles,
  TrendingUp,
  TrendingDown,
  Minus,
} from 'lucide-react'
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from '@/components/ui/alert-dialog'
import { toast } from 'sonner'
import {
  PROJECT_STATUSES,
  getProjectStatusColor,
  formatProjectStatus,
} from '@/lib/project-utils'
import { cn, formatCurrency, formatDate } from '@/lib/utils'
import { calculateTotalCosts, calculateProfit, getCategoryColor } from '@/lib/cost-utils'
import { TaskTree } from '@/components/projects/task-tree'
import { DocumentsSection } from '@/components/projects/documents-section'
import { ImagePreviewDialog } from '@/components/projects/image-preview-dialog'
import { AIReviewSheet } from '@/components/ai/ai-review-sheet'
import { DeliverableReviewSheet } from '@/components/ai/deliverable-review-sheet'
// ... full implementation
```

The component renders project data server-side fetched, then client-side fetches deliverables, tasks, documents on mount.
</task>

## Verification

- [ ] Clicking expand button on ProjectDetailSheet navigates to `/projects/[id]`
- [ ] The `/projects/[id]` page renders a full-page layout (not a modal on empty background)
- [ ] Full page shows all project information: details, financials, deliverables, tasks, costs, documents
- [ ] Back button navigates to `/projects`
- [ ] Initiative expand button continues to work correctly at `/initiatives/[id]`

## must_haves

- Project expand-to-page shows a dedicated full page layout, not a modal on an empty page
- Full page includes project title, status, company, financials, deliverables, tasks, costs, documents
- Back navigation returns to /projects
- Initiative expand-to-page continues to work
