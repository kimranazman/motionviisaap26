---
phase: 50-support-tasks-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/support-tasks/page.tsx
  - src/components/support-tasks/support-tasks-view.tsx
  - src/components/layout/sidebar.tsx
  - src/components/layout/mobile-sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User sees /support-tasks page with all 30 tasks grouped into 4 categories"
    - "Each task shows taskId, description, owner, frequency, priority, and KR badges"
    - "User can filter by category using a dropdown; default shows all"
    - "KR badges are clickable and navigate to /objectives"
    - "Support Tasks appears in sidebar navigation between Initiatives and Events to Attend"
    - "Support Tasks appears in mobile sidebar navigation"
  artifacts:
    - path: "src/app/(dashboard)/support-tasks/page.tsx"
      provides: "Server component page fetching support tasks via Prisma"
      contains: "force-dynamic"
    - path: "src/components/support-tasks/support-tasks-view.tsx"
      provides: "Client component with category filter, grouped display, KR badge links"
      contains: "use client"
    - path: "src/components/layout/sidebar.tsx"
      provides: "Desktop sidebar with Support Tasks nav item"
      contains: "Support Tasks"
    - path: "src/components/layout/mobile-sidebar.tsx"
      provides: "Mobile sidebar with Support Tasks nav item"
      contains: "Support Tasks"
  key_links:
    - from: "src/app/(dashboard)/support-tasks/page.tsx"
      to: "prisma.supportTask"
      via: "Prisma findMany with keyResultLinks include"
      pattern: "prisma\\.supportTask\\.findMany"
    - from: "src/app/(dashboard)/support-tasks/page.tsx"
      to: "src/components/support-tasks/support-tasks-view.tsx"
      via: "Server component passes tasks prop to client component"
      pattern: "SupportTasksView.*tasks="
    - from: "src/components/support-tasks/support-tasks-view.tsx"
      to: "/objectives"
      via: "KR badges wrapped in Next.js Link"
      pattern: "Link.*href=.*objectives"
    - from: "src/components/layout/sidebar.tsx"
      to: "/support-tasks"
      via: "Navigation array entry"
      pattern: "support-tasks"
---

<objective>
Build the Support Tasks page with category grouping, filtering, clickable KR badges, and sidebar navigation.

Purpose: Users need to view and filter 30 recurring operational support tasks, see which KRs each task supports, and access the page from the sidebar navigation.
Output: New /support-tasks page with category-grouped tasks, category filter dropdown, clickable KR badge links, and sidebar navigation entries in both desktop and mobile sidebars.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/50-support-tasks-ui/50-RESEARCH.md

Key reference files (copy patterns from these):
@src/app/(dashboard)/events/page.tsx
@src/components/events/events-view.tsx
@src/components/layout/sidebar.tsx
@src/components/layout/mobile-sidebar.tsx
@src/app/api/support-tasks/route.ts
@src/components/ui/badge.tsx
@src/components/ui/select.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Support Tasks page and view component</name>
  <files>
    src/app/(dashboard)/support-tasks/page.tsx
    src/components/support-tasks/support-tasks-view.tsx
  </files>
  <action>
Create two files following the Events page pattern exactly:

**1. `src/app/(dashboard)/support-tasks/page.tsx`** (server component):
- Add `export const dynamic = 'force-dynamic'` at the top
- Import `Header` from `@/components/layout/header`, `SupportTasksView` from `@/components/support-tasks/support-tasks-view`, and `prisma` from `@/lib/prisma`
- Create `getSupportTasks()` async function that calls `prisma.supportTask.findMany()` with:
  - `include: { keyResultLinks: { include: { keyResult: { select: { id: true, krId: true, description: true } } } } }`
  - `orderBy: [{ category: 'asc' }, { taskId: 'asc' }]`
- No Decimal serialization needed (SupportTask has no Decimal fields; KeyResult select only returns id/krId/description which are all strings)
- Render `<div className="min-h-screen bg-gray-50">` containing `<Header title="Support Tasks" description="30 recurring operational tasks grouped by category" />` and `<div className="p-3 md:p-6"><SupportTasksView tasks={tasks} /></div>`
- Use `p-3 md:p-6` padding (matches responsive pattern from other pages)

**2. `src/components/support-tasks/support-tasks-view.tsx`** (client component):
- Add `'use client'` directive
- Import: `useState` from React, `Link` from `next/link`, `Card`/`CardContent`/`CardHeader`/`CardTitle` from UI, `Badge` from UI, `Select`/`SelectContent`/`SelectItem`/`SelectTrigger`/`SelectValue` from UI, `cn` from utils, `User`/`Clock`/`Tag` icons from lucide-react
- Define TypeScript interface for the task data shape:
  ```
  interface SupportTaskData {
    id: string
    taskId: string
    category: string
    task: string
    owner: string
    frequency: string | null
    priority: string
    notes: string | null
    keyResultLinks: Array<{
      id: string
      keyResult: {
        id: string
        krId: string
        description: string
      }
    }>
  }
  ```
- Define constants:
  - `CATEGORY_LABELS`: `{ DESIGN_CREATIVE: 'Design & Creative', BUSINESS_ADMIN: 'Business & Admin', TALENTA_IDEAS: 'Talenta Ideas', OPERATIONS: 'Operations' }`
  - `CATEGORY_ORDER`: `['DESIGN_CREATIVE', 'BUSINESS_ADMIN', 'TALENTA_IDEAS', 'OPERATIONS']`
  - `CATEGORY_COLORS`: `{ DESIGN_CREATIVE: 'bg-purple-100 text-purple-800 border-purple-200', BUSINESS_ADMIN: 'bg-blue-100 text-blue-800 border-blue-200', TALENTA_IDEAS: 'bg-amber-100 text-amber-800 border-amber-200', OPERATIONS: 'bg-green-100 text-green-800 border-green-200' }`
  - `PRIORITY_COLORS`: `{ LOW: 'bg-gray-100 text-gray-700', MEDIUM: 'bg-yellow-100 text-yellow-700', HIGH: 'bg-red-100 text-red-700' }`
  - `PRIORITY_LABELS`: `{ LOW: 'Low', MEDIUM: 'Medium', HIGH: 'High' }`
- Component receives `tasks: SupportTaskData[]` prop
- State: `const [categoryFilter, setCategoryFilter] = useState<string>('all')`
- Filtering: `const filteredTasks = tasks.filter(t => categoryFilter === 'all' || t.category === categoryFilter)`
- Grouping: Map over `CATEGORY_ORDER` to create `{ category, label, tasks }` groups from `filteredTasks`, then `.filter(g => g.tasks.length > 0)` to hide empty categories
- Render structure:
  1. **Filter bar** at top: `Select` dropdown for category with "All Categories" default + 4 category options. Include "Clear filter" Button (ghost, sm) when filter active. Show "Showing X of Y tasks" count text on right side.
  2. **Category groups**: For each group, render a section with:
     - Category header: `<h2>` with category label and task count badge (e.g., "Design & Creative (8)")
     - Task grid: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`
     - Each task card: `Card` with left border color matching category (border-l-4), containing:
       - Header: taskId (small, gray) + priority badge (top right)
       - Body: task description (font-medium), owner with User icon, frequency with Clock icon
       - Footer: KR badges row -- each KR badge is a `Link href="/objectives"` wrapping a `Badge variant="outline"` with `className="cursor-pointer hover:bg-blue-50 text-blue-700 border-blue-200 text-xs"` showing `link.keyResult.krId`. Add a `title` attribute to Badge showing the full KR description on hover.
- Category border-left colors: `DESIGN_CREATIVE: border-l-purple-500`, `BUSINESS_ADMIN: border-l-blue-500`, `TALENTA_IDEAS: border-l-amber-500`, `OPERATIONS: border-l-green-500`

**Important notes:**
- Do NOT fetch via API route from the server component. Use Prisma directly (established pattern).
- Do NOT use URL-based filter state. Use client-side useState (30 items is tiny).
- Make sure empty category groups are filtered out when a category filter is active.
  </action>
  <verify>
Run `npx next build 2>&1 | tail -20` -- build succeeds with no TypeScript errors.
Visit http://localhost:3000/support-tasks -- page loads, shows 30 tasks in 4 category groups, filter works, KR badges are visible and clickable.
  </verify>
  <done>
/support-tasks page renders all 30 support tasks grouped by 4 categories. Each task shows taskId, description, owner, frequency, priority badge, and clickable KR badges. Category filter dropdown filters tasks by category with "All" default. KR badges link to /objectives. Empty categories are hidden when filtered.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Support Tasks to sidebar navigation</name>
  <files>
    src/components/layout/sidebar.tsx
    src/components/layout/mobile-sidebar.tsx
  </files>
  <action>
Update BOTH sidebar files to add "Support Tasks" navigation entry:

**1. `src/components/layout/sidebar.tsx`:**
- Add `ClipboardList` to the lucide-react import (line 7-22, add to the existing import block)
- Add `{ name: 'Support Tasks', href: '/support-tasks', icon: ClipboardList }` to the `navigation` array between the "Initiatives" entry (line 31) and the "Events to Attend" entry (line 32). The final array order should be: Dashboard, By Objective, Timeline, Kanban, Calendar, Initiatives, **Support Tasks**, Events to Attend.

**2. `src/components/layout/mobile-sidebar.tsx`:**
- Add `ClipboardList` to the lucide-react import block (lines 8-22, add to the second import)
- Add `{ name: 'Support Tasks', href: '/support-tasks', icon: ClipboardList }` to the `navigation` array between "Initiatives" and "Events to Attend" entries. Same position as desktop sidebar.

**Important:** Both files have SEPARATE navigation arrays. Both MUST be updated or the mobile sidebar will be missing the entry (Pitfall 1 from research).
  </action>
  <verify>
Run `npx next build 2>&1 | tail -20` -- build succeeds.
Check desktop sidebar at any page -- "Support Tasks" appears between "Initiatives" and "Events to Attend" with ClipboardList icon.
Resize browser to mobile width -- hamburger menu opens, "Support Tasks" appears in mobile sidebar too.
Click "Support Tasks" nav item -- navigates to /support-tasks page.
  </verify>
  <done>
"Support Tasks" appears in both desktop and mobile sidebar navigation between "Initiatives" and "Events to Attend" with the ClipboardList icon. Clicking it navigates to /support-tasks. Active state highlights correctly when on the support-tasks page.
  </done>
</task>

</tasks>

<verification>
1. `npx next build` completes with 0 errors
2. /support-tasks page loads and shows 30 support tasks in 4 category groups
3. Category filter works: selecting "Design & Creative" shows only that category's tasks; selecting "All Categories" shows all
4. Each task card displays: taskId, task description, owner, frequency, priority badge
5. KR badges are clickable and navigate to /objectives
6. "Support Tasks" nav item visible in desktop sidebar (between Initiatives and Events to Attend)
7. "Support Tasks" nav item visible in mobile sidebar (same position)
8. Nav item shows active state when on /support-tasks page
</verification>

<success_criteria>
- /support-tasks page displays all 30 support tasks grouped into 4 categories (Design & Creative, Business & Admin, Talenta Ideas, Operations) with each task showing taskId, description, owner, frequency, priority, and linked KR badges (UI-ST-01)
- Category filter dropdown lets users show all categories or filter to a single category; default shows all (UI-ST-02)
- "Support Tasks" appears in both desktop and mobile sidebar navigation under the OKR section, between Initiatives and Events to Attend (UI-ST-03)
- KR badges on support tasks are clickable and navigate to /objectives (UI-ST-04)
</success_criteria>

<output>
After completion, create `.planning/phases/50-support-tasks-ui/50-01-SUMMARY.md`
</output>
