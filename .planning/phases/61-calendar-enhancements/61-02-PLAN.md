# Plan 61-02: Week View Toggle & Expanded Display

## Frontmatter

- **Phase:** 61
- **Plan:** 02
- **Wave:** 2
- **Depends on:** 61-01
- **Files modified:** `src/components/calendar/calendar-view.tsx`
- **Autonomous:** Yes

## Objective

Add a month/week view toggle to the calendar. Week view shows 7 days with expanded vertical space, displaying ALL initiatives and events without truncation (no "+N more"). Satisfies CAL-01, CAL-02, CAL-03.

## Tasks

<task id="1">
**Add view mode state and toggle UI**

In `src/components/calendar/calendar-view.tsx`:

1. Add new state:
   ```typescript
   const [viewMode, setViewMode] = useState<'month' | 'week'>('month')
   ```

2. Import `addWeeks` and `subWeeks` from date-fns (add to existing import).

3. Add navigation functions for week mode:
   ```typescript
   const goToPrevWeek = () => setCurrentDate(subWeeks(currentDate, 1))
   const goToNextWeek = () => setCurrentDate(addWeeks(currentDate, 1))
   ```

4. In the CardHeader, add a view mode toggle button group BEFORE the Initiatives/Events toggles. Use two buttons ("Month" and "Week") with variant toggling (default when active, outline when inactive).

5. Update the prev/next navigation buttons to call the appropriate function based on viewMode:
   - Month mode: `goToPrevMonth` / `goToNextMonth`
   - Week mode: `goToPrevWeek` / `goToNextWeek`

6. Update the title display:
   - Month mode: `format(currentDate, 'MMMM yyyy')` (unchanged)
   - Week mode: Show week range like `format(weekStart, 'MMM d') + ' - ' + format(weekEnd, 'MMM d, yyyy')`
</task>

<task id="2">
**Implement week view grid**

1. Compute the week boundaries when in week mode:
   ```typescript
   const weekStart = startOfWeek(currentDate)
   const weekEnd = endOfWeek(currentDate)
   const weekDays = eachDayOfInterval({ start: weekStart, end: weekEnd })
   ```

2. Conditionally render a DIFFERENT grid for week view (keep month grid unchanged):

   Week view layout:
   - Same 7-column grid with day headers (Sun-Sat)
   - Each day cell has `min-h-[400px]` instead of `min-h-[120px]` for expanded vertical space
   - Show the date and day name at the top of each cell
   - No item limit: render ALL `dayInitiatives` and ALL `dayEvents` (no `.slice()`, no "+N more")
   - Events shown first (with ticket icon), then initiatives
   - Use slightly larger text `text-xs` instead of `text-[10px]` for readability
   - Each item gets `py-1 px-1.5` padding for better spacing
   - Initiative labels show the full `initiative.keyResult` string on the start day (this will now be "KR1.1 - Description" from plan 61-01)

3. Keep month view rendering exactly as-is (including the `.slice()` truncation and "+N more" overflow).
</task>

<task id="3">
**Update Today button behavior**

Ensure the "Today" button works correctly in both view modes:
- In month mode: navigates to current month (existing behavior)
- In week mode: navigates to the week containing today
- Both modes use `setCurrentDate(new Date())` which is already correct since startOfWeek/startOfMonth will recalculate
</task>

## Verification

- [ ] Calendar header shows Month/Week toggle buttons
- [ ] Clicking "Week" switches to week view with 7 day columns
- [ ] Clicking "Month" switches back to month view (unchanged behavior)
- [ ] Week view title shows date range (e.g., "Jan 25 - Jan 31, 2026")
- [ ] Week view day cells are tall (~400px min) showing all items
- [ ] Week view shows ALL initiatives and events per day - no "+N more" truncation
- [ ] Week view navigation buttons move by 1 week forward/backward
- [ ] Month view navigation still moves by 1 month (unchanged)
- [ ] Today button works in both views
- [ ] Initiative labels in week view show full KR name (e.g., "KR1.1 - Achieve RM1M Revenue")
- [ ] No TypeScript errors
- [ ] Page compiles and builds without errors

## Must-Haves

1. Toggle to switch between month view and week view (CAL-01)
2. Week view displays 7 days with expanded vertical space (CAL-02)
3. Week view shows all initiatives and events without "+N more" truncation (CAL-03)
4. Calendar labels show full KR names in both views (CAL-04 display)
