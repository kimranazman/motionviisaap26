# Plan 69-02: Settings Page Nested Display & Cascade Hide

## Frontmatter

```yaml
phase: 69
plan: 69-02
title: "Settings Page Nested Display & Cascade Hide"
wave: 1
depends_on: [69-01]
files_modified:
  - src/app/(dashboard)/settings/page.tsx
autonomous: true
```

## Goal

Update the Settings page to display nested nav items (Departments, Contacts) with visual indentation under their parent (Companies). Implement cascade hide logic: hiding the parent also hides all children. Children can be individually toggled when parent is visible.

## Requirements Addressed

- NEST-04: Sub-items can be individually hidden via Settings page toggles
- NEST-05: Hiding parent "Companies" also hides Departments and Contacts sub-items
- NEST-07: Settings page shows nested items with visual indentation under parent

## Tasks

<task id="1">
<title>Render nested items with indentation in Settings</title>
<file>src/app/(dashboard)/settings/page.tsx</file>
<action>
1. In the nav groups rendering section, update the `group.items.map()` loop to handle items with children.
2. For items WITH children:
   - Render the parent item row as before (icon, name, switch)
   - After the parent row, render each child item with additional left padding (`pl-8` or `ml-7`) to create visual nesting
   - Each child has its own Switch toggle
   - Children use smaller icon size (`h-3.5 w-3.5`) and slightly smaller text for visual hierarchy
   - Add a subtle left border or indent line for visual grouping (optional: `border-l-2 border-gray-100 ml-3`)

Here is the approximate JSX:
```tsx
{group.items.map((item) => {
  const alwaysOn = isAlwaysVisible(item.href)
  const visible = alwaysOn || !localHidden.includes(item.href)
  return (
    <div key={item.href}>
      {/* Parent item row */}
      <div className="flex items-center justify-between py-2 px-1">
        <div className="flex items-center gap-3">
          <item.icon className="h-4 w-4 text-gray-500" />
          <span className="text-sm text-gray-700">{item.name}</span>
          {alwaysOn && <span className="text-xs text-gray-400">(always visible)</span>}
        </div>
        <Switch
          checked={visible}
          onCheckedChange={() => handleToggleWithCascade(item)}
          disabled={alwaysOn}
        />
      </div>
      {/* Children (if any) */}
      {item.children && (
        <div className="ml-7 border-l-2 border-gray-100 pl-3 space-y-0.5">
          {item.children.map((child) => {
            const childVisible = !localHidden.includes(child.href) && visible
            return (
              <div key={child.href} className="flex items-center justify-between py-1.5 px-1">
                <div className="flex items-center gap-3">
                  <child.icon className="h-3.5 w-3.5 text-gray-400" />
                  <span className="text-sm text-gray-600">{child.name}</span>
                </div>
                <Switch
                  checked={childVisible}
                  onCheckedChange={() => handleToggle(child.href)}
                  disabled={!visible}
                />
              </div>
            )
          })}
        </div>
      )}
    </div>
  )
})}
```
</action>
</task>

<task id="2">
<title>Implement cascade hide logic</title>
<file>src/app/(dashboard)/settings/page.tsx</file>
<action>
1. Create a `handleToggleWithCascade` function that replaces `handleToggle` for parent items:
   ```typescript
   const handleToggleWithCascade = (item: NavItem) => {
     if (isAlwaysVisible(item.href)) return

     setLocalHidden((prev) => {
       const isCurrentlyHidden = prev.includes(item.href)
       if (isCurrentlyHidden) {
         // Unhiding parent: just remove parent from hidden list
         // Children remain in whatever state they were
         return prev.filter((h) => h !== item.href)
       } else {
         // Hiding parent: also hide all children
         const childHrefs = item.children?.map((c) => c.href) ?? []
         const newHidden = [...prev, item.href]
         for (const childHref of childHrefs) {
           if (!newHidden.includes(childHref)) {
             newHidden.push(childHref)
           }
         }
         return newHidden
       }
     })
   }
   ```
2. Import `NavItem` type from nav-config if not already imported
3. Child items still use the regular `handleToggle` function (no cascade needed for children)
4. When parent is hidden (visible=false), child switches are disabled and show as unchecked
5. The `childVisible` computed value handles display: `!localHidden.includes(child.href) && visible` â€” so if parent is hidden, all children appear unchecked/disabled regardless of their individual state
</action>
</task>

## Verification

```yaml
checks:
  - description: "Settings page imports NavItem type"
    command: "grep 'NavItem' src/app/(dashboard)/settings/page.tsx"
    expect: "import.*NavItem"

  - description: "Cascade hide function exists"
    command: "grep 'handleToggleWithCascade' src/app/(dashboard)/settings/page.tsx"
    expect: "handleToggleWithCascade"

  - description: "Children rendered with indentation"
    command: "grep 'ml-7\\|border-l' src/app/(dashboard)/settings/page.tsx"
    expect: "indentation classes"

  - description: "Children switches disabled when parent hidden"
    command: "grep 'disabled={!visible}' src/app/(dashboard)/settings/page.tsx"
    expect: "disabled prop based on parent visibility"

  - description: "App compiles without errors"
    command: "cd /Users/khairul/Documents/MyDev/Work/Motionvii/saap2026v2 && npx tsc --noEmit 2>&1 | head -20"
    expect: "no errors"
```

## must_haves

- Settings page shows Departments and Contacts indented under Companies
- Hiding Companies also hides Departments and Contacts
- Unhiding Companies does not auto-unhide children (they retain individual state)
- Children switches are disabled when parent is hidden
- Child items can be individually toggled when parent is visible
- Dirty detection and Save button still work correctly
- App compiles without TypeScript errors
