---
phase: 25-ai-document-intelligence
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/prompts/invoice-analysis.md
  - .claude/prompts/receipt-analysis.md
  - .claude/prompts/bulk-analysis.md
  - .claude/prompts/README.md
autonomous: true

must_haves:
  truths:
    - "Prompt templates exist for Claude Code to analyze invoices"
    - "Prompt templates exist for Claude Code to analyze receipts"
    - "Bulk analysis command can process multiple projects at once"
    - "Output format is documented and matches app import expectations"
  artifacts:
    - path: ".claude/prompts/invoice-analysis.md"
      provides: "Invoice analysis prompt template"
      min_lines: 50
    - path: ".claude/prompts/receipt-analysis.md"
      provides: "Receipt analysis prompt template"
      min_lines: 50
    - path: ".claude/prompts/bulk-analysis.md"
      provides: "Bulk project analysis prompt"
      min_lines: 30
    - path: ".claude/prompts/README.md"
      provides: "Usage instructions for prompts"
      min_lines: 20
  key_links:
    - from: ".claude/prompts/invoice-analysis.md"
      to: "manifest.json"
      via: "reads project context from manifest"
      pattern: "manifest.json"
    - from: ".claude/prompts/bulk-analysis.md"
      to: "uploads/projects/"
      via: "iterates over project folders"
      pattern: "projects/"
---

<objective>
Create prompt templates for Claude Code to analyze invoices and receipts.

Purpose: Provide structured prompts that Claude Code can use to extract financial data from documents, outputting JSON that the app can import.
Output: Prompt templates in .claude/prompts/ directory with clear output schemas.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-ai-document-intelligence/25-CONTEXT.md
@.planning/phases/25-ai-document-intelligence/25-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create invoice analysis prompt template</name>
  <files>.claude/prompts/invoice-analysis.md</files>
  <action>
Create .claude/prompts/ directory and invoice-analysis.md file.

The prompt should include:

1. Header explaining this analyzes invoice documents for SAAP 2026 app

2. Input section:
   - Document path to analyze
   - Reference to manifest.json for project context (company, existing categories)

3. Process section:
   - Read the invoice document (PDF or image)
   - Extract vendor/seller information
   - Extract invoice number and date
   - Extract ALL line items with description, quantity, unit price, amount
   - Calculate totals (subtotal, tax, total)
   - Assign confidence levels based on text clarity

4. Confidence rules:
   - HIGH: Clear text, unambiguous values
   - MEDIUM: Some OCR artifacts but values parseable
   - LOW: Unclear, estimated, or partially visible

5. Output format section with exact JSON schema:
```json
{
  "documentId": "from manifest",
  "confidence": "HIGH|MEDIUM|LOW",
  "invoiceNumber": "string or null",
  "invoiceDate": "YYYY-MM-DD or null",
  "vendor": "string or null",
  "lineItems": [
    {
      "description": "string",
      "quantity": "number or null",
      "unitPrice": "number or null",
      "amount": "number (required)",
      "confidence": "HIGH|MEDIUM|LOW"
    }
  ],
  "subtotal": "number or null",
  "tax": "number or null",
  "total": "number (required)",
  "notes": "any observations",
  "warnings": ["any issues encountered"]
}
```

6. Edge cases section:
   - Multi-page invoices: extract all pages
   - Handwritten amounts: mark as LOW confidence
   - Foreign currency: note in warnings, use original values
   - Missing totals: sum line items

7. Example output for reference
  </action>
  <verify>File exists at .claude/prompts/invoice-analysis.md with complete sections for input, process, output format, and examples.</verify>
  <done>Invoice analysis prompt template is complete with JSON output schema matching InvoiceExtraction type.</done>
</task>

<task type="auto">
  <name>Task 2: Create receipt analysis prompt template</name>
  <files>.claude/prompts/receipt-analysis.md</files>
  <action>
Create receipt-analysis.md in .claude/prompts/ directory.

The prompt should include:

1. Header explaining this analyzes receipt documents for expense tracking

2. Input section:
   - Document path to analyze
   - Reference to manifest.json for project context
   - Reference to existingCategories for category matching

3. Process section:
   - Read the receipt document (PDF or image)
   - Extract merchant/store name
   - Extract receipt date
   - Extract individual items or total if itemized breakdown not available
   - Match items to existing cost categories using fuzzy matching
   - Suggest category based on item description

4. Category matching rules:
   - "Labor" for staff/personnel costs
   - "Materials" for physical supplies, equipment
   - "Vendors" for third-party services, contractors
   - "Travel" for transport, accommodation, meals during travel
   - "Software" for licenses, subscriptions, digital services
   - "Other" for anything unclear

5. Confidence rules (same as invoice)

6. Output format section with exact JSON schema:
```json
{
  "documentId": "from manifest",
  "confidence": "HIGH|MEDIUM|LOW",
  "merchant": "string or null",
  "receiptDate": "YYYY-MM-DD or null",
  "items": [
    {
      "description": "string",
      "amount": "number (required)",
      "suggestedCategory": "category name",
      "suggestedCategoryId": "id from manifest or null",
      "confidence": "HIGH|MEDIUM|LOW"
    }
  ],
  "total": "number (required)",
  "paymentMethod": "cash|card|transfer|null",
  "notes": "any observations",
  "warnings": ["any issues encountered"]
}
```

7. Edge cases section:
   - Single total (no itemization): create one item with full amount
   - Multiple items same category: keep separate for tracking
   - Unclear category: use "Other" with LOW confidence

8. Example output for reference
  </action>
  <verify>File exists at .claude/prompts/receipt-analysis.md with category matching rules and JSON output schema matching ReceiptExtraction type.</verify>
  <done>Receipt analysis prompt template is complete with category matching rules and JSON output schema.</done>
</task>

<task type="auto">
  <name>Task 3: Create bulk analysis prompt and README</name>
  <files>.claude/prompts/bulk-analysis.md, .claude/prompts/README.md</files>
  <action>
Create bulk-analysis.md:

1. Header explaining this processes multiple projects at once

2. Input section:
   - Base uploads directory path
   - Optional: specific project IDs to process

3. Process section:
   - Scan uploads/projects/ for folders with manifest.json
   - For each project:
     - Read manifest.json
     - Process documents in pendingAnalysis array
     - Apply invoice-analysis for INVOICE category
     - Apply receipt-analysis for RECEIPT category
     - Skip OTHER category documents
   - Aggregate all results

4. Output format (AIAnalysisResult):
```json
{
  "version": "1.0",
  "analyzedAt": "ISO datetime",
  "projectId": "string",
  "invoices": [InvoiceExtraction objects],
  "receipts": [ReceiptExtraction objects],
  "errors": [
    { "documentId": "string", "error": "description" }
  ]
}
```

5. Output location:
   - Save to uploads/projects/{projectId}/ai-results.json
   - One file per project

6. Progress reporting:
   - Log each project being processed
   - Summary at end: X projects, Y documents, Z errors

Create README.md:

1. Overview of the prompt templates

2. Quick start:
   - Single invoice: `claude "Read .claude/prompts/invoice-analysis.md and analyze [document path]"`
   - Single receipt: `claude "Read .claude/prompts/receipt-analysis.md and analyze [document path]"`
   - Bulk all projects: `claude "Read .claude/prompts/bulk-analysis.md and process uploads/projects/"`

3. Prerequisites:
   - Manifests must be generated first (POST /api/projects/{id}/manifest)
   - Documents must be uploaded and categorized

4. Output handling:
   - Results saved to ai-results.json in project folder
   - Import via app UI (Review and Import button)

5. Troubleshooting:
   - If document fails: check warnings in output
   - If category wrong: edit in review UI before import
  </action>
  <verify>
Both files exist:
- .claude/prompts/bulk-analysis.md with AIAnalysisResult output format
- .claude/prompts/README.md with usage instructions
  </verify>
  <done>Bulk analysis prompt and README documentation are complete. Users can run Claude Code commands to analyze documents.</done>
</task>

</tasks>

<verification>
1. .claude/prompts/ directory exists with 4 files
2. invoice-analysis.md has complete JSON schema for InvoiceExtraction
3. receipt-analysis.md has category matching rules and ReceiptExtraction schema
4. bulk-analysis.md explains multi-project processing with AIAnalysisResult output
5. README.md has clear usage instructions for all three prompts
</verification>

<success_criteria>
- All 4 prompt files created in .claude/prompts/ directory
- Invoice prompt outputs JSON matching InvoiceExtraction type
- Receipt prompt outputs JSON matching ReceiptExtraction type
- Bulk prompt outputs to ai-results.json in project folders
- README explains how to use each prompt
</success_criteria>

<output>
After completion, create `.planning/phases/25-ai-document-intelligence/25-02-SUMMARY.md`
</output>
