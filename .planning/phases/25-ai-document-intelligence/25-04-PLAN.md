---
phase: 25-ai-document-intelligence
plan: 04
type: execute
wave: 3
depends_on: ["25-03"]
files_modified:
  - src/components/ai/ai-review-sheet.tsx
  - src/components/ai/extraction-table.tsx
  - src/components/ai/confidence-badge.tsx
autonomous: true

must_haves:
  truths:
    - "User can review AI-extracted data in a slide-out sheet"
    - "Extraction table shows items with inline editing capability"
    - "Confidence levels displayed with color-coded badges"
    - "User can select which items to import"
  artifacts:
    - path: "src/components/ai/ai-review-sheet.tsx"
      provides: "Main review interface component"
      min_lines: 100
    - path: "src/components/ai/extraction-table.tsx"
      provides: "Editable table for extraction items"
      min_lines: 80
    - path: "src/components/ai/confidence-badge.tsx"
      provides: "Confidence level badge component"
      min_lines: 20
  key_links:
    - from: "src/components/ai/ai-review-sheet.tsx"
      to: "/api/ai/import/invoice"
      via: "fetch call on confirm"
      pattern: "api/ai/import"
    - from: "src/components/ai/extraction-table.tsx"
      to: "src/components/ai/confidence-badge.tsx"
      via: "import and render"
      pattern: "ConfidenceBadge"
---

<objective>
Create the AI review sheet UI for users to review and confirm AI-extracted data.

Purpose: Allow users to verify, edit, and selectively import AI extractions before they become actual cost entries or revenue updates.
Output: AIReviewSheet component with extraction table and confidence indicators.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-ai-document-intelligence/25-CONTEXT.md
@.planning/phases/25-ai-document-intelligence/25-RESEARCH.md
@.planning/phases/25-ai-document-intelligence/25-03-SUMMARY.md
@src/components/projects/project-detail-sheet.tsx
@src/types/ai-extraction.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create confidence badge component</name>
  <files>src/components/ai/confidence-badge.tsx</files>
  <action>
Create src/components/ai/ directory and confidence-badge.tsx:

'use client' component that displays confidence level with appropriate color.

Props:
- confidence: 'HIGH' | 'MEDIUM' | 'LOW'
- className?: string (optional additional classes)

Color scheme (matching CONTEXT.md decisions):
- HIGH: bg-green-100 text-green-700 border-green-200
- MEDIUM: bg-yellow-100 text-yellow-700 border-yellow-200
- LOW: bg-red-100 text-red-700 border-red-200

Use shadcn Badge component with variant="outline" and apply colors via cn().

Display text as the confidence level (e.g., "High", "Medium", "Low" - title case).

Export: ConfidenceBadge component and CONFIDENCE_COLORS constant for reuse.
  </action>
  <verify>Component renders correctly with all three confidence levels and appropriate colors.</verify>
  <done>ConfidenceBadge component displays color-coded confidence indicators.</done>
</task>

<task type="auto">
  <name>Task 2: Create extraction table component</name>
  <files>src/components/ai/extraction-table.tsx</files>
  <action>
Create extraction-table.tsx - a generic editable table for AI extraction items.

Props:
- type: 'invoice' | 'receipt'
- items: Array of line items (InvoiceLineItem or ReceiptItem)
- categories?: CostCategory[] (only for receipts)
- onItemChange: (index: number, updates: Partial<Item>) => void
- onSelectionChange: (index: number, selected: boolean) => void
- selectedItems: boolean[] (which items are selected for import)

For INVOICE type, columns:
- Checkbox (select for import)
- Description (editable Input)
- Quantity (editable Input, type number)
- Unit Price (editable Input, type number)
- Amount (editable Input, type number, required)
- Confidence (ConfidenceBadge)

For RECEIPT type, columns:
- Checkbox (select for import)
- Description (editable Input)
- Amount (editable Input, type number, required)
- Category (Select dropdown with categories)
- Confidence (ConfidenceBadge)

Features:
- Use shadcn Table components (Table, TableHeader, TableBody, TableRow, TableCell)
- Inline editing: click cell to edit, blur to save
- Checkbox in header to select/deselect all
- Show total at bottom row
- Auto-fill high confidence items as selected by default

Use controlled inputs - parent manages state through onItemChange callback.
  </action>
  <verify>
Component renders table with correct columns for both invoice and receipt types.
Inline editing works (type in cell, value updates).
Checkboxes toggle selection state.
  </verify>
  <done>ExtractionTable component provides editable table with selection for both invoice and receipt extraction types.</done>
</task>

<task type="auto">
  <name>Task 3: Create AI review sheet component</name>
  <files>src/components/ai/ai-review-sheet.tsx</files>
  <action>
Create ai-review-sheet.tsx - main review interface following ProjectDetailSheet pattern.

Props:
- open: boolean
- onOpenChange: (open: boolean) => void
- projectId: string
- document: Document (with aiStatus)
- extraction: InvoiceExtraction | ReceiptExtraction
- categories: CostCategory[] (for receipt category selection)
- onImportComplete: () => void (callback after successful import)

Structure (matching project-detail-sheet.tsx layout):
```
<Sheet>
  <SheetContent className="w-full sm:max-w-2xl p-0 flex flex-col">
    <SheetHeader>
      - Document filename with category badge
      - Overall confidence badge
    </SheetHeader>

    <ScrollArea className="flex-1">
      <div className="p-6 space-y-4">
        {/* Document Preview */}
        - For images: img tag with document URL
        - For PDFs: "Open PDF" link (new tab)

        {/* Extraction Summary */}
        - Type: Invoice/Receipt
        - Date: extracted date
        - Vendor/Merchant: extracted name
        - Total: formatted currency

        <Separator />

        {/* Extraction Table */}
        <ExtractionTable ... />

        {/* Warnings Section */}
        - Display any warnings from extraction
      </div>
    </ScrollArea>

    <SheetFooter>
      - "Discard" button (close without import)
      - "Import Selected" button (calls import API)
    </SheetFooter>
  </SheetContent>
</Sheet>
```

State management:
- Local state for edited items (initialized from extraction)
- Local state for selection array
- Loading state for import action

Import action:
- For invoice: POST /api/ai/import/invoice
- For receipt: POST /api/ai/import/receipt with selected items
- On success: show toast, call onImportComplete callback
- On error: show error toast

Use sonner for toast notifications (already in codebase from Phase 24).
  </action>
  <verify>
Component renders with document preview, extraction table, and action buttons.
Import button calls correct API based on extraction type.
Toast shows on success/error.
  </verify>
  <done>AIReviewSheet provides complete review interface with document preview, editable extraction table, and import functionality.</done>
</task>

</tasks>

<verification>
1. ConfidenceBadge renders with correct colors for HIGH/MEDIUM/LOW
2. ExtractionTable shows correct columns for invoice vs receipt types
3. Inline editing works in ExtractionTable
4. AIReviewSheet displays document preview and extraction data
5. Import button calls correct API and shows success/error feedback
</verification>

<success_criteria>
- Confidence badges are visually distinct (green/yellow/red)
- Extraction table is editable with checkbox selection
- Review sheet follows established Sheet UI pattern from project-detail-sheet
- Invoice import updates project revenue
- Receipt import creates selected cost entries
- User receives feedback via toast notifications
</success_criteria>

<output>
After completion, create `.planning/phases/25-ai-document-intelligence/25-04-SUMMARY.md`
</output>
