# Technology Stack: v2.1 Navigation, Cross-Project Tasks, Workload Dashboards

**Project:** SAAP 2026 v2.1
**Researched:** 2026-01-27
**Scope:** What is NEW for v2.1 -- collapsible sidebar navigation groups, standalone cross-project task view (table + kanban toggle), and per-member workload dashboard pages

---

## Executive Summary

v2.1 requires **one new npm package** (`@tanstack/react-table`) and **one new shadcn component** (the full `sidebar` component). Everything else builds on what already exists.

| Capability | Status | Action |
|---|---|---|
| Collapsible sidebar groups | Partially exists (Radix Collapsible installed, but sidebar is hand-rolled) | Install shadcn `sidebar` component OR refactor hand-rolled sidebar with existing `Collapsible` primitive |
| Data table for cross-project task view | Not installed | Install `@tanstack/react-table` v8 |
| Kanban view for tasks | Exists (`@dnd-kit` kanban) | Adapt existing `KanbanBoard` pattern to Task model |
| Table + Kanban toggle | Pattern exists (kanban has Board/By-Person toggle) | Reuse `Tabs` toggle pattern |
| Workload dashboards | Partially exists (`TeamWorkload` widget, `recharts` charts) | Build full pages using existing `recharts` + `Progress` + `Avatar` |
| URL state for filters | Not installed, not needed for 3-person team | Use React `useState` (simpler) |

**Net new packages: 1** (`@tanstack/react-table`)
**Net new shadcn components: 0-1** (sidebar -- see decision below)

---

## Decision 1: Sidebar Approach

### Option A: Install shadcn `sidebar` Component (RECOMMENDED AGAINST)

The shadcn sidebar (`npx shadcn@latest add sidebar`) is a comprehensive 25-sub-component system (`SidebarProvider`, `SidebarMenu`, `SidebarGroup`, `SidebarMenuSub`, etc.) that would **replace the entire existing sidebar**. It introduces:

- `SidebarProvider` context for collapse state
- `SidebarRail` for toggle interaction
- Full collapsible-to-icon mode
- Cookie-based persistence of collapsed state

**Why NOT to use it:**
- The existing sidebar (`src/components/layout/sidebar.tsx` + `mobile-sidebar.tsx`) is only 192 lines and works well
- Adopting the full shadcn sidebar means rewriting both sidebar and mobile-sidebar, plus the root layout
- The full component system is designed for complex enterprise sidebars -- overkill for a 3-person team app with ~15 nav items
- It would touch every page's layout, creating unnecessary risk for a v2.1 milestone

### Option B: Refactor Existing Sidebar with Collapsible Primitive (RECOMMENDED)

The project already has:
- `@radix-ui/react-collapsible` v1.1.12 installed
- `src/components/ui/collapsible.tsx` (the shadcn Collapsible wrapper)
- A sidebar that uses static section headers ("CRM", "Admin") as visual dividers

**What to do:** Wrap each navigation group in the existing `Collapsible` component. This changes the sidebar from:

```
-- Dashboard
-- Timeline
-- Kanban
-- ...
CRM (static header)
-- Companies
-- Pipeline
-- ...
```

To:

```
v Planning (collapsible)
  -- Dashboard
  -- Timeline
  -- Kanban
  -- ...
v CRM (collapsible)
  -- Companies
  -- Pipeline
  -- ...
v Admin (collapsible)
  -- Users
```

**Stack needed:** Nothing new. Uses `Collapsible`, `CollapsibleTrigger`, `CollapsibleContent` from existing `@radix-ui/react-collapsible`.

**Persist collapse state:** Use `localStorage` via a custom hook. No npm package needed. Pattern:

```typescript
// src/hooks/use-sidebar-state.ts
function useSidebarState() {
  const [collapsed, setCollapsed] = useState<Record<string, boolean>>(() => {
    if (typeof window === 'undefined') return {}
    const saved = localStorage.getItem('sidebar-collapsed')
    return saved ? JSON.parse(saved) : {}
  })
  // ... sync to localStorage on change
}
```

**Confidence:** HIGH -- The Collapsible primitive is already installed and used in the project (see `src/components/ui/collapsible.tsx`). This is 50-100 lines of refactoring, not a library installation.

---

## Decision 2: Cross-Project Task Table

### Recommended: `@tanstack/react-table` v8

| Attribute | Value |
|---|---|
| Package | `@tanstack/react-table` |
| Version | 8.21.3 (latest stable, published April 2025) |
| Weekly downloads | 5.3M+ |
| React compatibility | React 18 (confirmed) |
| Type | Headless -- no UI opinions, pairs with existing shadcn `Table` component |

**Why this library:**

1. **shadcn recommends it.** The shadcn [Data Table guide](https://ui.shadcn.com/docs/components/data-table) is built entirely on `@tanstack/react-table`. The project already uses shadcn for all UI.
2. **Headless architecture.** Provides sorting, filtering, pagination, column visibility logic without dictating markup. Renders through the existing `src/components/ui/table.tsx` (Table, TableHeader, TableBody, TableRow, TableCell, etc.).
3. **The cross-project task view needs real table features.** Tasks across all projects need: column sorting (by project, assignee, status, priority, due date), filtering (by project, by member, by status), and pagination (task list could grow). A basic HTML table would require reimplementing all of these.
4. **The project already has the Table UI component** (`src/components/ui/table.tsx`) ready to pair with TanStack's headless logic.

**Why not alternatives:**

| Alternative | Why Not |
|---|---|
| Plain HTML `<table>` | No built-in sorting, filtering, pagination. Would need manual implementation for every feature. |
| AG Grid / MUI DataGrid | Full-featured but heavyweight, not shadcn-compatible styling, overkill for this data volume. |
| `react-data-grid` | Good but brings its own styling system that clashes with Tailwind/shadcn. |
| Custom table with `useState` | Feasible for a fixed table, but the task view needs column sorting + multi-filter + pagination -- exactly what TanStack provides. |

**Installation:**

```bash
npm install @tanstack/react-table
```

**Architecture pattern (following shadcn data-table guide):**

```
src/app/(dashboard)/tasks/
  page.tsx              # Server component: fetch all tasks across projects
  columns.tsx           # Column definitions with sorting, formatting
  data-table.tsx        # Client component: useReactTable + Table UI
  data-table-toolbar.tsx # Filters: project, assignee, status, priority
```

**Confidence:** HIGH -- This is the standard pairing for shadcn + data tables in 2025/2026. 5M+ weekly downloads. The shadcn docs literally build a data table with this library.

---

## Decision 3: Task Kanban View (Table/Kanban Toggle)

### Recommended: Reuse Existing @dnd-kit Pattern

The project already has a full kanban implementation:
- `@dnd-kit/core` v6.3.1
- `@dnd-kit/sortable` v10.0.0
- `@dnd-kit/utilities` v3.2.2
- `src/components/kanban/kanban-board.tsx` -- 586 lines of working kanban with DnD, filters, swimlanes

**The task kanban is structurally identical to the initiative kanban:**

| Initiative Kanban | Task Kanban |
|---|---|
| Columns: TO_DO, IN_PROGRESS, NEEDS_ATTENTION, DONE | Columns: TODO, IN_PROGRESS, DONE |
| Cards: initiative title, person, key result, dates | Cards: task title, assignee, project name, priority, due date |
| Drag to change status | Drag to change status |
| Filter bar: search, person, key result, date | Filter bar: search, assignee, project, priority |
| Toggle: Board / By Person | Toggle: Table / Kanban |

**Stack needed:** Nothing new. Reuse `@dnd-kit` components and adapt the kanban pattern.

**Architecture:**

```
src/components/tasks/
  task-kanban-board.tsx     # Adapted from kanban-board.tsx for Task model
  task-kanban-column.tsx    # Column component
  task-kanban-card.tsx      # Card component (shows project name + assignee)
```

**The toggle itself** uses the existing `Tabs` component (already used in kanban for Board/By-Person toggle):

```tsx
<Tabs value={viewMode} onValueChange={setViewMode}>
  <TabsList>
    <TabsTrigger value="table">
      <TableIcon /> Table
    </TabsTrigger>
    <TabsTrigger value="kanban">
      <KanbanSquare /> Kanban
    </TabsTrigger>
  </TabsList>
</Tabs>
```

**Confidence:** HIGH -- Exact same pattern already works in production (`src/components/kanban/kanban-board.tsx` lines 480-496).

---

## Decision 4: Workload Dashboard Charts

### Recommended: Recharts (Already Installed)

| Attribute | Value |
|---|---|
| Package | `recharts` |
| Version | 3.6.0 (already installed) |
| Existing usage | `status-chart.tsx` (PieChart), `department-chart.tsx`, `pipeline-stage-chart.tsx` |

**What workload dashboards need:**

| Visualization | Recharts Component | Exists in Project? |
|---|---|---|
| Task count by status per member | `BarChart` with stacked bars | Pattern exists (`pipeline-stage-chart.tsx`) |
| Initiative progress per member | `BarChart` horizontal | Pattern exists |
| Tasks due this week per member | `BarChart` simple | Pattern exists |
| Overall workload distribution | `PieChart` donut | Pattern exists (`status-chart.tsx`) |
| Heatmap (tasks by week x member) | NOT native to Recharts | See note below |

**On heatmaps:** Recharts does not have native heatmap support (open issue [#237](https://github.com/recharts/recharts/issues/237) since 2016). For a 3-person team, a heatmap is unnecessary -- a stacked bar chart or simple grid with colored cells (using Tailwind background colors) communicates the same information more clearly. Do NOT add a separate charting library just for heatmaps.

**Alternative considered and rejected:**

| Library | Why Not |
|---|---|
| `nivo` | Different API style, would create inconsistency with existing recharts charts. Adding a second charting library for one visualization type is wrong. |
| `echarts-for-react` | Heavyweight (1MB+), completely different paradigm. Overkill. |
| `react-apexcharts` | Has heatmap support but adds another charting system. Not worth it for 3 team members. |
| CSS grid heatmap | Use Tailwind `bg-*` colors on a CSS grid for the "availability" or "load by week" view. Zero dependency, perfectly sufficient for 3 people x 52 weeks. |

**Stack needed:** Nothing new.

**Confidence:** HIGH -- Three existing chart components prove `recharts` 3.6.0 works. The existing `TeamWorkload` widget (`src/components/dashboard/team-workload.tsx`) already renders per-member workload with avatars and progress bars.

---

## Decision 5: URL State Management for Filters

### Recommended: Do NOT Install `nuqs`

`nuqs` is the standard library for URL-based filter state in Next.js apps. It is excellent for:
- Multi-user apps where users share filtered views via URL
- Complex dashboards with many filter combinations
- SEO-sensitive pages where URL reflects content

**Why NOT for SAAP 2026:**
- 3-person team -- nobody is sharing filter URLs
- Existing filter patterns in the codebase all use React `useState` (see `kanban-board.tsx` lines 192-196, `kanban-filter-bar.tsx`)
- Adding URL state management introduces complexity (adapter setup, serializers, layout wrapping) for zero user benefit
- Consistency with existing patterns matters more than theoretical best practice

**Use plain `useState` + optional `localStorage` persistence** for filter state, matching the existing kanban filter pattern.

**If later needed:** `nuqs` v2 can be added incrementally. It is not an architectural decision -- it is a convenience layer.

**Confidence:** HIGH -- This is a deliberate simplicity choice, not ignorance of the alternative.

---

## Decision 6: Data Fetching for Cross-Project Queries

### Recommended: Prisma Server-Side Queries (Existing Pattern)

The cross-project task view needs:
```sql
SELECT tasks.*, projects.title as projectTitle, projects.company.name as companyName
FROM tasks
JOIN projects ON tasks.project_id = projects.id
JOIN companies ON projects.company_id = companies.id
WHERE tasks.assignee = ? AND tasks.status = ?
ORDER BY tasks.due_date ASC
```

This is a standard Prisma `findMany` with `include`:

```typescript
const tasks = await prisma.task.findMany({
  where: { assignee: member },
  include: {
    project: { select: { title: true, company: { select: { name: true } } } },
    tags: { include: { tag: true } },
  },
  orderBy: { dueDate: 'asc' },
})
```

**No new data fetching library needed.** The project uses Next.js Server Components with direct Prisma queries (see every `page.tsx` in `src/app/(dashboard)/`). No SWR, no React Query, no tRPC.

**For the member workload page**, aggregate queries:

```typescript
const taskCounts = await prisma.task.groupBy({
  by: ['assignee', 'status'],
  _count: true,
  where: { assignee: member },
})

const initiativeCounts = await prisma.initiative.groupBy({
  by: ['personInCharge', 'status'],
  _count: true,
  where: { personInCharge: member },
})
```

**Confidence:** HIGH -- `prisma.task.groupBy` is a documented Prisma feature. The existing dashboard stats API (`src/app/api/dashboard/stats/route.ts`) already uses similar aggregation patterns.

---

## Recommended Stack (Complete)

### New Package

| Package | Version | Purpose | Install |
|---|---|---|---|
| `@tanstack/react-table` | ^8.21.3 | Headless table logic for cross-project task view | `npm install @tanstack/react-table` |

### Existing Packages (No Changes)

| Package | Version | v2.1 Use |
|---|---|---|
| `@radix-ui/react-collapsible` | 1.1.12 | Sidebar navigation groups |
| `@dnd-kit/core` + `@dnd-kit/sortable` | 6.3.1 / 10.0.0 | Task kanban view |
| `recharts` | 3.6.0 | Workload dashboard charts |
| `@radix-ui/react-tabs` | 1.1.13 | Table/Kanban view toggle |
| `@radix-ui/react-avatar` | 1.1.11 | Member avatars in workload pages |
| `@radix-ui/react-progress` | 1.1.8 | Progress bars in workload views |
| `@prisma/client` | 6.19.2 | Cross-project task queries + aggregations |
| `date-fns` | 4.1.0 | Due date formatting, "overdue" calculations |
| `lucide-react` | 0.562.0 | Icons (TableIcon, KanbanSquare, Users, etc.) |

### Existing shadcn UI Components (No Installation)

| Component | v2.1 Use |
|---|---|
| `collapsible.tsx` | Sidebar group collapse/expand |
| `table.tsx` | Task table markup (paired with TanStack) |
| `tabs.tsx` | Table/Kanban view toggle |
| `card.tsx` | Task kanban cards, workload summary cards |
| `badge.tsx` | Status/priority badges on tasks |
| `avatar.tsx` | Member avatars |
| `progress.tsx` | Workload progress bars |
| `select.tsx` | Filter dropdowns |
| `tooltip.tsx` | Chart tooltips, info hints |
| `skeleton.tsx` | Loading states |
| `sheet.tsx` | Task detail sheet (reuse existing `task-detail-sheet.tsx`) |
| `scroll-area.tsx` | Sidebar scroll when groups are expanded |

---

## What NOT to Install

| Package | Why You Might Think You Need It | Why You Don't |
|---|---|---|
| `shadcn sidebar` (full component) | Official shadcn sidebar has collapsible groups built in | Replacing the entire sidebar and layout for nav grouping is a disproportionate change. The existing `Collapsible` primitive achieves the same result with 50 lines of refactoring. |
| `nuqs` | URL state for table filters | 3-person team does not need shareable filter URLs. `useState` matches existing patterns. |
| `swr` or `@tanstack/react-query` | Client-side data fetching for task list | The project uses Server Components + direct Prisma queries. No client-side fetching library needed. |
| `nivo` / `echarts-for-react` / `react-apexcharts` | Heatmap charts for workload | Recharts covers all needed chart types. A CSS grid with Tailwind colors handles the "heatmap" use case for 3 people. |
| `react-beautiful-dnd` | Drag and drop for kanban | Already using `@dnd-kit` which is its modern replacement. |
| `ag-grid` / `@mui/x-data-grid` | Enterprise data grid | Massive bundle, non-shadcn styling, overkill for project task lists. |
| `date-fns-tz` | Timezone handling | 3 people in same timezone. Not needed. |
| `zustand` / `jotai` | Global state for sidebar/filter state | `useState` + `localStorage` handles sidebar state. React context handles anything else. No global state library needed for this scope. |

---

## Installation Commands

```bash
# The only new package
npm install @tanstack/react-table

# Verify no peer dependency issues
npm ls @tanstack/react-table
```

No other installation needed. All other capabilities come from existing packages.

---

## New File Structure (Recommended)

```
src/
  app/(dashboard)/
    tasks/                          # NEW: Cross-project task page
      page.tsx                      # Server component: fetch tasks
      columns.tsx                   # TanStack column definitions
      data-table.tsx                # DataTable client component
      data-table-toolbar.tsx        # Filter bar
    members/                        # NEW: Member workload pages
      page.tsx                      # Member list / overview
      [member]/
        page.tsx                    # Per-member workload dashboard
  components/
    layout/
      sidebar.tsx                   # MODIFY: Add collapsible groups
      mobile-sidebar.tsx            # MODIFY: Add collapsible groups
    tasks/                          # NEW: Cross-project task components
      task-kanban-board.tsx         # Adapted from kanban/kanban-board.tsx
      task-kanban-column.tsx        # Adapted from kanban/kanban-column.tsx
      task-kanban-card.tsx          # Task card for cross-project view
      task-table-columns.tsx        # Column definitions (alternative location)
    members/                        # NEW: Member workload components
      member-card.tsx               # Summary card for a team member
      member-task-chart.tsx         # Recharts bar chart of task status
      member-initiative-chart.tsx   # Recharts bar chart of initiative status
      member-workload-grid.tsx      # CSS grid "heatmap" of weekly load
  hooks/
    use-sidebar-state.ts            # NEW: localStorage-backed collapse state
  app/api/
    tasks/
      route.ts                      # NEW: GET all tasks (cross-project, with filters)
    members/
      [member]/
        stats/route.ts              # NEW: GET workload stats for a member
```

---

## Confidence Assessment

| Area | Confidence | Reason |
|---|---|---|
| Sidebar: use Collapsible primitive | HIGH | Package already installed, component already exists, 50-line refactor |
| Task table: @tanstack/react-table | HIGH | 5M+ weekly downloads, shadcn official recommendation, pairs with existing Table UI |
| Task kanban: reuse @dnd-kit | HIGH | Working kanban already exists, same structural pattern |
| Workload charts: recharts | HIGH | 3 chart components already prove the pattern, recharts 3.6.0 installed |
| No nuqs needed | HIGH | Deliberate simplicity choice for 3-person team |
| No additional charting library | HIGH | CSS grid + Tailwind handles "heatmap" for 3 people |
| Prisma aggregation queries | HIGH | `groupBy` is documented, existing stats API uses similar patterns |

---

## Sources

- [shadcn/ui Sidebar Component](https://ui.shadcn.com/docs/components/sidebar) -- Official sidebar documentation
- [shadcn/ui Collapsible Component](https://ui.shadcn.com/docs/components/collapsible) -- Used for nav group collapse
- [shadcn/ui Data Table Guide](https://ui.shadcn.com/docs/components/data-table) -- Official data table pattern with TanStack
- [@tanstack/react-table npm](https://www.npmjs.com/package/@tanstack/react-table) -- v8.21.3, 5.3M weekly downloads
- [TanStack Table Documentation](https://tanstack.com/table/latest) -- API reference, React adapter
- [Recharts GitHub](https://github.com/recharts/recharts) -- Heatmap support issue #237
- [nuqs](https://nuqs.dev/) -- Evaluated and deliberately excluded
- Codebase analysis: `package.json`, `src/components/layout/sidebar.tsx`, `src/components/kanban/kanban-board.tsx`, `src/components/dashboard/team-workload.tsx`, `src/components/dashboard/status-chart.tsx`, `src/lib/task-utils.ts`, `src/components/ui/collapsible.tsx`, `src/components/ui/table.tsx`, `prisma/schema.prisma`
