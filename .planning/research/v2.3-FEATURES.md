# Feature Landscape: v2.3 CRM & UX Improvements

**Domain:** CRM entity browsing, customizable sidebar navigation, line item pricing history
**Researched:** 2026-01-28
**Confidence:** HIGH (codebase-grounded analysis + domain research)

---

## Table Stakes

Features users expect. Missing = product feels incomplete or broken.

### CRM Entity Browsing

| Feature | Why Expected | Complexity | Notes |
|---------|--------------|------------|-------|
| **Standalone Departments page** (`/departments`) | Departments exist as entities (schema has Department model with company, contacts, deals, potentials relations) but have no browsable page -- only accessible nested inside company detail modal. Users cannot see "all departments across all companies" or filter/search them independently. | Low | Follow existing `/companies` page pattern: server component fetches all, client component renders table with search + company filter. |
| **Standalone Contacts page** (`/contacts`) | Same pattern as departments. Contacts are first-class entities (own model, linked to company + department + deals + potentials + projects) but are only accessible nested inside company detail modal. A 3-person team frequently needs "find contact by name" without knowing which company they belong to. | Low-Med | Follow `/companies` pattern. Add company and department filter columns. Include role, email, phone in table. |
| **Company filter on Departments page** | If browsing all departments, users immediately need to narrow by company. Without this, the list is a wall of department names with no context. | Low | Reuse combobox/select pattern from existing filter bars. |
| **Department filter on Contacts page** | Contacts linked to departments need filtering by department. Without this, contacts from engineering vs. marketing are jumbled together. | Low | Cascading filter: select company first, then departments populate. |
| **Cross-entity navigation links** | When viewing a department, users expect to click through to the parent company. When viewing a contact, users expect to click through to their company and department. | Low | Add clickable badges/links in table rows and detail views. |
| **Contact detail modal/sheet** | Clicking a contact row should open a detail view (Dialog/Drawer via existing `DetailView` component), showing full contact info, related deals, projects, and company context. | Med | Follow `CompanyDetailModal` pattern. Reuse `DetailView` wrapper. |
| **Department detail modal/sheet** | Clicking a department row should show department info, contacts in that department, and related deals/potentials. | Med | Follow `CompanyDetailModal` pattern. Simpler than contact detail. |
| **Add nav items to CRM group** | New pages need sidebar nav links. Currently the CRM group has: Companies, Pipeline, Potential Projects, Projects, Suppliers, Price Comparison. Must add Departments and Contacts. | Low | Extend `navGroups[1].items` in `nav-config.ts`. Choose appropriate lucide icons (e.g., `Building` for Departments, `Contact` or `UserRound` for Contacts). |

### Task Management

| Feature | Why Expected | Complexity | Notes |
|---------|--------------|------------|-------|
| **Add Task button on cross-project /tasks page** | The `/tasks` page has table/kanban views with 6 filters but NO way to create a task. Users must navigate to a specific project to create tasks. This is a missing CRUD entry point -- every list page in the app has an Add button (Companies has "Add Company", Suppliers has "Add Supplier", etc.). | Low-Med | Add a `+ Add Task` button to the tasks toolbar. Requires a project selector since tasks must belong to a project (`projectId` is required in the Task model). Use a dialog with project combobox + task form fields. |
| **Subtask creation from cross-project tasks page** | The task detail sheet already supports viewing subtasks (via `task-tree` component). Users need to add subtasks from the cross-project view without navigating to the project page. | Med | Extend the `TaskDetailSheet` to include an "Add Subtask" button that creates a child task with the same projectId and incremented depth. The `TaskForm` already accepts `parentId` prop. |

### Internal Projects Flag

| Feature | Why Expected | Complexity | Notes |
|---------|--------------|------------|-------|
| **`isInternal` boolean on Project model** | Motionvii and Talenta do internal work that needs tracking alongside client projects. Without a flag, internal projects are mixed with client projects in all views, polluting revenue reports and pipeline metrics. | Low | Add `isInternal Boolean @default(false)` to Project schema. Add filter to `/projects` page. Visual badge "Internal" on project cards. |
| **Internal project filter on /projects page** | Users need to toggle between "all", "client only", "internal only" views. | Low | Add Select filter to existing project list toolbar. |
| **Internal project visual distinction** | At a glance, users need to see which projects are internal vs. client. | Low | Badge with distinct color (e.g., amber/yellow "Internal" badge on project cards and table rows). |

### Modal / UX Fixes

| Feature | Why Expected | Complexity | Notes |
|---------|--------------|------------|-------|
| **Modal scroll fix** | Existing `DetailView` component uses `ScrollArea` but some modals (specifically company detail with many contacts/departments) may have scroll issues when content exceeds viewport. | Low | Audit and fix CSS: ensure `max-h-[80vh]` or similar constraint on DialogContent, `overflow-y-auto` on scroll container. The `DetailView` already uses ScrollArea -- verify it works for all content sizes. |
| **Expand-to-page from modal** | The `DetailView` component already has an `expandHref` prop that renders an expand button linking to a full page. This needs to be wired up for entity modals that have dedicated pages (e.g., project detail already has `/projects/[id]`). For new entity modals (departments, contacts), if they get dedicated pages, wire expandHref. | Low | Pass `expandHref={`/projects/${id}`}` etc. to DetailView. For entities without dedicated pages, omit. |

### Customizable Sidebar

| Feature | Why Expected | Complexity | Notes |
|---------|--------------|------------|-------|
| **Toggle nav link visibility** | With 16+ nav items across SAAP (8 items), CRM (now 8 items with Departments + Contacts), and Admin groups, users want to hide links they rarely use. A designer may hide SAAP strategy items; a finance person may hide Pipeline. | Med | Add `hiddenNavItems: string[]` to UserPreferences (JSON field). Filter `navGroups` items by checking against hidden list before rendering. |
| **Sidebar customization UI in Settings** | Users need a settings panel to toggle link visibility. The Settings page already exists at `/settings` with "Detail View Mode" preference. | Med | Add a new Card section to Settings page with checkboxes/switches for each nav item. Group by nav group (SAAP, CRM, Admin). Save to UserPreferences via PATCH API. |

---

## Differentiators

Features that set the product apart. Not expected in a basic tool, but high-value for this team.

### Line Item Pricing History

| Feature | Value Proposition | Complexity | Notes |
|---------|-------------------|------------|-------|
| **By-item pricing history view** | The existing Price Comparison page (`/supplier-items`) shows costs grouped by `normalizedItem` with amount and supplier, but lacks quantity/unit price detail. Deliverables already have `value` (lump sum). Adding `quantity` and `unitPrice` to the Deliverable model enables tracking "we charged RM 5,000/unit for LED screens last time" vs. "we charged RM 4,500/unit this time." This is the key differentiator: historical pricing intelligence for a small event management company. | Med-High | Requires schema change: add `quantity Int?` and `unitPrice Decimal?` to Deliverable model. Update DeliverableForm to include quantity/unitPrice fields. Update AI extraction (`InvoiceLineItem` already has `quantity` and `unitPrice` -- wire these through to Deliverable import). Build a new page or enhance existing Price Comparison. |
| **By-client pricing history view** | "What did we charge Company X for similar items?" View all deliverables grouped by company, showing pricing trends over time. Critical for proposals: "last year we charged Petronas RM 50k for a 2-day event setup, should we raise prices?" | Med | Query: Deliverable -> Project -> Company. Group by company, show deliverables with date, quantity, unitPrice, total. Add company filter. |
| **Pricing trend visualization** | Simple line chart showing unit price over time for a specific item or client. Instantly shows if prices are rising, falling, or stable. | Med | Use a lightweight charting library (recharts already common in Next.js/shadcn ecosystems). Small sparkline or trend line per item. |
| **AI-extracted line item detail persistence** | The AI extraction types (`InvoiceLineItem`) already capture `quantity` and `unitPrice`, but the Deliverable model only stores `value` (lump sum). Wire the AI extraction pipeline to persist quantity and unitPrice so historical data is granular from day one. | Med | Modify `/api/ai/import/deliverable` to map `quantity` and `unitPrice` from `DeliverableItem` extraction to Deliverable model fields. Update `DeliverableExtraction.deliverables` type to include quantity/unitPrice. |
| **Normalized deliverable names** | Similar to how costs have `normalizedItem` for price comparison, deliverables need a `normalizedTitle` field for grouping across projects. "LED Wall Setup" and "LED Screen Installation" should be recognized as the same service. | Med | Add `normalizedTitle String?` to Deliverable model. Reuse the AI normalization pattern from cost categorization. Build or extend the `/ai-analyze` command to normalize deliverable titles. |

### CRM Navigation Enhancements

| Feature | Value Proposition | Complexity | Notes |
|---------|-------------------|------------|-------|
| **Contact quick-search in header** | The header already has a `HeaderSearch` component. Extending it to search contacts (not just projects/initiatives) lets users find any person instantly. | Med | Extend search API to include contacts. Show results grouped by type (Projects, Contacts, Companies). |
| **Company-scoped entity views** | When viewing a company, add tabs or links to see "all departments", "all contacts", "all deals", "all projects" for that company. Currently the company detail modal shows a summary list with counts -- enhance to full filtered views. | Med | Add filter params: `/contacts?company=xyz`, `/departments?company=xyz`. Pre-populate filter from URL searchParams. |
| **Bulk contact import (CSV)** | For a growing CRM, manually adding contacts one-by-one is tedious. A CSV import for contacts (name, email, phone, company, department, role) saves significant time. | Med-High | File upload + CSV parsing + validation + upsert. Important for initial data migration and ongoing use. |

### Sidebar UX Enhancements

| Feature | Value Proposition | Complexity | Notes |
|---------|-------------------|------------|-------|
| **Drag-to-reorder nav items** | Beyond show/hide, let users reorder items within groups. The designer might want "Projects" at the top of CRM, not "Companies". | Med-High | Requires drag-and-drop in settings, persisted order in UserPreferences. Use `@dnd-kit/core` or similar. Added complexity for questionable value with only 3 users. |
| **Sidebar item badges (counts)** | Show counts next to nav items: "Tasks (5)" for overdue tasks, "Pipeline (3)" for active deals. Provides at-a-glance awareness without clicking. | Med | Requires API calls or server-side data fetching for counts. Could use React Query with polling or SWR. Performance concern with frequent updates. |
| **Quick-collapse all groups** | Double-click or keyboard shortcut to collapse all groups at once, then expand only the one you need. Currently groups can only be toggled individually. | Low | Add a "collapse all" button or keyboard shortcut. Update `useNavCollapseState` to support batch operations. |

---

## Anti-Features

Features to explicitly NOT build. Common mistakes in this domain.

| Anti-Feature | Why Avoid | What to Do Instead |
|--------------|-----------|-------------------|
| **Full CRM contact management suite** | This is a 3-person team. Building email tracking, call logging, meeting scheduling, activity timelines per contact is enterprise bloat. HubSpot/Salesforce exist for that. SAAP is a project management + financial tracking tool, not a CRM replacement. | Keep contacts as reference data: name, email, phone, role, company, department. Link to deals/projects for context. No activity tracking, no email integration. |
| **Complex role-based sidebar visibility** | With only 3 users (ADMIN, EDITOR, VIEWER), building per-role sidebar presets adds complexity for no benefit. The existing `requireRole` filter on Admin group is sufficient for access control. | Let each user customize their own sidebar. Admin role already hides/shows the Admin group. No need for "role-based sidebar templates." |
| **Real-time pricing alerts** | Building notifications when prices change significantly or when a supplier raises prices sounds useful but is over-engineering for a team that processes ~20-50 costs per month. | Provide a static pricing history page. Users can check it when writing proposals. No push notifications, no automated alerts. |
| **Inline sidebar customization** | Tempting to let users right-click nav items to hide them or drag items in the sidebar itself. This is complex UX (context menus, drag states, undo) and confusing for discoverability. | Use the Settings page for sidebar customization. Clear, obvious, always findable. The existing Settings page pattern (radio buttons for detail view mode) extends naturally to checkboxes for nav visibility. |
| **Pricing prediction / ML models** | AI-based price prediction ("we predict this item will cost RM X next quarter") is fascinating but premature for 3 users and limited data points. | Show raw historical data and simple averages. Let humans interpret trends. |
| **Departments as standalone entities with their own pages** | Building full `/departments/[id]` detail pages with tabs, sections, and full CRUD is overkill. Departments are thin reference entities (name + description + company link). They do not warrant the same treatment as Projects or Companies. | Use modal/sheet for department details (consistent with current company detail pattern). The standalone `/departments` list page is for browsing/filtering, not deep detail. |
| **Contact activity timeline** | Logging every interaction with a contact (emails, calls, meetings) is classic CRM bloat. For 3 people who sit in the same office, this is unnecessary. | Show related deals and projects linked to the contact. That IS the interaction history for this team. |
| **Multi-currency pricing history** | The team operates in MYR. Building currency conversion, exchange rate tracking, and multi-currency comparisons adds complexity for a rare edge case. | Store all prices in MYR. If a foreign invoice appears, the AI extraction already notes currency. Manual conversion is fine for the rare case. |

---

## Feature Dependencies

```
Standalone Departments Page
  -> Requires: nav-config update (add to CRM group)
  -> Enables: Department filter on Contacts page
  -> Enables: Department detail modal

Standalone Contacts Page
  -> Requires: nav-config update (add to CRM group)
  -> Requires: Department page (for cascading filter context)
  -> Enables: Contact detail modal
  -> Enables: Contact quick-search in header

Add Task Button on /tasks
  -> Requires: Project selector component (tasks require projectId)
  -> Independent of other features

Internal Projects Flag
  -> Requires: Schema migration (add isInternal to Project)
  -> Enables: Filtered project views

Customizable Sidebar
  -> Requires: Schema migration (add hiddenNavItems to UserPreferences)
  -> Requires: Settings UI extension
  -> Independent of other features

Line Item Pricing History
  -> Requires: Schema migration (add quantity/unitPrice to Deliverable)
  -> Requires: AI extraction pipeline update
  -> Requires: Deliverable normalization
  -> Depends on: Existing Price Comparison page patterns
  -> Enables: By-item and by-client pricing views

Modal Fixes
  -> Independent (pure CSS/component fixes)
  -> Should be done first (fixes existing bugs)
```

---

## MVP Recommendation

For v2.3 MVP, prioritize in this order:

### Must Have (Table Stakes)

1. **Modal scroll/expand fixes** -- Bug fixes first, low effort, immediate UX improvement. Already has infrastructure (`DetailView` with `expandHref`, `ScrollArea`).

2. **Standalone Departments page** -- Low complexity, follows established patterns (`/companies` page is the template). Unblocks department filtering elsewhere.

3. **Standalone Contacts page** -- Low-med complexity, high daily-use value. "Find a contact by name" is a workflow the team does constantly. Include company and department filters.

4. **Add nav items for new pages** -- Trivial, required for discoverability of new pages.

5. **Add Task button on /tasks page** -- Missing CRUD entry point that breaks user expectations. Every other list page has an Add button. Include project selector in the dialog.

6. **Internal projects flag** -- Small schema change with big organizational value. Separates client vs. internal work in all views.

### Should Have (High-Value Differentiators)

7. **Customizable sidebar** -- Med complexity. The nav is getting crowded (16+ items). Users need personalization. Use Settings page pattern.

8. **Line item pricing history (by-item view)** -- Med-high complexity but the core differentiator. Schema migration + AI pipeline update + new view. This is what makes SAAP more than just a project tracker.

### Defer to v2.4+

- **By-client pricing history view** -- Builds on by-item view, defer until data exists
- **Pricing trend visualization** -- Nice to have, not critical for initial release
- **Contact quick-search in header** -- Enhancement, not core
- **Bulk contact import** -- Important but can wait
- **Drag-to-reorder sidebar** -- Low value for 3 users
- **Sidebar badges** -- Performance concern, questionable value

---

## Detailed Feature Specifications

### F1: Standalone Departments Page

**Route:** `/departments`
**Pattern:** Follow `/companies` page structure

**Data model (existing):**
```
Department {
  id, name, description,
  companyId -> Company,
  contacts[], deals[], potentials[]
}
```

**Page structure:**
- Server component fetches all departments with `_count` for contacts, deals, potentials
- Include company relation for display
- Client component `DepartmentList` with:
  - Search by department name
  - Company filter (combobox with all companies)
  - Table columns: Name, Company, Contacts count, Deals count, Created
  - Row click opens `DepartmentDetailModal`
  - Add Department button (requires company selection)

**Detail modal:**
- Show department name (editable inline), description, company link
- List contacts in this department (with cards)
- List related deals/potentials
- Add contact to department button
- Delete department (with cascade warning)

**API routes needed:**
- `GET /api/departments` -- list all with counts and company
- `POST /api/departments` -- create (requires companyId)
- `GET /api/departments/[id]` -- detail with relations
- `PATCH /api/departments/[id]` -- update
- `DELETE /api/departments/[id]` -- delete

### F2: Standalone Contacts Page

**Route:** `/contacts`
**Pattern:** Follow `/companies` page structure

**Data model (existing):**
```
Contact {
  id, name, email, phone, role, isPrimary,
  companyId -> Company,
  departmentId -> Department?,
  deals[], potentials[], projects[]
}
```

**Page structure:**
- Server component fetches all contacts with company and department relations
- Client component `ContactList` with:
  - Search by name, email, phone
  - Company filter (combobox)
  - Department filter (cascading: filters departments by selected company)
  - Role filter (freetext or common roles)
  - Table columns: Name, Company, Department, Role, Email, Phone, Primary badge
  - Row click opens `ContactDetailModal`
  - Add Contact button (requires company selection)

**Detail modal:**
- Contact name (editable), email, phone, role
- Company link (clickable), department link (clickable)
- isPrimary toggle
- Related deals, projects
- Delete contact

**API routes needed:**
- `GET /api/contacts` -- list all with company, department relations
- `POST /api/contacts` -- create (requires companyId)
- `GET /api/contacts/[id]` -- detail with relations
- `PATCH /api/contacts/[id]` -- update
- `DELETE /api/contacts/[id]` -- delete

### F3: Add Task Button on /tasks Page

**Location:** Tasks page toolbar (next to view toggle)

**Implementation:**
- Dialog with:
  - Project selector (required) -- combobox showing all projects (not just those with existing tasks)
  - Title (required)
  - Description (optional)
  - Status, Priority selects
  - Due date, Assignee
  - Parent task selector (optional, for creating subtasks -- only shows tasks from selected project)
- On submit: POST to `/api/projects/{projectId}/tasks`
- On success: refresh tasks list, close dialog

**Key consideration:** The existing `TaskForm` component accepts `projectId` as a prop. Reuse it inside a dialog, but add a project selector wrapper above it.

**API changes:** None -- existing `/api/projects/[id]/tasks` POST endpoint handles task creation.

### F4: Internal Projects Flag

**Schema change:**
```prisma
model Project {
  // ... existing fields
  isInternal Boolean @default(false) @map("is_internal")
}
```

**UI changes:**
- Project form modal: add "Internal project" checkbox
- Project list page: add "Type" filter (All / Client / Internal)
- Project cards and table rows: amber "Internal" badge when `isInternal === true`
- Project detail sheet: show internal badge
- Dashboard/reports: option to exclude internal projects from revenue calculations

**API changes:**
- Update project creation and update endpoints to accept `isInternal`
- Add `isInternal` filter to project listing queries

### F5: Customizable Sidebar Navigation

**Schema change:**
```prisma
model UserPreferences {
  // ... existing fields
  hiddenNavItems Json? @db.Json // string[] of nav item hrefs
}
```

**Storage approach:** Database (via UserPreferences) because:
1. Already have a UserPreferences model with `detailViewMode`
2. Already have a Settings page with preference UI
3. Cross-device sync (same user on laptop and desktop)
4. Consistent with existing patterns

The existing `useNavCollapseState` hook uses localStorage for collapse state (ephemeral UI state). Nav visibility is a different concern -- it is a deliberate user choice that should persist across devices.

**Settings UI:**
```
Settings Page
  -> Detail View Mode (existing)
  -> Sidebar Navigation (new)
     -> SAAP group
        [x] Dashboard
        [x] By Objective
        [ ] Timeline (hidden)
        [x] Kanban
        ...
     -> CRM group
        [x] Companies
        [x] Departments (new)
        ...
```

Each item is a Switch/Checkbox. Toggling immediately saves to DB via PATCH `/api/user/preferences`.

**Sidebar rendering change:**
- Before rendering nav items, filter out items whose `href` is in the user's `hiddenNavItems` array
- Add a hook `useNavVisibility` that fetches user preferences and provides the hidden items list
- Never hide the current page's nav item (even if hidden, show it while user is on that page)

**Safeguards:**
- Cannot hide all items in a group (at least one must remain visible)
- Dashboard ("/") cannot be hidden (always accessible)
- Settings cannot be hidden (always accessible)
- Admin items follow role-based visibility first, then user preference

### F6: Line Item Pricing History

**Schema changes:**
```prisma
model Deliverable {
  // ... existing fields
  quantity       Int?     @default(1)
  unitPrice      Decimal? @map("unit_price") @db.Decimal(12, 2)
  normalizedTitle String? @map("normalized_title") @db.VarChar(255)
}
```

The `value` field remains as the total (quantity x unitPrice or lump sum). When quantity and unitPrice are provided, `value = quantity * unitPrice`. When only value is provided (lump sum), quantity defaults to 1 and unitPrice equals value.

**Type update:**
```typescript
// Update DeliverableItem to include granular pricing
interface DeliverableItem {
  title: string
  description?: string
  value: number
  quantity?: number      // NEW
  unitPrice?: number     // NEW
  confidence: ConfidenceLevel
}
```

**AI extraction pipeline update:**
- The `InvoiceLineItem` type already has `quantity` and `unitPrice`
- The `DeliverableItem` type needs `quantity` and `unitPrice` added
- The `/api/ai/import/deliverable` endpoint maps these new fields to the Deliverable model

**Deliverable form update:**
- Add quantity field (integer, optional, default 1)
- Add unit price field (decimal, optional)
- Auto-calculate total value when both are provided
- Allow manual override of total value (for lump sum items)

**By-item pricing history page:**

**Route:** `/pricing-history` or enhance existing `/supplier-items`

**Approach:** Create a new page (not enhance Price Comparison) because:
- Price Comparison tracks costs (purchases FROM suppliers)
- Pricing History tracks deliverables (charges TO clients)
- Different data sources, different audiences

**Page structure:**
- Group deliverables by `normalizedTitle`
- For each normalized title, show:
  - List of instances across projects/companies
  - Quantity, unit price, total, date, client
  - Min/max/avg unit price
  - Most recent price
- Filter by: normalized title, company, date range
- Sort by: date, unit price, total

**By-client pricing history view (defer to v2.4):**
- Group deliverables by Company (via Project -> Company)
- For each company, show all deliverables with pricing details
- Useful for: "What did we charge Petronas historically?"

### F7: Modal Scroll and Expand Fixes

**Scroll fix:**
- Audit all `DetailView` usages across the app
- Ensure dialog mode has proper max height: `max-h-[85vh]` on DialogContent
- Ensure ScrollArea has `flex-1 min-h-0 overflow-hidden` (the `min-h-0` is critical for flex children to scroll)
- Test with long content (company with 10+ contacts, 5+ departments)

**Expand-to-page:**
- Wire `expandHref` prop on existing modals:
  - `CompanyDetailModal` -> expandHref not applicable (no dedicated company page)
  - `ProjectDetailSheet` -> expandHref={`/projects/${project.id}`} (page exists)
  - New `DepartmentDetailModal` -> no dedicated page, omit expandHref
  - New `ContactDetailModal` -> no dedicated page, omit expandHref

---

## Existing Infrastructure Reuse Map

| New Feature | Reuses From | Pattern |
|-------------|-------------|---------|
| Departments page | `/companies` page, `CompanyList` | Server fetch + client table + search + filter + detail modal |
| Contacts page | `/companies` page, `CompanyList` | Same pattern with additional cascading filters |
| Department detail modal | `CompanyDetailModal` | DetailView wrapper + inline editing + related items |
| Contact detail modal | `CompanyDetailModal` | DetailView wrapper + inline editing + related items |
| Add Task dialog | `TaskForm` component | Wrap existing form in Dialog with project selector |
| Sidebar customization | Settings page, `UserPreferences` model | Add card section to Settings, extend preferences schema |
| Pricing history | `/supplier-items` page, `SupplierItemsTable` | Similar table pattern with different data source (deliverables vs costs) |
| Nav config updates | `nav-config.ts` | Add items to `navGroups[1].items` array |
| Internal flag | Project form, project list | Add boolean field + filter + badge |

---

## Estimated Complexity Budget

For a 3-person team, rough effort estimates:

| Feature | Backend | Frontend | Total |
|---------|---------|----------|-------|
| Modal fixes | 0h | 2h | 2h |
| Departments page + modal | 3h | 5h | 8h |
| Contacts page + modal | 3h | 6h | 9h |
| Nav config updates | 0h | 0.5h | 0.5h |
| Add Task on /tasks | 0h | 3h | 3h |
| Internal projects flag | 1h | 2h | 3h |
| Customizable sidebar | 2h | 4h | 6h |
| Line item pricing (schema + form) | 2h | 3h | 5h |
| Line item pricing (AI pipeline) | 3h | 0h | 3h |
| Line item pricing (history page) | 3h | 6h | 9h |
| **Total** | **17h** | **31.5h** | **48.5h** |

---

## Sources

### Codebase Analysis (HIGH confidence)
- Prisma schema: Department, Contact, Deliverable, Task, UserPreferences models
- `src/lib/nav-config.ts`: Current nav structure (SAAP: 8 items, CRM: 6 items, Admin: 1 item, Top-level: 2 items)
- `src/components/layout/sidebar.tsx`: Sidebar rendering with group filtering
- `src/components/companies/company-list.tsx`: List page pattern (search + filter + table + detail modal)
- `src/components/tasks/tasks-page-client.tsx`: Tasks page (filter bar + view toggle, NO add button)
- `src/components/supplier-items/supplier-items-table.tsx`: Price comparison pattern
- `src/components/ui/detail-view.tsx`: DetailView with dialog/drawer modes, expandHref prop, ScrollArea
- `src/types/ai-extraction.ts`: InvoiceLineItem already has quantity/unitPrice; DeliverableItem lacks them
- `src/app/(dashboard)/settings/page.tsx`: Settings page with detail view mode preference

### Domain Research (MEDIUM confidence)
- CRM entity browsing UX patterns: master-detail layouts, cross-entity navigation, simplified flows
- Sidebar customization: localStorage for ephemeral UI state, database for deliberate user preferences
- Line item pricing: standardized structures (CLINs), price variance tracking, historical comparison

### Industry Context (MEDIUM confidence)
- Small team CRM: focus on reference data, not activity tracking
- Procurement analytics: cost-per-item, purchase price variance, historical pricing benchmarks
- SaaS navigation: data-driven nav arrays filtered at render time by user preferences
