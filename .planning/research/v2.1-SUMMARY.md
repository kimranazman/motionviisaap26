# Project Research Summary

**Project:** SAAP 2026 v2.1
**Domain:** Navigation UX, Cross-Project Task Aggregation, Member Workload Dashboards
**Researched:** 2026-01-27
**Confidence:** HIGH

## Executive Summary

SAAP v2.1 adds three features to an existing Next.js 14 / Prisma / shadcn/ui application used by a 3-person team: collapsible sidebar navigation groups, a cross-project task page with table and kanban toggle, and per-member workload dashboard pages. The defining characteristic of this milestone is that nearly everything needed already exists in the codebase -- the Radix Collapsible primitive, the dnd-kit kanban infrastructure, recharts, and all the Prisma data models. The only new package required is `@tanstack/react-table` for the task table view. This is primarily a **composition and integration milestone**, not a greenfield build.

The recommended approach is to build in three sequential phases: navigation first (low-risk, unblocks nav links for new pages), cross-project tasks second (establishes the cross-entity query pattern and reusable task components), and member workload third (reuses task components and extends to multi-model aggregation). Each phase builds on the previous one's patterns. The critical architectural decision is to create a shared navigation config (`src/lib/navigation.ts`) before touching any sidebar code -- the existing three navigation components (desktop sidebar, mobile sidebar, mobile bottom nav) have already drifted apart (Price Comparison is missing from mobile), and adding collapsible groups without unifying the data source would make this worse.

The highest-risk technical issue is the **owner field type mismatch** across data models. Tasks and Initiatives use the `TeamMember` enum for assignee/personInCharge, but KeyResults and SupportTasks use freeform `String` for owner. The workload dashboard must aggregate across all four models, so a normalization utility mapping owner strings to TeamMember enum values is required. For 3 hardcoded team members this is straightforward, but it must be addressed before writing any aggregation queries. The second critical risk is the table/kanban view toggle -- shared state ownership must be lifted to the parent component to prevent DnD state collisions and data divergence between views.

## Key Findings

### Recommended Stack

v2.1 is exceptionally lightweight in terms of new dependencies. Only one new npm package is needed. Everything else leverages what is already installed.

**New package:**
- `@tanstack/react-table` v8.21.3: Headless table logic for the cross-project task data table -- shadcn officially recommends this pairing, 5M+ weekly downloads

**Existing packages (no changes needed):**
- `@radix-ui/react-collapsible` 1.1.12: Sidebar collapsible groups -- already installed, component exists at `src/components/ui/collapsible.tsx`
- `@dnd-kit/core` 6.3.1 + `@dnd-kit/sortable` 10.0.0: Task kanban drag-and-drop -- adapt the existing 586-line `kanban-board.tsx` pattern
- `recharts` 3.6.0: Workload dashboard charts -- 3 chart components already prove the pattern works
- `@prisma/client` 6.19.2: Cross-project task queries and member workload aggregations via `findMany` and `groupBy`

**Deliberately excluded:**
- shadcn full Sidebar component (overkill for adding collapsible groups to a 192-line sidebar)
- `nuqs` (URL state for filters -- 3 people do not share filter URLs, `useState` matches existing patterns)
- Additional charting libraries like nivo/echarts (CSS grid with Tailwind colors handles any heatmap need)
- State management libraries like zustand/jotai (`useState` + `localStorage` is sufficient)
- SWR or React Query (Server Components with direct Prisma queries is the established pattern)

See: `.planning/research/v2.1-STACK.md`

### Expected Features

**Must have (30 table stakes features):**

Sidebar (TS-01 through TS-10):
- Collapsible SAAP, CRM, and Admin navigation groups with chevron animation
- Persist collapse state in localStorage with default-open behavior
- Auto-expand group containing the currently active route
- Mobile sidebar parity (shared nav config eliminates drift)
- New nav items for Tasks and Members pages

Cross-Project Tasks (TS-11 through TS-22):
- `/tasks` route showing all tasks across all projects with project context
- Table view with sortable columns (title, project, status, priority, assignee, due date, tags)
- Kanban view with TODO / IN_PROGRESS / DONE columns
- Table/Kanban view toggle (state-based, not route-based)
- Filters: assignee, project, status, priority, text search
- Task detail sheet on click (reuse existing `task-detail-sheet.tsx`)

Member Workload (TS-23 through TS-30):
- `/members` overview page with 3 member cards showing aggregated stats
- `/members/[member]` detail page with KRs, Initiatives, Tasks, Support Tasks sections
- Summary statistics header on member detail
- Cross-model aggregation (4 entity types per member)

**Should have (differentiators to include in MVP):**
- D-05: Kanban drag-and-drop status change (natural extension, reuses dnd-kit)
- D-08: Due date quick filters (reuses existing DateFilter pattern)
- D-10: Persist view preference in localStorage (trivial)
- D-12: Status breakdown on member detail (display-only, low effort)
- D-13: Overdue/at-risk highlighting (CSS-only)
- D-14: Accountable items section on member detail (one extra query, high value)

**Defer to v2.2+:**
- D-01: Icon-rail sidebar collapse (requires significant refactor)
- D-04: Group-by option in task table (nice but not essential)
- D-07: Bulk status update (convenience feature)
- D-09: Task creation from cross-project page (can create from project page)
- D-11: Workload comparison chart (overview cards are sufficient initially)
- D-15: Cross-entity timeline (high complexity, KR deadline is loose string)

**Anti-features (do NOT build):**
- Real-time collaboration / WebSocket updates
- Custom task board columns / custom statuses
- Hours-based capacity planning
- AI workload insights
- Per-member notification system
- Nested sub-groups within sidebar sections
- Separate "My Tasks" vs "All Tasks" pages (assignee filter achieves this)

See: `.planning/research/v2.1-FEATURES.md`

### Architecture Approach

The architecture follows the established codebase pattern: Server Component pages with `force-dynamic` fetch data via Prisma, then pass serialized data to Client Component views. Filters, sorting, and view toggling all happen client-side (appropriate for the small data scale of a 3-person team). No schema changes are needed -- all data models already exist.

**Major components:**

1. **Navigation Config** (`src/lib/navigation.ts`) -- Single source of truth for all nav items, groups, icons, and conditions. Consumed by desktop sidebar, mobile sidebar, and bottom nav. Eliminates the existing 3-file duplication problem.

2. **SidebarGroup** (`src/components/layout/sidebar-group.tsx`) -- Reusable collapsible wrapper using the existing Radix Collapsible primitive. Handles chevron animation, open/closed state, and active route detection.

3. **Cross-Project Task API** (`src/app/api/tasks/route.ts`) -- New endpoint querying tasks across all projects with filters and lean includes. Queries only root-level tasks (`parentId: null`) with subtask counts. Also includes a top-level `PATCH /api/tasks/[taskId]` for status updates from the cross-project view.

4. **CrossProjectTaskView** (`src/components/tasks/cross-project-task-view.tsx`) -- Parent component owning task data state. Renders TaskFilterBar, then conditionally renders TaskTable or TaskKanbanBoard based on view mode toggle. Both child views receive data as props and emit mutation events upward.

5. **Member Workload Pages** (`src/app/(dashboard)/members/`) -- Overview page with member cards and detail page per member. Uses `Promise.all` for parallel cross-model aggregation. Includes `resolveOwnerToMember()` utility for normalizing freeform owner strings to TeamMember enum.

**Key patterns to follow:**
- Server Component page + Client view component (established pattern in every dashboard page)
- Optimistic UI updates for kanban drag-and-drop (established in `kanban-board.tsx`)
- Client-side filter state with `useState` + `useMemo` (established in kanban filter bar)
- View mode toggle with Tabs component (established in kanban Board/By-Person toggle)

See: `.planning/research/v2.1-ARCHITECTURE.md`

### Critical Pitfalls

1. **Navigation source duplication** -- Three nav components with separately defined link arrays already diverged (Price Comparison missing from mobile). Fix by creating shared `navigation.ts` config BEFORE restructuring any sidebar code. Phase 1 blocker.

2. **Cross-project task query N+1 / data explosion** -- Existing task API is project-scoped. Naive cross-project fetch creates N+1 queries or cartesian explosion with deep includes. Prevent by creating dedicated `/api/tasks` endpoint with `parentId: null` filter, lean `select`, and server-side pagination readiness. Phase 2, design API before any UI.

3. **Table-kanban view toggle DnD state collision** -- Toggling away from kanban during active drag leaves orphaned DnD state. Separate local state copies in each view cause data divergence. Prevent by lifting state to parent, guarding unmount during drag, and using stable keys on DndContext. Phase 2, architecture decision before building either view.

4. **Owner field type mismatch breaks workload aggregation** -- Tasks/Initiatives use `TeamMember` enum, KeyResults/SupportTasks use freeform `String`. Queries cannot unify without normalization. Prevent by creating `resolveOwnerToMember()` mapping utility. Phase 3, design before writing any aggregation queries.

5. **Task hierarchy double-counting in workload** -- Task model has 5 levels of subtask nesting. Counting all tasks inflates workload for members who use subtasks. Prevent by counting root tasks only (`parentId: null`) and showing subtask count as supplementary info. Phase 3, define counting semantics during planning.

See: `.planning/research/v2.1-PITFALLS.md`

## Implications for Roadmap

Based on research, the milestone naturally decomposes into 3 phases with clear dependency ordering.

### Phase 1: Collapsible Sidebar Navigation

**Rationale:** Lowest-risk change (no data model changes, no new API endpoints). Provides immediate UX improvement. Unblocks nav items for Tasks and Members pages built in Phases 2 and 3. Must be done first because it fixes the existing navigation duplication bug that gets worse with every new page.

**Delivers:** Unified navigation config, collapsible sidebar groups with persistence, mobile parity, and placeholder nav links for Tasks and Members.

**Addresses features:** TS-01 through TS-10

**Avoids pitfalls:** P1 (navigation duplication -- unified config is the core deliverable), P5 (hydration flash -- choose persistence strategy), P6 (active link in collapsed group -- auto-expand), P10 (mobile bottom nav overflow -- keep at 4 items)

**Estimated effort:** 1-2 days

**New files:** `src/lib/navigation.ts`, `src/components/layout/sidebar-group.tsx`, `src/components/layout/sidebar-link.tsx`, `src/lib/hooks/use-sidebar-state.ts`

**Modified files:** `sidebar.tsx`, `mobile-sidebar.tsx`, `mobile-nav.tsx`

### Phase 2: Cross-Project Task View

**Rationale:** Standalone page with clear scope that reuses existing patterns (dnd-kit kanban, shadcn Table). Establishes the cross-entity query pattern and component structure that Phase 3 reuses (member task list is a filtered cross-project task view). Must come before Phase 3 because member workload depends on understanding the task data shape.

**Delivers:** `/tasks` page with table and kanban views, task filters, cross-project task API, top-level task PATCH endpoint.

**Addresses features:** TS-11 through TS-22, plus differentiators D-05 (kanban DnD), D-08 (due date filters), D-10 (persist view preference)

**Avoids pitfalls:** P2 (N+1 queries -- dedicated API with parentId:null filter), P3 (DnD state collision -- lifted state, guarded unmount), P7 (kanban column mismatch -- task-specific 3-column config), P12 (kanban overflow -- default to filtered view)

**Uses stack:** `@tanstack/react-table` (new install), `@dnd-kit/core` + `@dnd-kit/sortable` (existing), shadcn Table/Tabs/Badge/Sheet (existing)

**Estimated effort:** 3-4 days

**New files:** `src/app/api/tasks/route.ts`, `src/app/api/tasks/[taskId]/route.ts`, `src/app/(dashboard)/tasks/page.tsx`, `src/components/tasks/cross-project-task-view.tsx`, `src/components/tasks/task-table.tsx`, `src/components/tasks/task-kanban-board.tsx`, `src/components/tasks/task-kanban-card.tsx`, `src/components/tasks/task-filter-bar.tsx`

### Phase 3: Member Workload Dashboard

**Rationale:** Depends on all entity types being stable (especially v2.0 KRs and SupportTasks). Reuses cross-project task components from Phase 2. The multi-model aggregation is the most complex data query work in v2.1, so it benefits from patterns established in earlier phases.

**Delivers:** `/members` overview page with member cards, `/members/[member]` detail page with KRs, Initiatives, Tasks, and Support Tasks sections, owner normalization utility, workload statistics.

**Addresses features:** TS-23 through TS-30, plus differentiators D-12 (status breakdown), D-13 (overdue highlighting), D-14 (accountable items)

**Avoids pitfalls:** P4 (owner field mismatch -- resolveOwnerToMember utility), P8 (double-counting -- root tasks only), P9 (cross-model blind spots -- aggregate all 4 entity types), P13 (MariaDB GROUP BY -- use Prisma groupBy, not raw queries)

**Estimated effort:** 3-4 days

**New files:** `src/lib/member-utils.ts`, `src/app/(dashboard)/members/page.tsx`, `src/app/(dashboard)/members/[member]/page.tsx`, `src/components/members/member-overview.tsx`, `src/components/members/member-card.tsx`, `src/components/members/member-workload.tsx`, member sub-list components

### Phase Ordering Rationale

- **Phase 1 -> Phase 2 -> Phase 3** follows a dependency chain: navigation unification enables the new page links, cross-project tasks establish the query pattern, workload reuses the task components.
- The grouping matches architectural boundaries: Phase 1 is layout-only (no data changes), Phase 2 is a single new page with its API, Phase 3 is a two-page section with cross-model aggregation.
- This order frontloads the lowest-risk work (sidebar refactor) and saves the highest-risk work (owner field normalization, multi-model aggregation) for last, giving the developer time to understand the data shape before tackling it.
- Each phase is independently shippable: a collapsible sidebar is useful on its own, the tasks page is useful without the workload dashboard, and the workload dashboard is the final polish.

### Research Flags

**Phases needing deeper research during planning:**
- **Phase 2** -- The STACK and ARCHITECTURE files disagree on whether to use `@tanstack/react-table` or plain HTML tables. STACK recommends TanStack (shadcn official pairing, built-in sorting/filtering/pagination). ARCHITECTURE argues against it (single table, adds 30KB, no existing usage). **Recommendation: Use `@tanstack/react-table`.** The task table needs column sorting, multi-field filtering, and pagination -- exactly what TanStack provides out of the box. Reimplementing these with plain `useState` is more code and more bugs than installing a well-documented 5M-download library. Follow the shadcn Data Table guide.
- **Phase 3** -- Owner field normalization needs validation against actual data. Run `SELECT DISTINCT owner FROM key_results` and `SELECT DISTINCT owner FROM support_tasks` to discover actual string values before writing the mapping function.

**Phases with standard patterns (skip research-phase):**
- **Phase 1** -- Collapsible sidebar groups with Radix Collapsible is a trivially well-documented pattern. The component already exists. This is a refactoring task, not a design task.

## Confidence Assessment

| Area | Confidence | Notes |
|------|------------|-------|
| Stack | HIGH | Only 1 new package. All existing dependencies verified against `package.json`. TanStack Table is the de facto standard for shadcn data tables. |
| Features | HIGH | 30 table stakes features clearly defined with implementation notes. Competitive analysis against Asana/Linear/ClickUp validates the feature set. Anti-features explicitly scoped out. |
| Architecture | HIGH | All architecture decisions based on direct codebase analysis. Patterns copied from existing working components. No schema changes required. 17 new files, 4 modified files inventoried. |
| Pitfalls | HIGH | 13 pitfalls identified across critical/moderate/minor severity. All verified against actual code (e.g., Price Comparison missing from mobile confirmed, owner field type mismatch confirmed in schema). Prevention strategies are concrete, not theoretical. |

**Overall confidence:** HIGH

### Gaps to Address

- **`@tanstack/react-table` vs plain table:** Research files disagree. Resolution: Use TanStack. Addressed above in Research Flags.
- **Actual owner string values in database:** The normalization mapping assumes owner strings like "Khairul", "Azlan", "Izyani" but actual values have not been queried from the production database. Validate during Phase 3 planning with `SELECT DISTINCT owner FROM key_results` and `SELECT DISTINCT owner FROM support_tasks`.
- **@dnd-kit version compatibility:** Core is v6.3.1 and sortable is v10.0.0 (different major version lines). PITFALLS notes this may indicate a partial upgrade. Verify compatibility before building the task kanban -- run existing kanban to confirm it works.
- **Task detail sheet cross-project context:** The existing `task-detail-sheet.tsx` is designed for project-scoped context. It needs minor updates to work when opened from the cross-project view (passing projectId for API calls). The extent of changes should be assessed during Phase 2 planning.
- **Sidebar collapse persistence strategy:** localStorage is simpler but causes hydration flash. Cookies work server-side but add complexity. For a 3-person internal tool, localStorage with accepted flash (or no persistence at all) is the pragmatic choice. Finalize during Phase 1 planning.

## Sources

### Primary (HIGH confidence -- direct codebase analysis)
- `package.json` -- verified all dependency versions
- `src/components/layout/sidebar.tsx` -- 192 lines, flat nav structure, CRM links hardcoded
- `src/components/layout/mobile-sidebar.tsx` -- separate nav arrays, missing Price Comparison
- `src/components/layout/mobile-nav.tsx` -- 4-item bottom nav in grid-cols-4
- `src/components/kanban/kanban-board.tsx` -- 586 lines, @dnd-kit patterns, initiative-specific columns
- `src/components/dashboard/team-workload.tsx` -- existing per-member initiative counts
- `src/components/ui/collapsible.tsx` -- Radix Collapsible wrapper already registered
- `src/components/ui/table.tsx` -- shadcn Table components ready for TanStack pairing
- `prisma/schema.prisma` -- Task (TeamMember assignee), KeyResult (String owner), SupportTask (String owner)

### Secondary (HIGH confidence -- official documentation)
- [shadcn/ui Data Table Guide](https://ui.shadcn.com/docs/components/data-table) -- TanStack + shadcn Table pairing
- [shadcn/ui Collapsible Documentation](https://ui.shadcn.com/docs/components/collapsible) -- Radix Collapsible usage
- [shadcn/ui Sidebar Documentation](https://ui.shadcn.com/docs/components/sidebar) -- evaluated and excluded full sidebar
- [@tanstack/react-table npm](https://www.npmjs.com/package/@tanstack/react-table) -- v8.21.3, 5.3M weekly downloads
- [TanStack Table Documentation](https://tanstack.com/table/latest) -- API reference

### Tertiary (MEDIUM confidence -- community patterns)
- [Build a Kanban board with dnd-kit -- LogRocket](https://blog.logrocket.com/build-kanban-board-dnd-kit-react/)
- [Prisma ORM Performance Optimization Tips 2025](https://www.urhoba.net/2025/11/prisma-orm-performance-optimization-tips.html)
- [Asana My Tasks Views Documentation](https://help.asana.com/s/article/views-in-my-tasks)
- [SmartTask Team Dashboard Guide](https://www.smarttask.io/blog/team-dashboard)

---
*Research completed: 2026-01-27*
*Ready for roadmap: yes*
